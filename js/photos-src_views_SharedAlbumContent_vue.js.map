{"version":3,"file":"photos-src_views_SharedAlbumContent_vue.js?v=e86fedc3d056aed68da7","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;AC5JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;ACjKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;ACjEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;AC1LA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAkBA;AACA;;;;;;;;;;;;;;;ACvCA","sources":["webpack:///photos/src/views/SharedAlbumContent.vue?vue&type=script&lang=js","webpack:///photos/src/views/SharedAlbumContent.vue?vue&type=template&id=259e376e&scoped=true","webpack:///photos/src/mixins/FetchSharedAlbumsMixin.js","webpack:///photos/src/services/Albums.js","webpack:///photos/src/views/SharedAlbumContent.vue?vue&type=style&index=0&id=259e376e&lang=scss&scoped=true","webpack://photos/./src/views/SharedAlbumContent.vue?9b79","webpack:///photos/src/views/SharedAlbumContent.vue","webpack://photos/./src/views/SharedAlbumContent.vue?d156","webpack://photos/./src/views/SharedAlbumContent.vue?d034","webpack://photos/./src/views/SharedAlbumContent.vue?dd7e"],"sourcesContent":["import { mapActions, mapGetters } from 'vuex';\nimport MapMarker from 'vue-material-design-icons/MapMarker.vue';\nimport Plus from 'vue-material-design-icons/Plus.vue';\nimport Delete from 'vue-material-design-icons/Delete.vue';\nimport ImagePlus from 'vue-material-design-icons/ImagePlus.vue';\nimport Close from 'vue-material-design-icons/Close.vue';\n// import Download from 'vue-material-design-icons/Download.vue'\n// import DownloadMultiple from 'vue-material-design-icons/DownloadMultiple.vue'\n\nimport { NcActions, NcActionButton, NcButton, NcModal, NcEmptyContent, NcActionSeparator, NcUserBubble, isMobile } from '@nextcloud/vue';\nimport { getCurrentUser } from '@nextcloud/auth';\nimport FetchSharedAlbumsMixin from '../mixins/FetchSharedAlbumsMixin.js';\nimport FetchFilesMixin from '../mixins/FetchFilesMixin.js';\nimport AbortControllerMixin from '../mixins/AbortControllerMixin.js';\nimport CollectionContent from '../components/Collection/CollectionContent.vue';\nimport HeaderNavigation from '../components/HeaderNavigation.vue';\n// import ActionDownload from '../components/Actions/ActionDownload.vue'\nimport FilesPicker from '../components/FilesPicker.vue';\nimport logger from '../services/logger.js';\nimport client from '../services/DavClient.js';\nimport DavRequest from '../services/DavRequest.js';\nimport { genFileInfo } from '../utils/fileUtils.js';\nimport { translate } from '@nextcloud/l10n';\nexport default {\n  name: 'SharedAlbumContent',\n  components: {\n    MapMarker,\n    Plus,\n    Close,\n    // Download,\n    // DownloadMultiple,\n    Delete,\n    ImagePlus,\n    NcEmptyContent,\n    NcActions,\n    NcActionButton,\n    NcActionSeparator,\n    NcButton,\n    NcModal,\n    NcUserBubble,\n    CollectionContent,\n    // ActionDownload,\n    FilesPicker,\n    HeaderNavigation\n  },\n  mixins: [FetchSharedAlbumsMixin, FetchFilesMixin, AbortControllerMixin, isMobile],\n  props: {\n    albumName: {\n      type: String,\n      default: '/'\n    }\n  },\n  data() {\n    return {\n      showAddPhotosModal: false,\n      loadingCount: 0,\n      loadingAddFilesToAlbum: false\n    };\n  },\n  computed: {\n    ...mapGetters(['files', 'sharedAlbumsFiles']),\n    /**\n     * @return {object} The album information for the current albumName.\n     */\n    album() {\n      return this.sharedAlbums[this.albumName] || {};\n    },\n    /**\n     * @return {string[]} The list of files for the current albumName.\n     */\n    albumFileIds() {\n      return this.sharedAlbumsFiles[this.albumName] || [];\n    },\n    /**\n     * @return {string} The album name without the userId between parentheses.\n     */\n    albumOriginalName() {\n      return this.albumName.replace(new RegExp(`\\\\(${this.album.collaborators[0].id}\\\\)$`), '');\n    }\n  },\n  watch: {\n    album() {\n      this.fetchAlbumContent();\n    }\n  },\n  methods: {\n    ...mapActions(['appendFiles', 'deleteSharedAlbum', 'addFilesToSharedAlbum', 'removeFilesFromSharedAlbum']),\n    async fetchAlbumContent() {\n      if (this.loadingFiles || this.showEditAlbumForm) {\n        return [];\n      }\n      const semaphoreSymbol = await this.semaphore.acquire(() => 0, 'fetchFiles');\n      const fetchSemaphoreSymbol = await this.fetchSemaphore.acquire();\n      try {\n        this.errorFetchingFiles = null;\n        this.loadingFiles = true;\n        this.semaphoreSymbol = semaphoreSymbol;\n        const response = await client.getDirectoryContents(`/photos/${getCurrentUser()?.uid}/sharedalbums/${this.albumName}`, {\n          data: DavRequest,\n          details: true,\n          signal: this.abortController.signal\n        });\n        const fetchedFiles = response.data.map(file => genFileInfo(file));\n        const fileIds = fetchedFiles.map(file => file.fileid).map(fileId => fileId.toString());\n        this.appendFiles(fetchedFiles);\n        if (fetchedFiles.length > 0) {\n          await this.$store.commit('addFilesToSharedAlbum', {\n            albumName: this.albumName,\n            fileIdsToAdd: fileIds\n          });\n        }\n        logger.debug(`[SharedAlbumContent] Fetched ${fileIds.length} new files: `, fileIds);\n      } catch (error) {\n        if (error.response?.status === 404) {\n          this.errorFetchingFiles = 404;\n        } else if (error.code === 'ERR_CANCELED') {\n          return;\n        } else {\n          this.errorFetchingFiles = error;\n        }\n\n        // cancelled request, moving on...\n        logger.error('[SharedAlbumContent] Error fetching album files', {\n          error\n        });\n      } finally {\n        this.loadingFiles = false;\n        this.semaphore.release(semaphoreSymbol);\n        this.fetchSemaphore.release(fetchSemaphoreSymbol);\n      }\n      return [];\n    },\n    async handleFilesPicked(fileIds) {\n      this.showAddPhotosModal = false;\n      await this.addFilesToSharedAlbum({\n        albumName: this.albumName,\n        fileIdsToAdd: fileIds\n      });\n      // Re-fetch album content to have the proper filenames.\n      await this.fetchAlbumContent();\n    },\n    async handleRemoveFilesFromAlbum(fileIds) {\n      this.$refs.collectionContent.onUncheckFiles(fileIds);\n      await this.removeFilesFromSharedAlbum({\n        albumName: this.albumName,\n        fileIdsToRemove: fileIds\n      });\n    },\n    async handleDeleteAlbum() {\n      await this.deleteSharedAlbum({\n        albumName: this.albumName\n      });\n      this.$router.push('/sharedalbums');\n    },\n    t: translate\n  }\n};","var render = function render() {\n  var _vm = this,\n    _c = _vm._self._c;\n  return _c(\"div\", [true ? _c(\"CollectionContent\", {\n    ref: \"collectionContent\",\n    attrs: {\n      collection: _vm.album,\n      \"collection-file-ids\": _vm.albumFileIds,\n      semaphore: _vm.semaphore,\n      loading: _vm.loadingAlbums || _vm.loadingFiles,\n      error: _vm.errorFetchingAlbums || _vm.errorFetchingFiles\n    },\n    scopedSlots: _vm._u([{\n      key: \"header\",\n      fn: function (_ref) {\n        let {\n          selectedFileIds,\n          resetSelection\n        } = _ref;\n        return _c(\"HeaderNavigation\", {\n          key: \"navigation\",\n          attrs: {\n            loading: _vm.loadingFiles,\n            params: {\n              albumName: _vm.albumName\n            },\n            path: \"/\" + _vm.albumName,\n            title: _vm.albumOriginalName\n          },\n          on: {\n            refresh: _vm.fetchAlbumContent\n          }\n        }, [_vm.album.location !== \"\" ? _c(\"div\", {\n          staticClass: \"album__location\",\n          attrs: {\n            slot: \"subtitle\"\n          },\n          slot: \"subtitle\"\n        }, [_c(\"MapMarker\"), _vm._v(_vm._s(_vm.album.location) + \" ⸱ \" + _vm._s(_vm.t(\"photos\", \"Shared by\")) + \" \"), _c(\"NcUserBubble\", {\n          attrs: {\n            \"display-name\": _vm.album.collaborators[0].label,\n            user: _vm.album.collaborators[0].id\n          }\n        })], 1) : _vm._e(), _vm._v(\" \"), _c(\"template\", {\n          slot: \"default\"\n        }, [selectedFileIds.length > 0 ? _c(\"NcButton\", {\n          attrs: {\n            \"aria-label\": _vm.t(\"photos\", \"Unselect all\")\n          },\n          on: {\n            click: resetSelection\n          },\n          scopedSlots: _vm._u([{\n            key: \"icon\",\n            fn: function () {\n              return [_c(\"Close\")];\n            },\n            proxy: true\n          }], null, true)\n        }, [_vm._v(\"\\n\\t\\t\\t\\t\\t\" + _vm._s(_vm.t(\"photos\", \"Unselect all\")) + \"\\n\\t\\t\\t\\t\")]) : _vm._e()], 1), _vm._v(\" \"), _vm.album !== undefined ? _c(\"template\", {\n          slot: \"right\"\n        }, [_vm.album.nbItems !== 0 ? _c(\"NcButton\", {\n          attrs: {\n            type: \"tertiary\",\n            \"aria-label\": _vm.t(\"photos\", \"Add photos to this album\")\n          },\n          on: {\n            click: function ($event) {\n              _vm.showAddPhotosModal = true;\n            }\n          }\n        }, [_c(\"Plus\", {\n          attrs: {\n            slot: \"icon\"\n          },\n          slot: \"icon\"\n        })], 1) : _vm._e(), _vm._v(\" \"), _c(\"NcActions\", {\n          attrs: {\n            \"force-menu\": true,\n            \"aria-label\": _vm.t(\"photos\", \"Open actions menu\")\n          }\n        }, [_c(\"NcActionButton\", {\n          attrs: {\n            \"close-after-click\": true\n          },\n          on: {\n            click: _vm.handleDeleteAlbum\n          }\n        }, [_vm._v(\"\\n\\t\\t\\t\\t\\t\\t\" + _vm._s(_vm.t(\"photos\", \"Delete album\")) + \"\\n\\t\\t\\t\\t\\t\\t\"), _c(\"Delete\", {\n          attrs: {\n            slot: \"icon\"\n          },\n          slot: \"icon\"\n        })], 1), _vm._v(\" \"), selectedFileIds.length > 0 ? [_c(\"NcActionSeparator\"), _vm._v(\" \"), _c(\"NcActionButton\", {\n          attrs: {\n            \"close-after-click\": true\n          },\n          on: {\n            click: function ($event) {\n              return _vm.handleRemoveFilesFromAlbum(selectedFileIds);\n            }\n          }\n        }, [_vm._v(\"\\n\\t\\t\\t\\t\\t\\t\\t\" + _vm._s(_vm.t(\"photos\", \"Remove selection from album\")) + \"\\n\\t\\t\\t\\t\\t\\t\\t\"), _c(\"Close\", {\n          attrs: {\n            slot: \"icon\"\n          },\n          slot: \"icon\"\n        })], 1)] : _vm._e()], 2)], 1) : _vm._e()], 2);\n      }\n    }], null, false, 1297611229)\n  }, [_vm._v(\" \"), _c(\"NcEmptyContent\", {\n    staticClass: \"album__empty\",\n    attrs: {\n      slot: \"empty-content\",\n      title: _vm.t(\"photos\", \"This album does not have any photos or videos yet!\")\n    },\n    slot: \"empty-content\"\n  }, [_c(\"ImagePlus\", {\n    attrs: {\n      slot: \"icon\"\n    },\n    slot: \"icon\"\n  }), _vm._v(\" \"), _c(\"NcButton\", {\n    attrs: {\n      slot: \"action\",\n      type: \"primary\",\n      \"aria-label\": _vm.t(\"photos\", \"Add photos to this album\")\n    },\n    on: {\n      click: function ($event) {\n        _vm.showAddPhotosModal = true;\n      }\n    },\n    slot: \"action\"\n  }, [_c(\"Plus\", {\n    attrs: {\n      slot: \"icon\"\n    },\n    slot: \"icon\"\n  }), _vm._v(\"\\n\\t\\t\\t\\t\" + _vm._s(_vm.t(\"photos\", \"Add\")) + \"\\n\\t\\t\\t\")], 1)], 1)], 1) : _vm._e(), _vm._v(\" \"), _vm.showAddPhotosModal ? _c(\"NcModal\", {\n    attrs: {\n      size: \"large\",\n      title: _vm.t(\"photos\", \"Add photos to the album\")\n    },\n    on: {\n      close: function ($event) {\n        _vm.showAddPhotosModal = false;\n      }\n    }\n  }, [_c(\"FilesPicker\", {\n    attrs: {\n      destination: _vm.album.basename,\n      \"blacklist-ids\": _vm.albumFileIds,\n      loading: _vm.loadingAddFilesToAlbum\n    },\n    on: {\n      \"files-picked\": _vm.handleFilesPicked\n    }\n  })], 1) : _vm._e()], 1);\n};\nvar staticRenderFns = [];\nrender._withStripped = true;\nexport { render, staticRenderFns };","/**\n * @copyright Copyright (c) 2022 Louis Chemineau <louis@chmn.me>\n *\n * @author Louis Chemineau <louis@chmn.me>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\n\nimport { mapGetters, mapActions } from 'vuex';\nimport { getCurrentUser } from '@nextcloud/auth';\nimport AbortControllerMixin from './AbortControllerMixin.js';\nimport { fetchAlbums } from '../services/Albums.js';\nexport default {\n  name: 'FetchSharedAlbumsMixin',\n  data() {\n    return {\n      errorFetchingAlbums: null,\n      loadingAlbums: false\n    };\n  },\n  mixins: [AbortControllerMixin],\n  async beforeMount() {\n    this.fetchAlbums();\n  },\n  computed: {\n    ...mapGetters(['sharedAlbums'])\n  },\n  methods: {\n    ...mapActions(['addSharedAlbums']),\n    async fetchAlbums() {\n      if (this.loadingAlbums) {\n        return;\n      }\n      try {\n        this.loadingAlbums = true;\n        this.errorFetchingAlbums = null;\n        const albums = await fetchAlbums(`/photos/${getCurrentUser()?.uid}/sharedalbums`, this.abortController.signal);\n        this.addSharedAlbums({\n          albums\n        });\n      } catch (error) {\n        if (error.response?.status === 404) {\n          this.errorFetchingAlbums = 404;\n        } else {\n          this.errorFetchingAlbums = error;\n        }\n      } finally {\n        this.loadingAlbums = false;\n      }\n    }\n  }\n};","/**\n * @copyright Copyright (c) 2022 Louis Chemineau <louis@chmn.me>\n *\n * @author Louis Chemineau <louis@chmn.me>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\n\nimport moment from '@nextcloud/moment';\nimport { translate } from '@nextcloud/l10n';\nimport defaultClient from '../services/DavClient.js';\nimport logger from '../services/logger.js';\nimport DavRequest from '../services/DavRequest.js';\nimport { genFileInfo } from '../utils/fileUtils.js';\n\n/**\n * @typedef {object} Album\n * @property {string} id - The id of the album.\n * @property {string} name - The name of the album.\n * @property {number} creationDate - The creation date of the album.\n * @property {string} isShared - Whether the current user as shared the album.\n * @property {string} isCollaborative - Whether the album can be edited by other users.\n * @property {number} itemCount - The number of item in the album.\n * @property {number} cover - The cover of the album.\n */\n\n/**\n * @param {string} extraProps - Extra properties to add to the DAV request.\n * @return {string}\n */\nfunction getDavRequest() {\n  let extraProps = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n  return `<?xml version=\"1.0\"?>\n\t\t\t<d:propfind xmlns:d=\"DAV:\"\n\t\t\t\txmlns:oc=\"http://owncloud.org/ns\"\n\t\t\t\txmlns:nc=\"http://nextcloud.org/ns\"\n\t\t\t\txmlns:ocs=\"http://open-collaboration-services.org/ns\">\n\t\t\t\t<d:prop>\n\t\t\t\t\t<nc:last-photo />\n\t\t\t\t\t<nc:nbItems />\n\t\t\t\t\t<nc:location />\n\t\t\t\t\t<nc:dateRange />\n\t\t\t\t\t<nc:collaborators />\n\t\t\t\t\t${extraProps}\n\t\t\t\t</d:prop>\n\t\t\t</d:propfind>`;\n}\n\n/**\n *\n * @param {string} path - Albums' root path.\n * @param {import('webdav').StatOptions} options - Options to forward to the webdav client.\n * @param {string} extraProps - Extra properties to add to the DAV request.\n * @param {import('webdav').WebDAVClient} client - The DAV client to use.\n * @return {Promise<Album|null>}\n */\nexport async function fetchAlbum(path, options) {\n  let extraProps = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : '';\n  let client = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : defaultClient;\n  try {\n    const response = await client.stat(path, {\n      data: getDavRequest(extraProps),\n      details: true,\n      ...options\n    });\n    logger.debug('[Albums] Fetched an album: ', {\n      data: response.data\n    });\n    return formatAlbum(response.data);\n  } catch (error) {\n    if (error.code === 'ERR_CANCELED') {\n      return null;\n    }\n    throw error;\n  }\n}\n\n/**\n *\n * @param {string} path - Albums' root path.\n * @param {import('webdav').StatOptions} options - Options to forward to the webdav client.\n * @param {string} extraProps - Extra properties to add to the DAV request.\n * @param {import('webdav').WebDAVClient} client - The DAV client to use.\n * @return {Promise<Album[]>}\n */\nexport async function fetchAlbums(path, options) {\n  let extraProps = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : '';\n  let client = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : defaultClient;\n  try {\n    const response = await client.getDirectoryContents(path, {\n      data: getDavRequest(extraProps),\n      details: true,\n      ...options\n    });\n    logger.debug(`[Albums] Fetched ${response.data.length} albums: `, {\n      data: response.data\n    });\n    return response.data.filter(album => album.filename !== path).map(formatAlbum);\n  } catch (error) {\n    if (error.code === 'ERR_CANCELED') {\n      return [];\n    }\n    throw error;\n  }\n}\n\n/**\n *\n * @param {object} album - An album received from a webdav request.\n * @return {Album}\n */\nfunction formatAlbum(album) {\n  // Ensure that we have a proper collaborators array.\n  if (album.props.collaborators === '') {\n    album.props.collaborators = [];\n  } else if (typeof album.props.collaborators.collaborator === 'object') {\n    if (Array.isArray(album.props.collaborators.collaborator)) {\n      album.props.collaborators = album.props.collaborators.collaborator;\n    } else {\n      album.props.collaborators = [album.props.collaborators.collaborator];\n    }\n  }\n\n  // Extract custom props.\n  album = genFileInfo(album);\n\n  // Compute date range label.\n  const dateRange = JSON.parse(album.dateRange?.replace(/&quot;/g, '\"') ?? '{}');\n  if (dateRange.start === null) {\n    dateRange.start = moment().unix();\n    dateRange.end = moment().unix();\n  }\n  const dateRangeFormatted = {\n    startDate: moment.unix(dateRange.start).format('MMMM YYYY'),\n    endDate: moment.unix(dateRange.end).format('MMMM YYYY')\n  };\n  if (dateRangeFormatted.startDate === dateRangeFormatted.endDate) {\n    album.date = dateRangeFormatted.startDate;\n  } else {\n    album.date = translate('photos', '{startDate} to {endDate}', dateRangeFormatted);\n  }\n  return album;\n}\n\n/**\n *\n * @param {string} path - Albums' root path.\n * @param {import('webdav').StatOptions} options - Options to forward to the webdav client.\n * @param {import('webdav').WebDAVClient} client - The DAV client to use.\n * @return {Promise<Array>}\n */\nexport async function fetchAlbumContent(path, options) {\n  let client = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : defaultClient;\n  try {\n    const response = await client.getDirectoryContents(path, {\n      data: DavRequest,\n      details: true,\n      ...options\n    });\n    const fetchedFiles = response.data.map(file => genFileInfo(file)).filter(file => file.fileid);\n    logger.debug(`[Albums] Fetched ${fetchedFiles.length} new files: `, fetchedFiles);\n    return fetchedFiles;\n  } catch (error) {\n    if (error.code === 'ERR_CANCELED') {\n      return [];\n    }\n    logger.error('Error fetching album files', {\n      error\n    });\n    console.error(error);\n    throw error;\n  }\n}","// Imports\nimport ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/noSourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".album[data-v-259e376e] {\\n  display: flex;\\n  flex-direction: column;\\n}\\n.album__title[data-v-259e376e] {\\n  width: 100%;\\n}\\n.album__name[data-v-259e376e] {\\n  overflow: hidden;\\n  white-space: nowrap;\\n  text-overflow: ellipsis;\\n}\\n.album__location[data-v-259e376e] {\\n  margin-left: -4px;\\n  display: flex;\\n  color: var(--color-text-lighter);\\n}\", \"\"]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\n      import API from \"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/dist/cjs.js!../../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-2.use[3]!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SharedAlbumContent.vue?vue&type=style&index=0&id=259e376e&lang=scss&scoped=true\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/dist/cjs.js!../../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-2.use[3]!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SharedAlbumContent.vue?vue&type=style&index=0&id=259e376e&lang=scss&scoped=true\";\n       export default content && content.locals ? content.locals : undefined;\n","import { render, staticRenderFns } from \"./SharedAlbumContent.vue?vue&type=template&id=259e376e&scoped=true\"\nimport script from \"./SharedAlbumContent.vue?vue&type=script&lang=js\"\nexport * from \"./SharedAlbumContent.vue?vue&type=script&lang=js\"\nimport style0 from \"./SharedAlbumContent.vue?vue&type=style&index=0&id=259e376e&lang=scss&scoped=true\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"259e376e\",\n  null\n  \n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"/home/louis/workspace/nextcloud/instances/stable25/apps-extra/photos/node_modules/vue-hot-reload-api/dist/index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!api.isRecorded('259e376e')) {\n      api.createRecord('259e376e', component.options)\n    } else {\n      api.reload('259e376e', component.options)\n    }\n    module.hot.accept(\"./SharedAlbumContent.vue?vue&type=template&id=259e376e&scoped=true\", function () {\n      api.rerender('259e376e', {\n        render: render,\n        staticRenderFns: staticRenderFns\n      })\n    })\n  }\n}\ncomponent.options.__file = \"src/views/SharedAlbumContent.vue\"\nexport default component.exports","import mod from \"-!../../node_modules/babel-loader/lib/index.js!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SharedAlbumContent.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../node_modules/babel-loader/lib/index.js!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SharedAlbumContent.vue?vue&type=script&lang=js\"","export * from \"-!../../node_modules/babel-loader/lib/index.js!../../node_modules/vue-loader/lib/loaders/templateLoader.js??ruleSet[1].rules[2]!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SharedAlbumContent.vue?vue&type=template&id=259e376e&scoped=true\"","export * from \"-!../../node_modules/style-loader/dist/cjs.js!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/dist/cjs.js!../../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-2.use[3]!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SharedAlbumContent.vue?vue&type=style&index=0&id=259e376e&lang=scss&scoped=true\""],"names":[],"sourceRoot":""}
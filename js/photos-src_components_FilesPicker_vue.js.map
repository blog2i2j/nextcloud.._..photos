{"version":3,"file":"photos-src_components_FilesPicker_vue.js?v=e830abfdf226fa64210f","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;ACnFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;AChHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;AC3DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAkBA;AACA;;;;;;;;;;;;;;;;ACvCA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AGAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA","sources":["webpack:///photos/src/components/FilesPicker.vue?vue&type=script&lang=js","webpack:///photos/src/components/FilesPicker.vue?vue&type=template&id=10d87d65&scoped=true","webpack:///photos/src/mixins/FilesByMonthMixin.js","webpack:///photos/src/components/FilesPicker.vue?vue&type=style&index=0&id=10d87d65&lang=scss&scoped=true","webpack://photos/./src/components/FilesPicker.vue?4d0f","webpack:///photos/src/components/FilesPicker.vue","webpack://photos/./src/components/FilesPicker.vue?32a8","webpack://photos/./src/components/FilesPicker.vue?a18b","webpack://photos/./src/components/FilesPicker.vue?fc7d","webpack:///photos/ignored|/home/louis/workspace/nextcloud/instances/stable25/apps-extra/photos/node_modules/asn1.js/node_modules/bn.js/lib|buffer","webpack:///photos/ignored|/home/louis/workspace/nextcloud/instances/stable25/apps-extra/photos/node_modules/bn.js/lib|buffer","webpack:///photos/ignored|/home/louis/workspace/nextcloud/instances/stable25/apps-extra/photos/node_modules/brorand|crypto","webpack:///photos/ignored|/home/louis/workspace/nextcloud/instances/stable25/apps-extra/photos/node_modules/browserify-sign/node_modules/readable-stream/lib/internal/streams|util","webpack:///photos/ignored|/home/louis/workspace/nextcloud/instances/stable25/apps-extra/photos/node_modules/browserify-sign/node_modules/readable-stream/lib|util","webpack:///photos/ignored|/home/louis/workspace/nextcloud/instances/stable25/apps-extra/photos/node_modules/create-ecdh/node_modules/bn.js/lib|buffer","webpack:///photos/ignored|/home/louis/workspace/nextcloud/instances/stable25/apps-extra/photos/node_modules/diffie-hellman/node_modules/bn.js/lib|buffer","webpack:///photos/ignored|/home/louis/workspace/nextcloud/instances/stable25/apps-extra/photos/node_modules/elliptic/node_modules/bn.js/lib|buffer","webpack:///photos/ignored|/home/louis/workspace/nextcloud/instances/stable25/apps-extra/photos/node_modules/hash-base/node_modules/readable-stream/lib/internal/streams|util","webpack:///photos/ignored|/home/louis/workspace/nextcloud/instances/stable25/apps-extra/photos/node_modules/hash-base/node_modules/readable-stream/lib|util","webpack:///photos/ignored|/home/louis/workspace/nextcloud/instances/stable25/apps-extra/photos/node_modules/miller-rabin/node_modules/bn.js/lib|buffer","webpack:///photos/ignored|/home/louis/workspace/nextcloud/instances/stable25/apps-extra/photos/node_modules/public-encrypt/node_modules/bn.js/lib|buffer","webpack:///photos/ignored|/home/louis/workspace/nextcloud/instances/stable25/apps-extra/photos/node_modules/stream-http/node_modules/readable-stream/lib/internal/streams|util","webpack:///photos/ignored|/home/louis/workspace/nextcloud/instances/stable25/apps-extra/photos/node_modules/stream-http/node_modules/readable-stream/lib|util"],"sourcesContent":["import { mapGetters } from 'vuex';\nimport { NcButton, NcLoadingIcon, NcNoteCard } from '@nextcloud/vue';\nimport { getCurrentUser } from '@nextcloud/auth';\nimport { UploadPicker } from '@nextcloud/upload';\nimport moment from '@nextcloud/moment';\nimport ImagePlus from 'vue-material-design-icons/ImagePlus.vue';\nimport FilesListViewer from './FilesListViewer.vue';\nimport File from './File.vue';\nimport FetchFilesMixin from '../mixins/FetchFilesMixin.js';\nimport FilesSelectionMixin from '../mixins/FilesSelectionMixin.js';\nimport FilesByMonthMixin from '../mixins/FilesByMonthMixin.js';\nimport UserConfig from '../mixins/UserConfig.js';\nimport allowedMimes from '../services/AllowedMimes.js';\nexport default {\n  name: 'FilesPicker',\n  components: {\n    File,\n    FilesListViewer,\n    ImagePlus,\n    NcButton,\n    NcLoadingIcon,\n    NcNoteCard,\n    UploadPicker\n  },\n  filters: {\n    /**\n     * @param {string} date - In the following format: YYYYMM\n     */\n    dateMonthAndYear(date) {\n      return moment(date, 'YYYYMM').format('MMMM YYYY');\n    }\n  },\n  mixins: [FetchFilesMixin, FilesByMonthMixin, FilesSelectionMixin, UserConfig],\n  props: {\n    // Label to show in the submit button.\n    destination: {\n      type: String,\n      required: true\n    },\n    // List of file ids to not show.\n    blacklistIds: {\n      type: Array,\n      default: () => []\n    },\n    // Whether we should disable the submit button and show a spinner.\n    loading: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data() {\n    return {\n      allowedMimes,\n      targetMonth: null,\n      uploadContext: {\n        route: 'albumpicker'\n      },\n      currentUser: getCurrentUser().uid\n    };\n  },\n  computed: {\n    ...mapGetters(['files'])\n  },\n  watch: {\n    monthsList(value) {\n      if (this.targetMonth === null) {\n        this.targetMonth = value[0];\n      }\n    }\n  },\n  methods: {\n    getFiles() {\n      this.fetchFiles('', {}, this.blacklistIds);\n    },\n    refreshFiles() {\n      this.fetchFiles('', {\n        firstResult: 0\n      }, [...this.blacklistIds, ...this.fetchedFileIds], true);\n    },\n    emitPickedEvent() {\n      this.$emit('files-picked', this.selectedFileIds);\n    }\n  }\n};","var render = function render() {\n  var _vm = this,\n    _c = _vm._self._c;\n  return _c(\"div\", {\n    staticClass: \"file-picker\"\n  }, [_c(\"div\", {\n    staticClass: \"file-picker__content\"\n  }, [_c(\"div\", {\n    staticClass: \"file-picker__navigation\",\n    class: {\n      \"file-picker__navigation--placeholder\": _vm.monthsList.length === 0\n    }\n  }, _vm._l(_vm.monthsList, function (month) {\n    return _c(\"div\", {\n      key: month,\n      staticClass: \"file-picker__navigation__month\",\n      class: {\n        selected: _vm.targetMonth === month\n      },\n      on: {\n        click: function ($event) {\n          _vm.targetMonth = month;\n        }\n      }\n    }, [_vm._v(\"\\n\\t\\t\\t\\t\" + _vm._s(_vm._f(\"dateMonthAndYear\")(month)) + \"\\n\\t\\t\\t\")]);\n  }), 0), _vm._v(\" \"), _c(\"FilesListViewer\", {\n    staticClass: \"file-picker__file-list\",\n    class: {\n      \"file-picker__file-list--placeholder\": _vm.monthsList.length === 0\n    },\n    attrs: {\n      \"file-ids-by-section\": _vm.fileIdsByMonth,\n      \"empty-message\": _vm.t(\"photos\", \"There are no photos or videos yet!\"),\n      sections: _vm.monthsList,\n      loading: _vm.loadingFiles,\n      \"base-height\": 100,\n      \"section-header-height\": 50,\n      \"scroll-to-section\": _vm.targetMonth\n    },\n    on: {\n      \"need-content\": _vm.getFiles\n    },\n    scopedSlots: _vm._u([{\n      key: \"default\",\n      fn: function (_ref) {\n        let {\n          file,\n          height,\n          visibility\n        } = _ref;\n        return [file.sectionHeader ? _c(\"h3\", {\n          staticClass: \"section-header\",\n          style: {\n            height: `${height}px`\n          },\n          attrs: {\n            id: `file-picker-section-header-${file.id}`\n          }\n        }, [_vm._v(\"\\n\\t\\t\\t\\t\\t\" + _vm._s(_vm._f(\"dateMonthAndYear\")(file.id)) + \"\\n\\t\\t\\t\\t\")]) : _c(\"File\", {\n          attrs: {\n            file: _vm.files[file.id],\n            \"allow-selection\": true,\n            selected: _vm.selection[file.id] === true,\n            visibility: visibility,\n            semaphore: _vm.semaphore\n          },\n          on: {\n            \"select-toggled\": _vm.onFileSelectToggle\n          }\n        })];\n      }\n    }])\n  })], 1), _vm._v(\" \"), _c(\"div\", {\n    staticClass: \"file-picker__actions\"\n  }, [_c(\"div\", {\n    staticClass: \"file-picker__actions__buttons\"\n  }, [_c(\"UploadPicker\", {\n    attrs: {\n      accept: _vm.allowedMimes,\n      context: _vm.uploadContext,\n      destination: _vm.photosLocation,\n      multiple: true\n    },\n    on: {\n      uploaded: _vm.refreshFiles\n    }\n  }), _vm._v(\" \"), _c(\"NcButton\", {\n    attrs: {\n      type: \"primary\",\n      disabled: _vm.loading || _vm.selectedFileIds.length === 0\n    },\n    on: {\n      click: _vm.emitPickedEvent\n    },\n    scopedSlots: _vm._u([{\n      key: \"icon\",\n      fn: function () {\n        return [!_vm.loading ? _c(\"ImagePlus\") : _vm._e(), _vm._v(\" \"), _vm.loading ? _c(\"NcLoadingIcon\") : _vm._e()];\n      },\n      proxy: true\n    }])\n  }, [_vm._v(\"\\n\\t\\t\\t\\t\" + _vm._s(_vm.t(\"photos\", \"Add to {destination}\", {\n    destination: _vm.destination\n  })) + \"\\n\\t\\t\\t\")])], 1), _vm._v(\" \"), _vm.photosLocationOwner !== _vm.currentUser ? _c(\"NcNoteCard\", {\n    attrs: {\n      type: \"warning\"\n    }\n  }, [_vm._v(\"\\n\\t\\t\\t\" + _vm._s(_vm.t(\"photos\", \"The destination folder is owned by {owner}\", {\n    owner: _vm.photosLocationOwner\n  })) + \"\\n\\t\\t\")]) : _vm._e()], 1)]);\n};\nvar staticRenderFns = [];\nrender._withStripped = true;\nexport { render, staticRenderFns };","/**\n * @copyright Copyright (c) 2022 Louis Chemineau <louis@chmn.me>\n *\n * @author Louis Chemineau <louis@chmn.me>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\n\nexport default {\n  name: 'FilesByMonthMixin',\n  computed: {\n    /**\n     * @return {object<String, []>}\n     */\n    fileIdsByMonth() {\n      const filesByMonth = {};\n      for (const fileId of this.fetchedFileIds) {\n        const file = this.files[fileId];\n        if (file) {\n          filesByMonth[file.month] = filesByMonth[file.month] ?? [];\n          filesByMonth[file.month].push(file.fileid);\n        }\n      }\n\n      // Sort files in sections.\n      Object.keys(filesByMonth).forEach(month => filesByMonth[month].sort(this.sortFilesByTimestamp));\n      return filesByMonth;\n    },\n    /**\n     * @return {string[]}\n     */\n    monthsList() {\n      return Object.keys(this.fileIdsByMonth).sort((month1, month2) => month1 > month2 ? -1 : 1);\n    }\n  },\n  methods: {\n    /**\n     * @param {string} fileId1 The first file ID\n     * @param {string} fileId2 The second file ID\n     * @return {-1 | 1}\n     */\n    sortFilesByTimestamp(fileId1, fileId2) {\n      return this.files[fileId1].timestamp > this.files[fileId2].timestamp ? -1 : 1;\n    }\n  }\n};","// Imports\nimport ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/noSourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".file-picker[data-v-10d87d65] {\\n  display: flex;\\n  flex-direction: column;\\n  padding: 12px;\\n}\\n.file-picker__content[data-v-10d87d65] {\\n  display: flex;\\n  align-items: flex-start;\\n  flex-grow: 1;\\n  height: 500px;\\n}\\n.file-picker__navigation[data-v-10d87d65] {\\n  flex-basis: 200px;\\n  overflow: scroll;\\n  margin-right: 8px;\\n  padding-right: 8px;\\n  height: 100%;\\n}\\n@media only screen and (max-width: 1200px) {\\n.file-picker__navigation[data-v-10d87d65] {\\n    flex-basis: 100px;\\n}\\n}\\n.file-picker__navigation--placeholder[data-v-10d87d65] {\\n  background: var(--color-primary-light);\\n  border-radius: var(--border-radius-large);\\n}\\n.file-picker__navigation__month[data-v-10d87d65] {\\n  font-weight: bold;\\n  font-size: 16px;\\n  border-radius: var(--border-radius-pill);\\n  padding: 8px 16px;\\n  margin: 4px 0;\\n  cursor: pointer;\\n}\\n@media only screen and (max-width: 1200px) {\\n.file-picker__navigation__month[data-v-10d87d65] {\\n    text-align: center;\\n}\\n}\\n.file-picker__navigation__month[data-v-10d87d65]:hover {\\n  background: var(--color-background-dark);\\n}\\n.file-picker__navigation__month.selected[data-v-10d87d65] {\\n  background: var(--color-primary-element-lighter);\\n}\\n.file-picker__file-list[data-v-10d87d65] {\\n  flex-grow: 1;\\n  min-width: 0;\\n  height: 100%;\\n}\\n.file-picker__file-list--placeholder[data-v-10d87d65] {\\n  background: var(--color-primary-light);\\n  border-radius: var(--border-radius-large);\\n}\\n.file-picker__file-list .section-header[data-v-10d87d65] {\\n  font-weight: bold;\\n  font-size: 20px;\\n  padding: 8px 0 4px 0;\\n}\\n.file-picker__file-list[data-v-10d87d65] .empty-content {\\n  position: absolute;\\n  width: 100%;\\n  margin-top: 0;\\n  height: 100%;\\n  display: flex;\\n  flex-direction: column;\\n  justify-content: center;\\n}\\n.file-picker__actions[data-v-10d87d65] {\\n  display: flex;\\n  flex-direction: column;\\n  justify-content: space-between;\\n  justify-items: center;\\n  padding-top: 16px;\\n  flex-grow: 1;\\n}\\n.file-picker__actions__buttons[data-v-10d87d65] {\\n  display: flex;\\n  align-items: center;\\n  justify-content: end;\\n  gap: 16px;\\n}\", \"\"]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\n      import API from \"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/dist/cjs.js!../../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-2.use[3]!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./FilesPicker.vue?vue&type=style&index=0&id=10d87d65&lang=scss&scoped=true\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/dist/cjs.js!../../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-2.use[3]!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./FilesPicker.vue?vue&type=style&index=0&id=10d87d65&lang=scss&scoped=true\";\n       export default content && content.locals ? content.locals : undefined;\n","import { render, staticRenderFns } from \"./FilesPicker.vue?vue&type=template&id=10d87d65&scoped=true\"\nimport script from \"./FilesPicker.vue?vue&type=script&lang=js\"\nexport * from \"./FilesPicker.vue?vue&type=script&lang=js\"\nimport style0 from \"./FilesPicker.vue?vue&type=style&index=0&id=10d87d65&lang=scss&scoped=true\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"10d87d65\",\n  null\n  \n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"/home/louis/workspace/nextcloud/instances/stable25/apps-extra/photos/node_modules/vue-hot-reload-api/dist/index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!api.isRecorded('10d87d65')) {\n      api.createRecord('10d87d65', component.options)\n    } else {\n      api.reload('10d87d65', component.options)\n    }\n    module.hot.accept(\"./FilesPicker.vue?vue&type=template&id=10d87d65&scoped=true\", function () {\n      api.rerender('10d87d65', {\n        render: render,\n        staticRenderFns: staticRenderFns\n      })\n    })\n  }\n}\ncomponent.options.__file = \"src/components/FilesPicker.vue\"\nexport default component.exports","import mod from \"-!../../node_modules/babel-loader/lib/index.js!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./FilesPicker.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../node_modules/babel-loader/lib/index.js!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./FilesPicker.vue?vue&type=script&lang=js\"","export * from \"-!../../node_modules/babel-loader/lib/index.js!../../node_modules/vue-loader/lib/loaders/templateLoader.js??ruleSet[1].rules[2]!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./FilesPicker.vue?vue&type=template&id=10d87d65&scoped=true\"","export * from \"-!../../node_modules/style-loader/dist/cjs.js!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/dist/cjs.js!../../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-2.use[3]!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./FilesPicker.vue?vue&type=style&index=0&id=10d87d65&lang=scss&scoped=true\"","/* (ignored) */","/* (ignored) */","/* (ignored) */","/* (ignored) */","/* (ignored) */","/* (ignored) */","/* (ignored) */","/* (ignored) */","/* (ignored) */","/* (ignored) */","/* (ignored) */","/* (ignored) */","/* (ignored) */","/* (ignored) */"],"names":[],"sourceRoot":""}
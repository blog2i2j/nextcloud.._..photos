import{V as r,e as l,u as f,s as N,d as y,t as s,l as d,_ as c,g as i,a as _,r as n}from"./vue.runtime.esm-DZVHDHac.chunk.mjs";import{u as S,N as b,a as C,r as A,m as w,s as k,v as P,i as L,b as F,c as I,d as g}from"./index-BKOSQir6.chunk.mjs";import{n as p,H as M,M as T,a as E,V as x,T as $,S as z,b as B,I as D,F as O,c as H,A as V,C as W,d as R,e as U,f as j}from"./icons-CCMXs15V.chunk.mjs";import{N as q,a as K,b as G}from"./NcAppSettingsSection-Bl2-D3_g-Bx19lXF_.chunk.mjs";import{n as h,t as J,c as Q,g as X,N as v,l as a,p as u}from"./index-CtBKWcPT.chunk.mjs";import{l as Y}from"./logger-D3RVzcfQ-BGZwsZPf.chunk.mjs";import{u as Z}from"./useHotKey-CUZeWrE9.chunk.mjs";import{N as tt}from"./NcCheckboxRadioSwitch-Di9rSADK-D02oVeZo.chunk.mjs";import{P as ot,a as et}from"./PhotosSourceLocationsSettings-BGrSeoxo.chunk.mjs";import{d as at}from"./index-C7x2K0nC.chunk.mjs";import{g as st}from"./index-Db3ciQuZ.chunk.mjs";import"./preload-helper-Dh9HmuEY.chunk.mjs";import"./NcActionButton-Gpv56vuS-DwokBgrB.chunk.mjs";import"./ChevronDown-DFQfzh63-CmnU8nt7.chunk.mjs";import"./NcDialog-D2lwwZL--BBju5KIU.chunk.mjs";import"./index-SCFTKIaY.chunk.mjs";import"./useModelMigration-EhAWvqDD-C-Iitg9F.chunk.mjs";const it={name:"NcAppNavigationList"};var nt=function(){var t=this,o=t._self._c;return o("ul",{staticClass:"app-navigation-list"},[t._t("default")],2)},rt=[],pt=h(it,nt,rt,!1,null,"058e6060");const lt=pt.exports,ct={name:"NcAppNavigation",components:{NcAppNavigationList:lt,NcAppNavigationToggle:q},inject:{setHasAppNavigation:{default:()=>()=>r.util.warn("NcAppNavigation is not mounted inside NcContent, this is probably an error."),from:"NcContent:setHasAppNavigation"}},props:{ariaLabel:{type:String,default:""},ariaLabelledby:{type:String,default:""}},setup(){return{isMobile:S()}},data(){return{open:!this.isMobile,focusTrap:null}},watch:{isMobile(){this.open=!this.isMobile,this.toggleFocusTrap()},open(){this.toggleFocusTrap()}},mounted(){this.setHasAppNavigation(!0),N("toggle-navigation",this.toggleNavigationByEventBus),l("navigation-toggled",{open:this.open}),this.focusTrap=Q(this.$refs.appNavigationContainer,{allowOutsideClick:!0,fallbackFocus:this.$refs.appNavigationContainer,trapStack:X(),escapeDeactivates:!1}),this.toggleFocusTrap(),Z("n",this.onKeyDown,{prevent:!0,stop:!0})},unmounted(){this.setHasAppNavigation(!1),f("toggle-navigation",this.toggleNavigationByEventBus),this.focusTrap.deactivate()},methods:{async toggleNavigation(t){if(this.open===t){l("navigation-toggled",{open:this.open});return}this.open=typeof t>"u"?!this.open:t;const o=getComputedStyle(document.body),e=parseInt(o.getPropertyValue("--animation-quick"))||100;this.open&&(await this.$nextTick(),this.focusFirstElement()),setTimeout(()=>{l("navigation-toggled",{open:this.open})},1.5*e)},toggleNavigationByEventBus({open:t}){this.toggleNavigation(t)},toggleFocusTrap(){this.isMobile&&this.open?this.focusTrap.activate():this.focusTrap.deactivate()},handleEsc(){this.isMobile&&this.open&&this.toggleNavigation(!1)},focusFirstElement(){const t=J(this.$refs.appNavigationContainer)[0];t&&(t.focus(),Y.debug("Focusing first element in the navigation",{element:t}))},onKeyDown(t){if(t.key==="n"){if(!this.open){this.toggleNavigation(!0);return}this.isFocusWithinNavigation()&&this.toggleNavigation(!1)}},isFocusWithinNavigation(){const t=document.activeElement;return this.$refs.appNavigationContainer?.contains(t)}}};var dt=function(){var t=this,o=t._self._c;return o("div",{ref:"appNavigationContainer",staticClass:"app-navigation",class:{"app-navigation--close":!t.open}},[o("nav",{staticClass:"app-navigation__content",attrs:{id:"app-navigation-vue","aria-hidden":t.open?"false":"true","aria-label":t.ariaLabel||void 0,"aria-labelledby":t.ariaLabelledby||void 0,inert:!t.open||void 0},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"])?null:t.handleEsc.apply(null,arguments)}}},[o("div",{staticClass:"app-navigation__search"},[t._t("search")],2),o("div",{staticClass:"app-navigation__body",class:{"app-navigation__body--no-list":!t.$scopedSlots.list}},[t._t("default")],2),t.$scopedSlots.list?o("NcAppNavigationList",{staticClass:"app-navigation__list"},[t._t("list")],2):t._e(),t._t("footer")],2),o("NcAppNavigationToggle",{attrs:{open:t.open},on:{"update:open":t.toggleNavigation}})],1)},ht=[],gt=h(ct,dt,ht,!1,null,"e8d5a9e1");const ut=gt.exports,mt={name:"NcAppSettingsSection",inject:["registerSection","unregisterSection"],props:{name:{type:String,required:!0},id:{type:String,required:!0,validator(t){return/^[a-z0-9\-_]+$/.test(t)}}},computed:{htmlId(){return"settings-section_"+this.id}},watch:{id(t,o){this.unregisterSection(o),this.registerSection(t,this.name,this.$slots?.icon)},name(t){this.unregisterSection(this.id),this.registerSection(this.id,t,this.$slots?.icon)}},mounted(){this.registerSection(this.id,this.name,this.$slots?.icon)},beforeDestroy(){this.unregisterSection(this.id)}};var vt=function(){var t=this,o=t._self._c;return o("section",{staticClass:"app-settings-section",attrs:{id:t.htmlId,"aria-labelledby":`${t.htmlId}--label`}},[o("h3",{staticClass:"app-settings-section__name",attrs:{id:`${t.htmlId}--label`}},[t._v(" "+t._s(t.name)+" ")]),t._t("default"),t._e()],2)},ft=[],Nt=h(mt,vt,ft,!1,null,"e970c9f7");const yt=Nt.exports,_t={name:"CroppedLayoutSettings",components:{NcCheckboxRadioSwitch:tt},computed:{croppedLayout(){return this.$store.state.userConfig.croppedLayout}},methods:{updateSetting(t){this.$store.dispatch("updateUserConfig",{key:"croppedLayout",value:t})}}};var St=function(){var t=this,o=t._self._c;return o("NcCheckboxRadioSwitch",{attrs:{checked:t.croppedLayout,type:"switch"},on:{"update:checked":t.updateSetting}},[t._v(" "+t._s(t.t("photos","Enable squared photos view"))+" ")])},bt=[],Ct=p(_t,St,bt,!1,null,null);const At=Ct.exports,wt=y({name:"PhotosUploadLocationSettings",components:{NcButton:v,PhotosFolder:ot},data(){return{Home:M}},computed:{photosLocation(){return this.$store.state.userConfig.photosLocation}},methods:{debounceSelectPhotosFolder:at(function(){this.selectPhotosFolder()}),async selectPhotosFolder(){const t=await this.openFilePicker(s("photos","Select the default upload location for your media"));this.updatePhotosFolder(t)},async openFilePicker(t){return st(t).setMultiSelect(!1).addMimeTypeFilter("httpd/unix-directory").allowDirectories().startAt(this.photosLocation).addButton({label:s("photos","Pick folder"),callback:o=>a.debug("Picked",{nodes:o})}).build().pick()},updatePhotosFolder(t){this.$store.dispatch("updateUserConfig",{key:"photosLocation",value:t})},t:s}});var kt=function(){var t=this,o=t._self._c;return t._self._setupProxy,o("div",{staticClass:"photos-location"},[o("PhotosFolder",{attrs:{path:t.photosLocation,"root-folder-label":t.t("photos","Home"),"root-folder-icon":t.Home}}),o("NcButton",{attrs:{"aria-label":t.t("photos","Choose default Photos upload and Albums location")},on:{click:t.debounceSelectPhotosFolder}},[t._v(" "+t._s(t.t("photos","Choose a different folder"))+" ")])],1)},Pt=[],Lt=p(wt,kt,Pt,!1,null,"82064fa8");const Ft=Lt.exports,It={name:"SettingsDialog",components:{NcAppSettingsDialog:K,NcAppSettingsSection:yt,CroppedLayoutSettings:At,PhotosSourceLocationsSettings:et,PhotosUploadLocationSettings:Ft},props:{open:{type:Boolean,default:!1}},methods:{onClose(){this.$emit("update:open",!1)},t:s}};var Mt=function(){var t=this,o=t._self._c;return o("NcAppSettingsDialog",{attrs:{open:t.open,"show-navigation":!0,name:t.t("photos","Photos settings")},on:{"update:open":t.onClose}},[o("NcAppSettingsSection",{attrs:{id:"layout-settings",name:t.t("photos","View")}},[o("CroppedLayoutSettings")],1),o("NcAppSettingsSection",{attrs:{id:"source-directories-settings",name:t.t("photos","Media folders")}},[o("div",{staticClass:"setting-section-subline"},[t._v(" "+t._s(t.t("photos","Choose the folders from where photos and videos are shown."))+" ")]),o("PhotosSourceLocationsSettings")],1),o("NcAppSettingsSection",{attrs:{id:"upload-directory-settings",name:t.t("photos","Upload folder")}},[o("div",{staticClass:"setting-section-subline"},[t._v(" "+t._s(t.t("photos","Choose the folder where photos and albums are uploaded to."))+" ")]),o("PhotosUploadLocationSettings")],1)],1)},Tt=[],Et=p(It,Mt,Tt,!1,null,null);const xt=Et.exports,m=d("photos","appStoreEnabled",!1),$t={name:"Photos",components:{AccountBoxMultipleOutline:j,Cog:U,CalendarToday:R,Camera:W,AccountGroup:V,Folder:H,FolderMultipleImage:O,ImageIcon:D,ShareVariant:B,Star:z,Tag:$,VideoIcon:x,MapIcon:E,MapMarker:T,NcAppContent:C,NcAppNavigation:ut,NcAppNavigationItem:G,NcButton:v,NcContent:b,SettingsDialog:xt},data(){return{svgplaceholder:F,imgplaceholder:L,videoplaceholder:P,areTagsInstalled:k,showLocationMenuEntry:i()===null?!1:i().isAdmin&&m||w,showPeopleMenuEntry:i()===null?!1:i().isAdmin&&d("photos","showPeopleMenuEntry",!0)&&m||A,openedSettings:!1}},async beforeMount(){const t=d("photos","nomedia-paths",[]);this.$store.dispatch("setNomediaPaths",t),a.debug("Known .nomedia and .noimage  paths",{files:t}),"serviceWorker"in navigator?window.addEventListener("load",()=>{navigator.serviceWorker.register(c("/apps/photos/service-worker.js",{},{noRewrite:!0}),{scope:c("/apps/photos")}).then(o=>{a.debug("SW registered: ",{registration:o})}).catch(o=>{a.error("SW registration failed: ",{registrationError:o})})}):a.debug("Service Worker is not enabled on this browser.")},beforeDestroy(){window.removeEventListener("load",()=>{navigator.serviceWorker.register(c("/apps/photos/service-worker.js",{},{noRewrite:!0}))})},methods:{showSettings(){this.openedSettings=!0}}};var zt=function(){var t=this,o=t._self._c;return o("NcContent",{attrs:{"app-name":"photos"}},[o("NcAppNavigation",{attrs:{"aria-label":t.t("photos","Photos")},scopedSlots:t._u([{key:"list",fn:function(){return[o("NcAppNavigationItem",{staticClass:"app-navigation__all_media",attrs:{to:{name:"all_media"},name:t.t("photos","All media"),"data-id-app-nav-item":"all-media",exact:""}},[o("ImageIcon",{attrs:{slot:"icon",size:20},slot:"icon"})],1),o("NcAppNavigationItem",{attrs:{to:"/photos",name:t.t("photos","Photos"),"data-id-app-nav-item":"photos"}},[o("Camera",{attrs:{slot:"icon",size:20},slot:"icon"})],1),o("NcAppNavigationItem",{attrs:{to:"/videos",name:t.t("photos","Videos"),"data-id-app-nav-item":"videos"}},[o("VideoIcon",{attrs:{slot:"icon",size:20},slot:"icon"})],1),o("NcAppNavigationItem",{attrs:{to:{name:"albums"},name:t.t("photos","Albums"),"data-id-app-nav-item":"albums"}},[o("FolderMultipleImage",{attrs:{slot:"icon",size:20},slot:"icon"})],1),o("NcAppNavigationItem",{attrs:{to:{name:"sharedAlbums"},name:t.t("photos","Collaborative albums"),"data-id-app-nav-item":"shared-albums"}},[o("AccountGroup",{attrs:{slot:"icon",size:20},slot:"icon"})],1),t.showPeopleMenuEntry?o("NcAppNavigationItem",{attrs:{to:{name:"faces"},name:t.t("photos","People"),"data-id-app-nav-item":"faces"},scopedSlots:t._u([{key:"icon",fn:function(){return[o("AccountBoxMultipleOutline",{attrs:{size:20}})]},proxy:!0}],null,!1,1224485484)}):t._e(),o("NcAppNavigationItem",{attrs:{to:{name:"folders"},name:t.t("photos","Folders"),"data-id-app-nav-item":"folders"}},[o("Folder",{attrs:{slot:"icon",size:20},slot:"icon"})],1),o("NcAppNavigationItem",{attrs:{to:"/favorites",name:t.t("photos","Favorites"),"data-id-app-nav-item":"favorites"}},[o("Star",{attrs:{slot:"icon",size:20},slot:"icon"})],1),o("NcAppNavigationItem",{attrs:{to:{name:"thisday"},name:t.t("photos","On this day"),"data-id-app-nav-item":"this-day"}},[o("CalendarToday",{attrs:{slot:"icon",size:20},slot:"icon"})],1),o("NcAppNavigationItem",{attrs:{to:{name:"shared"},name:t.t("photos","Shared with you"),"data-id-app-nav-item":"shared"}},[o("ShareVariant",{attrs:{slot:"icon",size:20},slot:"icon"})],1),t.areTagsInstalled?o("NcAppNavigationItem",{attrs:{to:{name:"tags"},name:t.t("photos","Tags"),"data-id-app-nav-item":"tags"}},[o("Tag",{attrs:{slot:"icon",size:20},slot:"icon"})],1):t._e(),o("NcAppNavigationItem",{attrs:{to:{name:"places"},name:t.t("photos","Places"),"data-id-app-nav-item":"places"}},[o("MapMarker",{attrs:{slot:"icon",size:20},slot:"icon"})],1),t.showLocationMenuEntry?o("NcAppNavigationItem",{attrs:{to:{name:"maps"},name:t.t("photos","Map"),"data-id-app-nav-item":"maps"}},[o("MapIcon",{attrs:{slot:"icon",size:20},slot:"icon"})],1):t._e()]},proxy:!0},{key:"footer",fn:function(){return[o("div",{staticClass:"app-navigation__footer"},[o("NcButton",{attrs:{type:"tertiary",alignment:"start",wide:""},on:{click:t.showSettings},scopedSlots:t._u([{key:"icon",fn:function(){return[o("Cog",{attrs:{slot:"icon",size:20},slot:"icon"})]},proxy:!0}])},[t._v(" "+t._s(t.t("photos","Photos settings"))+" ")])],1)]},proxy:!0}])}),o("NcAppContent",[o("RouterView"),o("span",{staticClass:"hidden-visually",attrs:{role:"none"},domProps:{innerHTML:t._s(t.svgplaceholder)}}),o("span",{staticClass:"hidden-visually",attrs:{role:"none"},domProps:{innerHTML:t._s(t.imgplaceholder)}}),o("span",{staticClass:"hidden-visually",attrs:{role:"none"},domProps:{innerHTML:t._s(t.videoplaceholder)}})],1),o("SettingsDialog",{attrs:{open:t.openedSettings},on:{"update:open":function(e){t.openedSettings=e}}})],1)},Bt=[],Dt=p($t,zt,Bt,!1,null,null);const Ot=Dt.exports;I.sync(u,g),r.prototype.t=s,r.prototype.n=_,n("nc:metadata-photos-size"),n("nc:metadata-files-live-photo"),n("nc:metadata-blurhash"),n("nc:metadata-photos-original_date_time"),window.addEventListener("DOMContentLoaded",()=>{window.OCA.Files||(window.OCA.Files={}),Object.assign(window.OCA.Files,{App:{fileList:{filesClient:OC.Files.getClient()}}},window.OCA.Files)}),new r({el:"#content",name:"PhotosRoot",router:g,store:u,render:t=>t(Ot)});
//# sourceMappingURL=photos-main.mjs.map

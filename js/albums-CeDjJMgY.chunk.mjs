import{g as i,_ as u,c as T,m as b,t as n,N as W,a as J,b as m,s as B,S as a,v as Q,A as X,d as Z,e as v,U as E,f as tt,h as A,i as d,j as O,u as et,k,l as ot,n as R,o as F,p as U,q as w,r as z,T as lt,w as at,x as st}from"./vendor-DOPpmdjb.chunk.mjs";import{e as it,g as nt,a as rt,F as g,l as N,n as r,b as S,H as h,C as D,c as j,d as H,P as K,f as $,A as ct}from"./photos-main.mjs";import{E as ut,C as mt,a as bt,A as dt,b as P,S as ht,c as pt,M as y,F as V,P as _,d as Ct,e as ft,I as G,D as Y,f as gt,g as yt}from"./icons-Ba8uv1cK.chunk.mjs";import"./photos-sidebar.mjs";import"./tags-C9uqs7-N.chunk.mjs";const p=`/photos/${i()?.uid}/albums/`,_t={albums:(t,e,o,l)=>l.collectionsWithPrefix(p),getAlbum:(t,e,o)=>l=>o.collections.collections[`${p}${l}`],getAlbumFiles:(t,e,o)=>l=>o.collections.collectionsFiles[`${p}${l}`]||[],getAlbumName:(t,e,o)=>l=>`${p}${l}`},me={getters:_t},C="/photospublic/",Nt={publicAlbums:(t,e,o,l)=>l.collectionsWithPrefix(C),getPublicAlbum:(t,e,o)=>l=>o.collections.collections[`${C}${l}`]||null,getPublicAlbumFiles:(t,e,o)=>l=>o.collections.collectionsFiles[`${C}${l}`]||[],getPublicAlbumName:(t,e,o)=>l=>`${C}${l}`},be={getters:Nt},f=`/photos/${i()?.uid}/sharedalbums/`,vt={sharedAlbums:(t,e,o,l)=>l.collectionsWithPrefix(f),getSharedAlbum:(t,e,o)=>l=>o.collections.collections[`${f}${l}`],getSharedAlbumFiles:(t,e,o)=>l=>o.collections.collectionsFiles[`${f}${l}`]||[],getSharedAlbumName:(t,e,o)=>l=>`${f}${l}`},de={getters:vt};async function he(t="/",e={}){const o=u(`/apps/photos/api/v1/${e.shared?"shared":"albums"}`),l=`/files/${i()?.uid}`,c=(await T.get(o+it(t),e)).data.map(s=>({...s,filename:`${l}${s.filename}`})).map(s=>nt(s));let L;const x=[],I=[];for(const s of c)s.filename===`${l}${t}`?L=s:s.type!=="file"?x.push(s):rt.indexOf(s.mime)>-1&&I.push(s);return{folder:L,folders:x,files:I}}const At={name:"CollaboratorsSelectionForm",components:{Close:P,AccountGroup:dt,ContentCopy:bt,Check:mt,Earth:ut,NcButton:m,NcListItemIcon:J,NcSelect:W},mixins:[g],props:{albumName:{type:String,required:!0},collaborators:{type:Array,default:()=>[]},allowPublicLink:{type:Boolean,default:!0}},data(){return{searchText:null,availableCollaborators:{},selectedCollaboratorsKeys:[],currentSearchResults:[],loadingCollaborators:!1,randomId:Math.random().toString().substring(2,10),publicLinkCopied:!1,collaboratorTypes:a,config:{minSearchStringLength:parseInt(OC.config["sharing.minSearchStringLength"],10)||0}}},computed:{searchResults(){return this.currentSearchResults.filter(({id:t})=>t!==i()?.uid).map(t=>({...t,key:`${t.type}:${t.id}`,iconSvg:t.type===a.Group?X:void 0})).filter(({key:t})=>!this.selectedCollaboratorsKeys.includes(t))},listableSelectedCollaboratorsKeys(){return this.selectedCollaboratorsKeys.filter(t=>this.availableCollaborators[t].type!==a.Link)},selectedCollaborators(){return this.selectedCollaboratorsKeys.map(t=>this.availableCollaborators[t])},isPublicLinkSelected(){return this.selectedCollaboratorsKeys.includes(`${a.Link}`)},publicLink(){return this.availableCollaborators[a.Link]},publicLinkURL(){return`${window.location.protocol}//${window.location.host}${u(`apps/photos/public/${this.publicLink.id}`)}`},albumFileName(){return this.$store.getters.getAlbumName(this.albumName)}},watch:{collaborators(t){this.populateCollaborators(t)}},mounted(){this.populateCollaborators(this.collaborators)},methods:{...b(["updateCollection"]),async searchCollaborators(t){if(t!==void 0&&(t=t.trim(),!(t.length<this.config.minSearchStringLength)))try{this.loadingCollaborators=!0;const e=await T.get(Q("core/autocomplete/get"),{params:{search:t,itemType:"share-recipients",shareTypes:[a.User,a.Group]}});this.currentSearchResults=e.data.ocs.data.map(o=>{switch(o.source){case"users":return{id:o.id,label:o.label,type:a.User};case"groups":return{id:o.id,label:o.label,type:a.Group};default:throw new Error(`Invalid collaborator source ${o.source}`)}}),this.availableCollaborators={...this.availableCollaborators,...this.currentSearchResults.reduce(this.indexCollaborators,{})}}catch(e){this.errorFetchingCollaborators=e,N.error(this.t("photos","Failed to fetch collaborators list."),{error:e}),B(this.t("photos","Failed to fetch collaborators list."))}finally{this.loadingCollaborators=!1}},populateCollaborators(t){const e=t.reduce(this.indexCollaborators,{});this.selectedCollaboratorsKeys=Object.keys(e),this.availableCollaborators={3:{id:"",label:this.t("photos","Public link"),type:a.Link},...this.availableCollaborators,...e}},indexCollaborators(t,e){return{...t,[`${e.type}${e.type===a.Link?"":":"}${e.type===a.Link?"":e.id}`]:e}},async createPublicLinkForAlbum(){this.selectEntity(`${a.Link}`),await this.updateAlbumCollaborators(),await this.fetchCollection(this.albumFileName,["<nc:location />","<nc:dateRange />","<nc:collaborators />"])},async deletePublicLink(){this.unselectEntity(`${a.Link}`),this.availableCollaborators[3]={id:"",label:this.t("photos","Public link"),type:a.Link},this.publicLinkCopied=!1,await this.updateAlbumCollaborators()},async updateAlbumCollaborators(){try{await this.updateCollection({collectionFileName:this.albumFileName,properties:{collaborators:this.selectedCollaborators}})}catch(t){N.error("[PublicAlbumContent] Error updating album",{error:t}),B(this.t("photos","Failed to update album."))}},async copyPublicLink(){await navigator.clipboard.writeText(this.publicLinkURL),this.publicLinkCopied=!0,setTimeout(()=>{this.publicLinkCopied=!1},1e4)},selectEntity(t){this.searchText=null,!this.selectedCollaboratorsKeys.includes(t)&&this.selectedCollaboratorsKeys.push(t)},unselectEntity(t){const e=this.selectedCollaboratorsKeys.indexOf(t);e!==-1&&this.selectedCollaboratorsKeys.splice(e,1)},t:n}};var kt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"manage-collaborators"},[e("h2",{staticClass:"manage-collaborators__title"},[t._v(" "+t._s(t.t("photos","Add collaborators"))+" ")]),e("form",{staticClass:"manage-collaborators__form",on:{submit:function(o){o.preventDefault()}}},[e("NcSelect",{attrs:{"input-id":"sharing-search-input","input-label":t.t("photos","Add people or groups who can edit your album"),loading:t.loadingCollaborators,label:"label",filterable:!1,placeholder:t.t("photos","Search people or groups"),"clear-search-on-blur":()=>!1,"user-select":!0,"append-to-body":!1,options:t.searchResults},on:{search:t.searchCollaborators,"option:selected":({key:o})=>t.selectEntity(o)},model:{value:t.searchText,callback:function(o){t.searchText=o},expression:"searchText"}},[t._v(" "+t._s(t.t("photos","No recommendations. Start typing."))+" ")])],1),e("ul",{staticClass:"manage-collaborators__selection"},t._l(t.listableSelectedCollaboratorsKeys,function(o){return e("li",{key:o,staticClass:"manage-collaborators__selection__item"},[e("NcListItemIcon",{attrs:{id:t.availableCollaborators[o].id,"display-name":t.availableCollaborators[o].label,name:t.availableCollaborators[o].label,user:t.availableCollaborators[o].id,"is-no-user":t.availableCollaborators[o].type!==t.collaboratorTypes.User}},[t.availableCollaborators[o].type===t.collaboratorTypes.Group?e("AccountGroup",{attrs:{title:t.t("photos","Group")}}):t._e(),e("NcButton",{attrs:{type:"tertiary","aria-label":t.t("photos","Remove {collaboratorLabel} from the collaborators list",{collaboratorLabel:t.availableCollaborators[o].label})},on:{click:function(l){return t.unselectEntity(o)}}},[e("Close",{attrs:{slot:"icon",size:20},slot:"icon"})],1)],1)],1)}),0),e("div",{staticClass:"actions"},[t.allowPublicLink?e("div",{staticClass:"actions__public-link"},[t.isPublicLinkSelected&&t.publicLink.id!==""?[e("NcButton",{staticClass:"manage-collaborators__public-link-button",attrs:{"aria-label":t.t("photos","Copy the public link"),title:t.publicLinkURL},on:{click:t.copyPublicLink},scopedSlots:t._u([{key:"icon",fn:function(){return[t.publicLinkCopied?e("Check"):e("ContentCopy")]},proxy:!0}],null,!1,845538853)},[t.publicLinkCopied?[t._v(" "+t._s(t.t("photos","Public link copied!"))+" ")]:[t._v(" "+t._s(t.t("photos","Copy public link"))+" ")]],2),e("NcButton",{attrs:{type:"tertiary","aria-label":t.t("photos","Delete the public link")},on:{click:t.deletePublicLink}},[e("Close",{attrs:{slot:"icon"},slot:"icon"})],1)]:e("NcButton",{staticClass:"manage-collaborators__public-link-button",attrs:{disabled:t.isPublicLinkSelected&&t.publicLink.id==="","aria-label":t.t("photos","Create public link share")},on:{click:t.createPublicLinkForAlbum}},[e("Earth",{attrs:{slot:"icon"},slot:"icon"}),t._v(" "+t._s(t.t("photos","Share via public link"))+" ")],1)],2):t._e(),e("div",{staticClass:"actions__slot"},[t._t("default",null,{collaborators:t.selectedCollaborators})],2)])])},Ft=[],wt=r(At,kt,Ft,!1,null,"13596046");const q=wt.exports,St={name:"AlbumForm",components:{MapMarker:y,AccountMultiplePlus:pt,Send:ht,NcButton:m,NcLoadingIcon:v,NcTextField:Z,CollaboratorsSelectionForm:q},props:{album:{type:Object,default:null},displayBackButton:{type:Boolean,default:!1}},data(){return{showCollaboratorView:!1,albumName:"",albumLocation:"",loading:!1}},computed:{editMode(){return this.album!==null},sharingEnabled(){return OC.Share!==void 0},albumFileName(){return this.$store.getters.getAlbumName(this.albumName)}},mounted(){this.editMode&&(this.albumName=this.album.basename,this.albumLocation=this.album.location??""),this.$nextTick(()=>{this.$refs.nameInput.$el.getElementsByTagName("input")[0].focus()})},methods:{...b(["createCollection","renameCollection","updateCollection"]),submit(t=[]){this.albumName===""||this.loading||(this.editMode?this.handleUpdateAlbum():this.handleCreateAlbum(t))},async handleCreateAlbum(t=[]){try{this.loading=!0;let e=await this.createCollection({collection:{basename:this.albumName,filename:this.albumFileName,nbItems:0,location:this.albumLocation,lastPhoto:-1,date:tt().format("MMMM YYYY"),collaborators:t,source:E(`dav/${this.albumFileName}`)}});if(e===void 0)return;(this.albumLocation!==""||t.length!==0)&&(e=await this.updateCollection({collectionFileName:this.albumFileName,properties:{location:this.albumLocation,collaborators:t}})),this.$emit("done",{album:e})}finally{this.loading=!1}},async handleUpdateAlbum(){try{this.loading=!0;let t={...this.album};this.album.basename!==this.albumName&&(t=await this.renameCollection({collectionFileName:this.album.filename,newBaseName:this.albumName})),this.album.location!==this.albumLocation&&(t=await this.updateCollection({collectionFileName:t.filename,properties:{location:this.albumLocation}})),this.$emit("done",{album:t})}finally{this.loading=!1}},back(){this.$emit("back")},t:n}};var $t=function(){var t=this,e=t._self._c;return t.showCollaboratorView?e("CollaboratorsSelectionForm",{attrs:{"album-name":t.albumName,"allow-public-link":!1},scopedSlots:t._u([{key:"default",fn:function({collaborators:o}){return[e("span",{staticClass:"left-buttons"},[e("NcButton",{attrs:{type:"tertiary"},on:{click:function(l){t.showCollaboratorView=!1}}},[t._v(" "+t._s(t.t("photos","Back"))+" ")])],1),e("span",{staticClass:"right-buttons"},[e("NcButton",{attrs:{type:"primary",disabled:t.albumName.trim()===""||t.loading},on:{click:function(l){return t.submit(o)}},scopedSlots:t._u([{key:"icon",fn:function(){return[t.loading?e("NcLoadingIcon",{attrs:{size:20}}):e("Send",{attrs:{size:20}})]},proxy:!0}],null,!0)},[t._v(" "+t._s(t.editMode?t.t("photos","Save"):t.t("photos","Create album"))+" ")])],1)]}}])}):e("form",{staticClass:"album-form",on:{submit:function(o){return o.preventDefault(),t.submit.apply(null,arguments)}}},[e("div",{staticClass:"form-inputs"},[e("NcTextField",{ref:"nameInput",attrs:{value:t.albumName,type:"text",name:"name",required:!0,label:t.t("photos","Name of the album")},on:{"update:value":function(o){t.albumName=o}}}),e("NcTextField",{attrs:{value:t.albumLocation,name:"location",type:"text",label:t.t("photos","Location of the album")},on:{"update:value":function(o){t.albumLocation=o}},scopedSlots:t._u([{key:"default",fn:function(){return[e("MapMarker",{attrs:{size:20}})]},proxy:!0}],null,!1,2964444886)})],1),e("div",{staticClass:"form-buttons"},[e("span",{staticClass:"left-buttons"},[t.displayBackButton?e("NcButton",{attrs:{type:"tertiary"},on:{click:t.back}},[t._v(" "+t._s(t.t("photos","Back"))+" ")]):t._e()],1),e("span",{staticClass:"right-buttons"},[t.sharingEnabled&&!t.editMode?e("NcButton",{attrs:{type:"secondary",disabled:t.albumName.trim()===""||t.loading},on:{click:function(o){t.showCollaboratorView=!0}},scopedSlots:t._u([{key:"icon",fn:function(){return[e("AccountMultiplePlus",{attrs:{size:20}})]},proxy:!0}],null,!1,3656768963)},[t._v(" "+t._s(t.t("photos","Add collaborators"))+" ")]):t._e(),e("NcButton",{attrs:{type:"primary",disabled:t.albumName===""||t.loading},on:{click:function(o){return t.submit()}},scopedSlots:t._u([{key:"icon",fn:function(){return[t.loading?e("NcLoadingIcon",{attrs:{size:20}}):e("Send",{attrs:{size:20}})]},proxy:!0}],null,!1,2302891232)},[t._v(" "+t._s(t.editMode?t.t("photos","Save"):t.t("photos","Create album"))+" ")])],1)])])},Pt=[],Mt=r(St,$t,Pt,!1,null,"29b03159");const M=Mt.exports,Lt={name:"Albums",components:{Plus:_,FolderMultipleImage:V,NcModal:O,NcButton:m,NcEmptyContent:d,CollectionsList:j,CollectionCover:D,HeaderNavigation:h,AlbumForm:M},filters:{coverUrl(t){return t===-1?"":u(`/apps/photos/api/v1/preview/${t}?x=512&y=512`)}},mixins:[S],setup(){return{isMobile:et()}},data(){return{showAlbumCreationForm:!1}},computed:{albums(){return this.$store.getters.albums}},async beforeMount(){this.fetchAlbums()},methods:{fetchAlbums(){this.fetchCollections(`/photos/${i()?.uid}/albums`,["<nc:location />","<nc:dateRange />","<nc:collaborators />"])},handleAlbumCreated({album:t}){this.showAlbumCreationForm=!1,this.$router.push(`albums/${t.basename}`)},t:n,n:A}};var xt=function(){var t=this,e=t._self._c;return e("div",[e("CollectionsList",{staticClass:"albums-list",attrs:{collections:t.albums,loading:t.loadingCollections,error:t.errorFetchingCollections},scopedSlots:t._u([{key:"default",fn:function({collection:o}){return e("CollectionCover",{key:o.basename,attrs:{link:`/albums/${o.basename}`,"alt-img":t.t("photos","Cover photo for album {albumName}",{albumName:o.basename}),"cover-url":t._f("coverUrl")(o.lastPhoto)}},[e("span",{staticClass:"album__name"},[t._v(" "+t._s(o.basename)+" ")]),e("div",{staticClass:"album__details",attrs:{slot:"subtitle"},slot:"subtitle"},[t._v(" "+t._s(o.date)+" ⸱ "+t._s(t.n("photos","%n item","%n photos and videos",o.nbItems))+" ")])])}}])},[e("HeaderNavigation",{key:"navigation",attrs:{slot:"header",loading:t.loadingCollections,title:t.t("photos","Albums"),"root-title":t.t("photos","Albums")},on:{refresh:t.fetchAlbums},slot:"header"},[e("NcButton",{attrs:{"aria-label":t.isMobile?t.t("photos","New album"):void 0},on:{click:function(o){t.showAlbumCreationForm=!0}},scopedSlots:t._u([{key:"icon",fn:function(){return[e("Plus",{attrs:{size:20}})]},proxy:!0},t.isMobile?null:{key:"default",fn:function(){return[t._v(" "+t._s(t.t("photos","New album"))+" ")]},proxy:!0}],null,!0)})],1),e("NcEmptyContent",{attrs:{slot:"empty-collections-list",name:t.t("photos","There is no album yet!")},slot:"empty-collections-list"},[e("FolderMultipleImage",{attrs:{slot:"icon"},slot:"icon"})],1)],1),t.showAlbumCreationForm?e("NcModal",{on:{close:function(o){t.showAlbumCreationForm=!1}}},[e("h2",{staticClass:"album-creation__heading"},[t._v(" "+t._s(t.t("photos","New album"))+" ")]),e("AlbumForm",{on:{done:t.handleAlbumCreated}})],1):t._e()],1)},It=[],Bt=r(Lt,xt,It,!1,null,"eea32f26");const Tt=Bt.exports,pe=Object.freeze(Object.defineProperty({__proto__:null,default:Tt},Symbol.toStringTag,{value:"Module"})),Et={name:"AlbumContent",components:{ActionFavorite:ct,AlbumForm:M,Close:P,CollaboratorsSelectionForm:q,CollectionContent:$,Delete:Y,PhotosPicker:K,HeaderNavigation:h,ImagePlus:G,MapMarker:y,NcActionButton:U,NcActions:F,NcActionSeparator:R,NcButton:m,NcDialog:ot,NcEmptyContent:d,NcLoadingIcon:v,NcModal:O,Pencil:ft,Plus:_,ShareVariant:Ct},mixins:[g,H,k],props:{albumName:{type:String,default:"/"}},data(){return{showAddPhotosModal:!1,showManageCollaboratorView:!1,showEditAlbumForm:!1,loadingAddCollaborators:!1}},computed:{album(){return this.$store.getters.getAlbum(this.albumName)},albumFileIds(){return this.$store.getters.getAlbumFiles(this.albumName)},sharingEnabled(){return OC.Share!==void 0},albumFileName(){return this.$store.getters.getAlbumName(this.albumName)}},async mounted(){this.fetchAlbum(),this.fetchAlbumContent()},methods:{...b(["addFilesToCollection","removeFilesFromCollection","deleteCollection","updateCollection"]),async fetchAlbum(){await this.fetchCollection(this.albumFileName,["<nc:location />","<nc:dateRange />","<nc:collaborators />"])},async fetchAlbumContent(){await this.fetchCollectionFiles(this.albumFileName)},redirectToNewName({album:t}){this.showEditAlbumForm=!1,this.album.basename!==t.basename&&this.$router.push(`/albums/${t.basename}`)},async handleFilesPicked(t){this.showAddPhotosModal=!1,await this.addFilesToCollection({collectionFileName:this.album.filename,fileIdsToAdd:t}),await this.fetchAlbumContent()},async handleRemoveFilesFromAlbum(t){this.$refs.collectionContent.onUncheckFiles(t),await this.removeFilesFromCollection({collectionFileName:this.album.filename,fileIdsToRemove:t})},async handleDeleteAlbum(){await this.deleteCollection({collectionFileName:this.album.filename}),this.$router.push("/albums")},async handleSetCollaborators(t){try{this.loadingAddCollaborators=!0,this.showManageCollaboratorView=!1,await this.updateCollection({collectionFileName:this.album.filename,properties:{collaborators:t}})}catch(e){N.error("Error while setting album collaborators",{error:e})}finally{this.loadingAddCollaborators=!1}},t:n}};var Ot=function(){var t=this,e=t._self._c;return e("div",{staticClass:"album-container"},[e("CollectionContent",{ref:"collectionContent",attrs:{collection:t.album,"collection-file-ids":t.albumFileIds,loading:t.loadingCollection||t.loadingCollectionFiles,error:t.errorFetchingCollection||t.errorFetchingCollectionFiles},scopedSlots:t._u([{key:"header",fn:function({selectedFileIds:o,resetSelection:l}){return e("HeaderNavigation",{key:"navigation",attrs:{loading:t.loadingCollectionFiles,params:{albumName:t.albumName},path:"/"+t.albumName,title:t.albumName},on:{refresh:t.fetchAlbumContent}},[t.album!==void 0&&t.album.location!==""?e("div",{staticClass:"album__location",attrs:{slot:"subtitle"},slot:"subtitle"},[e("MapMarker"),t._v(t._s(t.album.location)+" ")],1):t._e(),e("template",{slot:"default"},[o.length>0?e("NcButton",{attrs:{"aria-label":t.t("photos","Unselect all")},on:{click:l},scopedSlots:t._u([{key:"icon",fn:function(){return[e("Close")]},proxy:!0}],null,!0)},[t._v(" "+t._s(t.t("photos","Unselect all"))+" ")]):t._e()],1),t.album!==void 0?e("template",{slot:"right"},[e("NcButton",{on:{click:function(c){t.showAddPhotosModal=!0}},scopedSlots:t._u([{key:"icon",fn:function(){return[e("Plus",{attrs:{size:20}})]},proxy:!0}],null,!0)},[t._v(" "+t._s(t.t("photos","Add photos to this album"))+" ")]),t.sharingEnabled?e("NcButton",{attrs:{type:"tertiary","aria-label":t.t("photos","Manage collaborators for this album")},on:{click:function(c){t.showManageCollaboratorView=!0}}},[e("ShareVariant",{attrs:{slot:"icon"},slot:"icon"})],1):t._e(),e("NcActions",{attrs:{"aria-label":t.t("photos","Open actions menu")}},[e("NcActionButton",{attrs:{"close-after-click":!0,"aria-label":t.t("photos","Edit album details")},on:{click:function(c){t.showEditAlbumForm=!0}}},[t._v(" "+t._s(t.t("photos","Edit album details"))+" "),e("Pencil",{attrs:{slot:"icon"},slot:"icon"})],1),e("NcActionButton",{attrs:{"close-after-click":!0},on:{click:t.handleDeleteAlbum}},[t._v(" "+t._s(t.t("photos","Delete album"))+" "),e("Delete",{attrs:{slot:"icon"},slot:"icon"})],1),o.length>0?[e("NcActionSeparator"),e("ActionFavorite",{attrs:{"selected-file-ids":o}}),e("NcActionButton",{attrs:{"close-after-click":!0},on:{click:function(c){return t.handleRemoveFilesFromAlbum(o)}}},[t._v(" "+t._s(t.t("photos","Remove selection from album"))+" "),e("Close",{attrs:{slot:"icon"},slot:"icon"})],1)]:t._e()],2)],1):t._e()],2)}}])},[t.album!==void 0&&t.album.nbItems===0&&!(t.loadingCollectionFiles||t.loadingCollection)?e("NcEmptyContent",{staticClass:"album__empty",attrs:{slot:"empty-content",name:t.t("photos","This album does not have any photos or videos yet!")},slot:"empty-content"},[e("ImagePlus",{attrs:{slot:"icon"},slot:"icon"}),e("NcButton",{staticClass:"album__empty__button",attrs:{slot:"action",type:"primary","aria-label":t.t("photos","Add photos to this album")},on:{click:function(o){t.showAddPhotosModal=!0}},slot:"action"},[e("Plus",{attrs:{slot:"icon"},slot:"icon"}),t._v(" "+t._s(t.t("photos","Add"))+" ")],1)],1):t._e()],1),t.album!==void 0?e("PhotosPicker",{attrs:{open:t.showAddPhotosModal,"blacklist-ids":t.albumFileIds,destination:t.album.basename,name:t.t("photos","Add photos to {albumName}",{albumName:t.albumName})},on:{"update:open":function(o){t.showAddPhotosModal=o},"files-picked":t.handleFilesPicked}}):t._e(),t.showManageCollaboratorView&&t.album!==void 0?e("NcModal",{attrs:{name:t.t("photos","Manage collaborators")},on:{close:function(o){t.showManageCollaboratorView=!1}}},[e("CollaboratorsSelectionForm",{attrs:{"album-name":t.album.basename,collaborators:t.album.collaborators},scopedSlots:t._u([{key:"default",fn:function({collaborators:o}){return[e("NcButton",{attrs:{"aria-label":t.t("photos","Save collaborators for this album."),type:"primary",disabled:t.loadingAddCollaborators},on:{click:function(l){return t.handleSetCollaborators(o)}},scopedSlots:t._u([{key:"icon",fn:function(){return[t.loadingAddCollaborators?e("NcLoadingIcon"):t._e()]},proxy:!0}],null,!0)},[t._v(" "+t._s(t.t("photos","Save"))+" ")])]}}],null,!1,507271420)})],1):t._e(),t.showEditAlbumForm?e("NcDialog",{attrs:{name:t.t("photos","Edit album details"),"close-on-click-outside":"",size:"normal"},on:{closing:function(o){t.showEditAlbumForm=!1}}},[e("AlbumForm",{attrs:{album:t.album},on:{done:t.redirectToNewName}})],1):t._e()],1)},Rt=[],Ut=r(Et,Ot,Rt,!1,null,"d94b69a4");const zt=Ut.exports,Ce=Object.freeze(Object.defineProperty({__proto__:null,default:zt},Symbol.toStringTag,{value:"Module"})),Dt={name:"SharedAlbums",components:{FolderMultipleImage:V,NcEmptyContent:d,CollectionsList:j,CollectionCover:D,HeaderNavigation:h,NcUserBubble:w},filters:{coverUrl(t){return t===-1?"":u(`/apps/photos/api/v1/preview/${t}?x=512&y=512`)},albumOriginalName(t){return t.basename.replace(new RegExp(`\\(${t.collaborators[0].id}\\)$`),"")}},mixins:[S],computed:{sharedAlbums(){return this.$store.getters.sharedAlbums}},async beforeMount(){this.fetchSharedAlbums()},methods:{fetchSharedAlbums(){this.fetchCollections(`/photos/${i()?.uid}/sharedalbums`,["<nc:location />","<nc:dateRange />","<nc:collaborators />"])},t:n,n:A}};var jt=function(){var t=this,e=t._self._c;return e("CollectionsList",{staticClass:"albums-list",attrs:{collections:t.sharedAlbums,loading:t.loadingCollections,error:t.errorFetchingCollections},scopedSlots:t._u([{key:"default",fn:function({collection:o}){return e("CollectionCover",{key:o.basename,attrs:{link:`/sharedalbums/${o.basename}`,"alt-img":t.t("photos","Cover photo for shared album {albumName}",{albumName:o.basename}),"data-test":o.basename,"cover-url":t._f("coverUrl")(o.lastPhoto)}},[e("span",{staticClass:"album__name"},[t._v(" "+t._s(t._f("albumOriginalName")(o))+" ")]),e("div",{staticClass:"album__details",attrs:{slot:"subtitle"},slot:"subtitle"},[t._v(" "+t._s(o.date)+" ⸱ "+t._s(t.n("photos","%n item","%n photos and videos",o.nbItems))+" "),e("br"),t._v(" "+t._s(t.t("photos","Shared by"))+" "),e("NcUserBubble",{attrs:{"display-name":o.collaborators[0].label,user:o.collaborators[0].id}})],1)])}}])},[e("HeaderNavigation",{key:"navigation",attrs:{slot:"header",loading:t.loadingCollections,title:t.t("photos","Collaborative albums"),"root-title":t.t("photos","Collaborative albums")},on:{refresh:t.fetchSharedAlbums},slot:"header"}),e("NcEmptyContent",{attrs:{slot:"empty-collections-list",name:t.t("photos","There is no album yet!")},slot:"empty-collections-list"},[e("FolderMultipleImage",{attrs:{slot:"icon"},slot:"icon"})],1)],1)},Ht=[],Kt=r(Dt,jt,Ht,!1,null,"1822ab8c");const Vt=Kt.exports,fe=Object.freeze(Object.defineProperty({__proto__:null,default:Vt},Symbol.toStringTag,{value:"Module"})),Gt={name:"SharedAlbumContent",components:{MapMarker:y,Plus:_,Close:P,Delete:Y,ImagePlus:G,NcEmptyContent:d,NcActions:F,NcActionButton:U,NcActionSeparator:R,NcButton:m,NcUserBubble:w,CollectionContent:$,PhotosPicker:K,HeaderNavigation:h},mixins:[g,H,k],props:{albumName:{type:String,default:"/"}},data(){return{showAddPhotosModal:!1,loadingCount:0,loadingAddFilesToAlbum:!1,collaboratorTypes:lt}},computed:{...z(["files","sharedAlbumsFiles"]),album(){return this.$store.getters.getSharedAlbum(this.albumName)},albumFileIds(){return this.$store.getters.getSharedAlbumFiles(this.albumName)},albumOriginalName(){return this.albumName.replace(new RegExp(`\\(${this.album.collaborators[0].id}\\)$`),"")},albumFileName(){return this.$store.getters.getSharedAlbumName(this.albumName)}},async mounted(){this.fetchAlbum(),this.fetchAlbumContent()},methods:{...b(["addFilesToCollection","removeFilesFromCollection","deleteCollection"]),async fetchAlbum(){await this.fetchCollection(this.albumFileName,["<nc:location />","<nc:dateRange />","<nc:collaborators />"])},async fetchAlbumContent(){await this.fetchCollectionFiles(this.albumFileName)},async handleFilesPicked(t){this.showAddPhotosModal=!1,await this.addFilesToCollection({collectionFileName:this.album.filename,fileIdsToAdd:t}),await this.fetchAlbumContent()},async handleRemoveFilesFromAlbum(t){this.$refs.collectionContent.onUncheckFiles(t),await this.removeFilesFromCollection({collectionFileName:this.album.filename,fileIdsToRemove:t})},async handleDeleteAlbum(){await this.deleteCollection({collectionFileName:this.album.filename}),this.$router.push("/sharedalbums")},t:n}};var Yt=function(){var t=this,e=t._self._c;return e("div",[e("CollectionContent",{ref:"collectionContent",attrs:{collection:t.album,"collection-file-ids":t.albumFileIds,loading:t.loadingCollection||t.loadingCollectionFiles,error:t.errorFetchingCollection||t.errorFetchingCollectionFiles},scopedSlots:t._u([{key:"header",fn:function({selectedFileIds:o,resetSelection:l}){return e("HeaderNavigation",{key:"navigation",attrs:{loading:t.loadingCollectionFiles,params:{albumName:t.albumName},path:"/"+t.albumName,title:t.albumOriginalName},on:{refresh:t.fetchAlbumContent}},[t.album!==void 0&&t.album.location!==""?e("div",{staticClass:"album__location",attrs:{slot:"subtitle"},slot:"subtitle"},[e("MapMarker"),t._v(t._s(t.album.location)+" ⸱ "+t._s(t.t("photos","Shared by"))+" "),e("NcUserBubble",{attrs:{"display-name":t.album.collaborators[0].label,user:t.album.collaborators[0].id}})],1):t._e(),e("template",{slot:"default"},[o.length>0?e("NcButton",{attrs:{"aria-label":t.t("photos","Unselect all")},on:{click:l},scopedSlots:t._u([{key:"icon",fn:function(){return[e("Close")]},proxy:!0}],null,!0)},[t._v(" "+t._s(t.t("photos","Unselect all"))+" ")]):t._e()],1),t.album!==void 0?e("template",{slot:"right"},[t.album.nbItems!==0?e("NcButton",{attrs:{type:"secondary","aria-label":t.t("photos","Add photos to this album")},on:{click:function(c){t.showAddPhotosModal=!0}}},[e("Plus",{attrs:{slot:"icon"},slot:"icon"}),t._v(" "+t._s(t.t("photos","Add"))+" ")],1):t._e(),e("NcActions",{attrs:{"force-menu":!0,"aria-label":t.t("photos","Open actions menu")}},[t.album.collaborators[0].type===t.collaboratorTypes.SHARE_TYPE_USER?e("NcActionButton",{attrs:{"close-after-click":!0},on:{click:t.handleDeleteAlbum}},[t._v(" "+t._s(t.t("photos","Delete album"))+" "),e("Delete",{attrs:{slot:"icon"},slot:"icon"})],1):t._e(),o.length>0?[e("NcActionSeparator"),e("NcActionButton",{attrs:{"close-after-click":!0},on:{click:function(c){return t.handleRemoveFilesFromAlbum(o)}}},[t._v(" "+t._s(t.t("photos","Remove selection from album"))+" "),e("Close",{attrs:{slot:"icon"},slot:"icon"})],1)]:t._e()],2)],1):t._e()],2)}}],null,!1,3150708226)},[t.album!==void 0&&t.album.nbItems===0&&!(t.loadingCollectionFiles||t.loadingCollection)?e("NcEmptyContent",{staticClass:"album__empty",attrs:{slot:"empty-content",name:t.t("photos","This album does not have any photos or videos yet!")},slot:"empty-content"},[e("ImagePlus",{attrs:{slot:"icon"},slot:"icon"}),e("NcButton",{staticClass:"album__empty__button",attrs:{slot:"action",type:"primary","aria-label":t.t("photos","Add photos to this album")},on:{click:function(o){t.showAddPhotosModal=!0}},slot:"action"},[e("Plus",{attrs:{slot:"icon"},slot:"icon"}),t._v(" "+t._s(t.t("photos","Add"))+" ")],1)],1):t._e()],1),e("PhotosPicker",{attrs:{open:t.showAddPhotosModal,name:t.t("photos","Add photos to {albumName}",{albumName:t.albumOriginalName}),destination:t.album.basename,"blacklist-ids":t.albumFileIds,loading:t.loadingAddFilesToAlbum},on:{"update:open":function(o){t.showAddPhotosModal=o},"files-picked":t.handleFilesPicked}})],1)},qt=[],Wt=r(Gt,Yt,qt,!1,null,"189e18ed");const Jt=Wt.exports,ge=Object.freeze(Object.defineProperty({__proto__:null,default:Jt},Symbol.toStringTag,{value:"Module"})),Qt={name:"PublicAlbumContent",components:{MapMarker:y,ImageOff:gt,NcEmptyContent:d,NcActions:F,CollectionContent:$,HeaderNavigation:h},mixins:[g,k],props:{token:{type:String,required:!0}},data(){return{showAddPhotosModal:!1,loadingCount:0,loadingAddFilesToAlbum:!1,albumOriginalName:"",publicClient:at(E("dav"),{Authorization:`Basic ${btoa(`${this.token}:`)}`})}},computed:{album(){return this.$store.getters.getPublicAlbum(this.albumName)},albumName(){return this.token},albumFileIds(){return this.$store.getters.getPublicAlbumFiles(this.albumName)},publicAlbumFileName(){return this.$store.getters.getPublicAlbumName(this.albumName)}},async beforeMount(){await this.fetchAlbumInfo(),await this.fetchAlbumContent()},methods:{...b(["appendFiles","addCollection","addFilesToCollection","removeFilesFromCollection"]),async fetchAlbumInfo(){const t=await this.fetchCollection(`/photospublic/${this.token}`,["<nc:location />","<nc:dateRange />","<nc:collaborators />","<nc:original-name />"],this.publicClient);this.albumOriginalName=t.originalName},async fetchAlbumContent(){await this.fetchCollectionFiles(`/photospublic/${this.token}`,["<nc:location />","<nc:dateRange />","<nc:collaborators />","<nc:original-name />"],this.publicClient,[t=>({...t,previewUrl:u(`/apps/photos/api/v1/publicPreview/${t.fileid}?x=2048&y=2048&token=${this.token}`),hasPreview:!1})])},async handleFilesPicked(t){this.showAddPhotosModal=!1,await this.addFilesToCollection({collectionFileName:this.albumName,fileIdsToAdd:t}),await this.fetchAlbumContent()},async handleRemoveFilesFromAlbum(t){this.$refs.collectionContent.onUncheckFiles(t),await this.removeFilesFromCollection({collectionFileName:this.albumName,fileIdsToRemove:t})},t:n}};var Xt=function(){var t=this,e=t._self._c;return e("div",[e("CollectionContent",{ref:"collectionContent",attrs:{collection:t.album,"collection-file-ids":t.albumFileIds,"allow-selection":!1,loading:t.loadingCollection||t.loadingCollectionFiles,error:t.errorFetchingCollection||t.errorFetchingCollectionFiles},scopedSlots:t._u([{key:"header",fn:function({selectedFileIds:o}){return t.albumOriginalName!==""?e("HeaderNavigation",{key:"navigation",attrs:{loading:t.loadingCollection||t.loadingCollectionFiles,params:{token:t.token},path:"/","root-title":t.albumOriginalName,title:t.albumOriginalName},on:{refresh:t.fetchAlbumContent}},[t.album.location!==""?e("div",{staticClass:"album__location",attrs:{slot:"subtitle"},slot:"subtitle"},[e("MapMarker"),t._v(t._s(t.album.location)+" ")],1):t._e(),t.album!==void 0?e("template",{slot:"right"},[e("NcActions",{attrs:{"force-menu":!0,"aria-label":t.t("photos","Open actions menu")}},[o.length>0?void 0:t._e()],2)],1):t._e()],2):t._e()}}],null,!0)},[e("NcEmptyContent",{staticClass:"album__empty",attrs:{slot:"empty-content",name:t.t("photos","This album does not have any photos or videos yet!")},slot:"empty-content"},[e("ImageOff",{attrs:{slot:"icon"},slot:"icon"})],1)],1)],1)},Zt=[],te=r(Qt,Xt,Zt,!1,null,"bcb74d89");const ee=te.exports,ye=Object.freeze(Object.defineProperty({__proto__:null,default:ee},Symbol.toStringTag,{value:"Module"})),oe={name:"AlbumPicker",components:{Plus:_,ImageMultiple:yt,NcButton:m,NcListItem:st,NcLoadingIcon:v,NcUserBubble:w,AlbumForm:M},filters:{toCoverUrl(t){return u(`/apps/photos/api/v1/preview/${t}?x=64&y=64`)}},mixins:[S],data(){return{showAlbumCreationForm:!1}},computed:{...z(["albums","sharedAlbums"]),allAlbums(){return[...Object.values(this.albums),...Object.values(this.sharedAlbums)]}},mounted(){this.fetchAlbumList()},methods:{async fetchAlbumList(){await this.fetchCollections(`/photos/${i()?.uid}/albums`,["<nc:location />","<nc:dateRange />","<nc:collaborators />"]),await this.fetchCollections(`/photos/${i()?.uid}/sharedalbums`,["<nc:location />","<nc:dateRange />","<nc:collaborators />"])},albumCreatedHandler(){this.showAlbumCreationForm=!1,this.fetchAlbumList()},pickAlbum(t){this.$emit("album-picked",t)},isSharedAlbum(t){return t.filename.match(/^\/photos\/.+\/sharedalbums\//)!==null},originalName(t){return this.isSharedAlbum(t)?t.basename.replace(new RegExp(`\\(${t.collaborators[0].id}\\)$`),""):t.basename},t:n,n:A}};var le=function(){var t=this,e=t._self._c;return t.showAlbumCreationForm?e("AlbumForm",{attrs:{"display-back-button":!0,title:t.t("photos","New album")},on:{back:function(o){t.showAlbumCreationForm=!1},done:t.albumCreatedHandler}}):e("div",{staticClass:"album-picker"},[e("h2",[t._v(" "+t._s(t.t("photos","Add to Album"))+" "),t.loadingCollections?e("NcLoadingIcon",{staticClass:"loading-icon"}):t._e()],1),e("ul",{staticClass:"albums-container"},t._l(t.allAlbums,function(o){return e("NcListItem",{key:o.filename,staticClass:"album",attrs:{name:t.originalName(o),"aria-label":t.t("photos","Add selection to album {albumName}",{albumName:o.basename})},on:{click:function(l){return t.pickAlbum(o)}},scopedSlots:t._u([{key:"subname",fn:function(){return[t._v(" "+t._s(t.n("photos","%n item","%n photos and videos",o.nbItems))+" "),t.isSharedAlbum(o)?[t._v(" ⸱ "+t._s(t.t("photos","Shared by"))+" "),e("NcUserBubble",{attrs:{"display-name":o.collaborators[0].label,user:o.collaborators[0].id}})]:t._e()]},proxy:!0}],null,!0)},[e("template",{slot:"icon"},[o.lastPhoto!==-1?e("img",{staticClass:"album__image",attrs:{src:t._f("toCoverUrl")(o.lastPhoto)}}):e("div",{staticClass:"album__image album__image--placeholder"},[e("ImageMultiple",{attrs:{size:32}})],1)])],2)}),1),e("NcButton",{staticClass:"new-album-button",attrs:{"aria-label":t.t("photos","Create a new album."),type:"tertiary"},on:{click:function(o){t.showAlbumCreationForm=!0}},scopedSlots:t._u([{key:"icon",fn:function(){return[e("Plus")]},proxy:!0}],null,!1,1489515321)},[t._v(" "+t._s(t.t("photos","Create new album"))+" ")])],1)},ae=[],se=r(oe,le,ae,!1,null,"3a655082");const _e=se.exports;export{_e as A,ye as P,fe as S,me as a,M as b,pe as c,Ce as d,ge as e,he as g,be as p,de as s};
//# sourceMappingURL=albums-CeDjJMgY.chunk.mjs.map

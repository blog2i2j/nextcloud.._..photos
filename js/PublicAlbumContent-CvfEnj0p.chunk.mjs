import{j as i,M as l,n as a}from"./icons-CCMXs15V.chunk.mjs";import"./NcActionButton-Gpv56vuS-DwokBgrB.chunk.mjs";import"./index-BKOSQir6.chunk.mjs";import"./Tooltip-Bzn-7vu5.chunk.mjs";import"./NcProgressBar-DegJ2JjE-CMVvcGKc.chunk.mjs";import"./NcAvatar-Db8tkJt9-RDXKOt7x.chunk.mjs";import{q as n}from"./index-CtBKWcPT.chunk.mjs";import"./NcAppSettingsSection-Bl2-D3_g-Bx19lXF_.chunk.mjs";import{t as s,_ as r,G as m,Z as c}from"./vue.runtime.esm-DZVHDHac.chunk.mjs";import"./logger-D3RVzcfQ-BGZwsZPf.chunk.mjs";import"./useHotKey-CUZeWrE9.chunk.mjs";import"./NcCheckboxRadioSwitch-Di9rSADK-D02oVeZo.chunk.mjs";import"./NcListItem-DfaWGP5A-C0e3F2z_.chunk.mjs";import"./NcDateTime-BR6BBvML-BOyii8_u.chunk.mjs";import"./NcSelect-TmGBPLzc-zzm4Fa4O.chunk.mjs";import{N as p}from"./NcEmptyContent-BKTjF0KK.chunk.mjs";import"./NcTextField-DRANdaIf-B2wZmHTG.chunk.mjs";import"./NcUserBubble-cO5krePG-B1PNEIxd.chunk.mjs";import{i as u}from"./isMobile-CljHwdZ_.chunk.mjs";import{C as h}from"./CollectionContent-DQbgq0lb.chunk.mjs";import{H as b}from"./HeaderNavigation-CwzaZBcO.chunk.mjs";import{F as d}from"./FetchCollectionContentMixin-D1PObkyx.chunk.mjs";import"./preload-helper-Dh9HmuEY.chunk.mjs";import"./useModelMigration-EhAWvqDD-C-Iitg9F.chunk.mjs";import"./index-C7x2K0nC.chunk.mjs";import"./index-SCFTKIaY.chunk.mjs";import"./ChevronDown-DFQfzh63-CmnU8nt7.chunk.mjs";import"./NcDialog-D2lwwZL--BBju5KIU.chunk.mjs";import"./FilesListViewer-CSyzVtfF.chunk.mjs";import"./fileFetcher-C2yJxIXc.chunk.mjs";import"./File-CG4Zx0yL.chunk.mjs";import"./AbortControllerMixin-BHckU111.chunk.mjs";import"./collectionFetcher-CZgqdVWX.chunk.mjs";const f={name:"PublicAlbumContent",components:{MapMarker:l,ImageOff:i,NcEmptyContent:p,NcActions:n,CollectionContent:h,HeaderNavigation:b},mixins:[d,u],props:{token:{type:String,required:!0}},data(){return{showAddPhotosModal:!1,loadingCount:0,loadingAddFilesToAlbum:!1,albumOriginalName:"",publicClient:m(c("dav"),{Authorization:`Basic ${btoa(`${this.token}:`)}`})}},computed:{album(){return this.$store.getters.getPublicAlbum(this.albumName)},albumName(){return this.token},albumFileIds(){return this.$store.getters.getPublicAlbumFiles(this.albumName)},publicAlbumFileName(){return this.$store.getters.getPublicAlbumName(this.albumName)}},async beforeMount(){await this.fetchAlbumInfo(),await this.fetchAlbumContent()},methods:{async fetchAlbumInfo(){const t=await this.fetchCollection(`/photospublic/${this.token}`,["<nc:location />","<nc:dateRange />","<nc:collaborators />","<nc:original-name />"],this.publicClient);this.albumOriginalName=t.attributes["original-name"]},async fetchAlbumContent(){(await this.fetchCollectionFiles(`/photospublic/${this.token}`,["<nc:location />","<nc:dateRange />","<nc:collaborators />","<nc:original-name />"],this.publicClient)).forEach(t=>{t.update({previewUrl:r(`/apps/photos/api/v1/publicPreview/${t.fileid}?x=2048&y=2048&token=${this.token}`),hasPreview:!1})})},async handleFilesPicked(t){this.showAddPhotosModal=!1,await this.$store.dispatch("addFilesToCollection",{collectionFileName:this.album.root+this.albumName,fileIdsToAdd:t}),await this.fetchAlbumContent()},async handleRemoveFilesFromAlbum(t){this.$refs.collectionContent.onUncheckFiles(t),await this.$store.dispatch("removeFilesFromCollection",{collectionFileName:this.album.root+this.albumName,fileIdsToRemove:t})},t:s}};var g=function(){var t=this,o=t._self._c;return o("div",[o("CollectionContent",{ref:"collectionContent",attrs:{collection:t.album,"collection-file-ids":t.albumFileIds,"allow-selection":!1,loading:t.loadingCollection||t.loadingCollectionFiles,error:t.errorFetchingCollection||t.errorFetchingCollectionFiles},scopedSlots:t._u([{key:"header",fn:function({selectedFileIds:e}){return t.albumOriginalName!==""?o("HeaderNavigation",{key:"navigation",attrs:{loading:t.loadingCollection||t.loadingCollectionFiles,params:{token:t.token},path:"/","root-title":t.albumOriginalName,title:t.albumOriginalName},on:{refresh:t.fetchAlbumContent}},[t.album.attributes.location!==""?o("div",{staticClass:"album__location",attrs:{slot:"subtitle"},slot:"subtitle"},[o("MapMarker"),t._v(t._s(t.album.attributes.location)+" ")],1):t._e(),t.album!==void 0?o("template",{slot:"right"},[o("NcActions",{attrs:{"force-menu":!0,"aria-label":t.t("photos","Open actions menu")}},[e.length>0?void 0:t._e()],2)],1):t._e()],2):t._e()}}],null,!0)},[o("NcEmptyContent",{staticClass:"album__empty",attrs:{slot:"empty-content",name:t.t("photos","This album does not have any photos or videos yet!")},slot:"empty-content"},[o("ImageOff",{attrs:{slot:"icon"},slot:"icon"})],1)],1)],1)},C=[],F=a(f,g,C,!1,null,"359fd11f");const Y=F.exports;export{Y as default};
//# sourceMappingURL=PublicAlbumContent-CvfEnj0p.chunk.mjs.map

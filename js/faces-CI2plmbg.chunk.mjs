import{g as c,t as l,s as p,V as u,m as w,r as f,y as g,_ as J,e as M,i as b,b as G,l as A,p as x,o as B}from"./vendor-DOPpmdjb.chunk.mjs";import{h as d,l as i,S,i as H,j as y,g as $,n as m,d as T,k as R,m as D,o as O}from"./photos-main.mjs";import{h as K,i as z,j as L,k as U,l as Q,S as W,m as E,b as X,n as j,o as V,e as Y}from"./icons-Ba8uv1cK.chunk.mjs";import"./photos-sidebar.mjs";import"./tags-C9uqs7-N.chunk.mjs";const C={faces:{},facesFiles:{},unassignedFiles:[],unassignedFilesCount:0},Z={addFaces(e,{faces:t}){for(const s of t)u.set(e.faces,s.basename,s)},removeFaces(e,{faceNames:t}){t.forEach(s=>u.delete(e.faces,s)),t.forEach(s=>u.delete(e.facesFiles,s))},addFilesToFace(e,{faceName:t,fileIdsToAdd:s}){e.facesFiles[t]||u.set(e.facesFiles,t,[]);const a=e.facesFiles[t];a.push(...s.filter(o=>!a.includes(o)))},addUnassignedFiles(e,{fileIdsToAdd:t}){e.unassignedFiles||(e.unassignedFiles=[]);const s=e.unassignedFiles;s.push(...t.filter(a=>!s.includes(a)))},removeUnassignedFile(e,{fileIdsToRemove:t}){e.unassignedFiles=e.unassignedFiles.filter(s=>!t.includes(s))},removeFilesFromFace(e,{faceName:t,fileIdsToRemove:s}){u.set(e.facesFiles,t,e.facesFiles[t].filter(a=>!s.includes(a)))},setUnassignedFilesCount(e,t){e.unassignedFilesCount=t}},ee={faces:e=>e.faces,facesFiles:e=>e.facesFiles,unassignedFiles:e=>e.unassignedFiles,unassignedFilesCount:e=>e.unassignedFilesCount},te={addFaces(e,{faces:t}){e.commit("addFaces",{faces:t})},async moveFilesToFace(e,{oldFace:t,faceName:s,fileIdsToMove:a}){const o=new S(5),n=a.map(async r=>{const v=e.getters.files[r],h=v.basename,I=await o.acquire();try{await d.moveFile(t?`/recognize/${c()?.uid}/faces/${t}/${h}`:`/recognize/${c()?.uid}/unassigned-faces/${h}`,`/recognize/${c()?.uid}/faces/${s}/${h}`),v.faceDetections.find(_=>_.title===t).title=s,await e.commit("addFilesToFace",{faceName:s,fileIdsToAdd:[r]}),t?await e.commit("removeFilesFromFace",{faceName:t,fileIdsToRemove:[r]}):await e.commit("removeUnassignedFile",{fileIdsToRemove:[r]}),o.release(I)}catch(_){throw i.error(l("photos","Failed to move {fileBaseName} to person {faceName}",{fileBaseName:h,faceName:s}),{error:_}),p(l("photos","Failed to move {fileBaseName} to person {faceName}",{fileBaseName:h,faceName:s})),o.release(I),_}});return Promise.all(n)},async removeFilesFromFace(e,{faceName:t,fileIdsToRemove:s}){const a=new S(5);await e.commit("removeFilesFromFace",{faceName:t,fileIdsToRemove:s});const o=s.map(async n=>{const r=e.getters.files[n].basename,v=await a.acquire();try{await d.deleteFile(`/recognize/${c()?.uid}/faces/${t}/${r}`)}catch(h){e.commit("addFilesToFace",{faceName:t,fileIdsToAdd:[n]}),i.error(l("photos","Failed to remove {fileBaseName}",{fileBaseName:r}),{error:h}),p(l("photos","Failed to remove {fileBaseName}",{fileBaseName:r}))}finally{a.release(v)}});return Promise.all(o)},async renameFace(e,{oldName:t,faceName:s}){let a=C.faces[t];try{if(C.faces[s])throw new Error("Name already exists");await d.moveFile(`/recognize/${c()?.uid}/faces/${t}`,`/recognize/${c()?.uid}/faces/${s}`),e.commit("removeFaces",{faceNames:[t]}),a={...a,basename:s},e.commit("addFaces",{faces:[a]})}catch(o){throw i.error(l("photos","Failed to rename {oldName} to {faceName}",{oldName:t,faceName:s}),{error:o}),p(l("photos","Failed to rename {oldName} to {faceName}",{oldName:t,faceName:s})),o}},async deleteFace(e,{faceName:t}){try{await d.deleteFile(`/recognize/${c()?.uid}/faces/${t}`),e.commit("removeFaces",{faceNames:[t]})}catch(s){i.error(l("photos","Failed to delete {faceName}",{faceName:t}),{error:s}),p(l("photos","Failed to delete {faceName}",{faceName:t}))}}},De={state:C,mutations:Z,getters:ee,actions:te},N=["nc:face-detections","nc:face-preview-image","nc:realpath"],F={name:"FetchFacesMixin",data(){return{errorFetchingFaces:null,loadingFaces:!1,errorFetchingFiles:null,loadingFiles:!1}},mixins:[H],async beforeMount(){this.fetchFaces()},computed:{...f(["faces"])},methods:{...w(["appendFiles"]),async fetchFaces(){if(!this.loadingFaces&&!Object.keys(this.faces).length)try{this.loadingFaces=!0,this.errorFetchingFaces=null;const{data:e}=await d.getDirectoryContents(`/recognize/${c()?.uid}/faces/`,{data:y(N),details:!0,signal:this.abortController.signal});this.$store.dispatch("addFaces",{faces:e}),i.debug(`[FetchFacesMixin] Fetched ${e.length} new faces: `,{faces:e})}catch(e){e.response&&e.response.status&&(e.response.status===404?this.errorFetchingFaces=404:this.errorFetchingFaces=e),i.error(l("photos","Failed to fetch faces list."),{error:e}),p(l("photos","Failed to fetch faces list."))}finally{this.loadingFaces=!1}},async fetchFaceContent(e,t){if(!this.loadingFiles&&!(!t&&this.facesFiles[e]&&this.facesFiles[e].length))try{this.errorFetchingFiles=null,this.loadingFiles=!0;const{data:s}=await d.getDirectoryContents(`/recognize/${c()?.uid}/faces/${e}`,{data:y(N),details:!0,signal:this.abortController.signal}),a=s.map(n=>$(n)).map(n=>({...n,filename:g.decode(n.realpath).replace(`/${c()?.uid}/files`,`/files/${c()?.uid}`)})).map(n=>({...n,faceDetections:JSON.parse(g.decode(n.faceDetections))})),o=a.map(n=>""+n.fileid);this.appendFiles(a),a.length>0&&await this.$store.commit("addFilesToFace",{faceName:e,fileIdsToAdd:o}),i.debug(`[FetchFacesMixin] Fetched ${o.length} new files: `,{fileIds:o})}catch(s){s.response&&s.response.status&&(s.response.status===404?this.errorFetchingFiles=404:this.errorFetchingFiles=s),i.error("Error fetching face files",{error:s})}finally{this.loadingFiles=!1}},async fetchUnassignedFaces(e){if(!this.loadingFiles&&!(!e&&this.unassignedFiles&&this.unassignedFiles.length))try{this.errorFetchingFiles=null,this.loadingFiles=!0;const{data:t}=await d.getDirectoryContents(`/recognize/${c()?.uid}/unassigned-faces`,{data:y(N),details:!0,signal:this.abortController.signal}),s=t.map(o=>$(o)).map(o=>({...o,filename:g.decode(o.realpath).replace(`/${c()?.uid}/files`,`/files/${c()?.uid}`)})).map(o=>({...o,faceDetections:JSON.parse(g.decode(o.faceDetections))})),a=s.map(o=>""+o.fileid);this.appendFiles(s),s.length>0&&await this.$store.commit("addUnassignedFiles",{fileIdsToAdd:a}),i.debug(`[FetchFacesMixin] Fetched ${a.length} new unassigned files: `,{fileIds:a})}catch(t){t.response&&t.response.status&&(t.response.status===404?this.errorFetchingFiles=404:this.errorFetchingFiles=t),i.error("Error fetching unassigned files",{error:t})}finally{this.loadingFiles=!1}},async fetchUnassignedFacesCount(){try{const{data:e}=await d.stat(`/recognize/${c()?.uid}/unassigned-faces`,{data:y(N),details:!0,signal:this.abortController.signal}),t=Number(e.props?.nbItems);await this.$store.commit("setUnassignedFilesCount",t),i.debug("[FetchFacesMixin] Fetched unassigned files count: ",{count:t})}catch(e){i.error("Error fetching unassigned files count",{error:e})}}}},k={name:"FaceCoverMixin",computed:{...f(["faces","facesFiles","files"])},methods:{getFaceCover(e){return JSON.parse(g.decode(this.faces[e].props["face-preview-image"]||"{}"))},getCoverStyle(e){const t=this.getFaceCover(e);if(!t||!t.detection)return{};const s=t.detection,a=Math.max(1,1/s.width*.4),o=(s.x+s.width/2)*100,n=(s.y+s.height/2)*100;return{width:"100%",transform:`translate(calc( var(--photos-face-width)/2 - ${o}% ), calc( var(--photos-face-width)/2 - ${n}% )) scale(${a})`,transformOrigin:`${o}% ${n}%`}}}},se={name:"FaceCover",mixins:[F,k],props:{baseName:{type:String,required:!0},small:{type:Boolean,default:!1}},data(){return{observer:null}},computed:{...f(["files","faces","facesFiles"]),face(){return this.faces[this.baseName]},coverUrl(){return this.cover?J(`/apps/photos/api/v1/preview/${this.cover.fileid}?x=512&y=512`):""},cover(){return this.getFaceCover(this.face.basename)},coverDimensions(){return this.cover?this.getCoverStyle(this.face.basename):{}}}};var ae=function(){var e=this,t=e._self._c;return t("div",{class:["face-cover",e.small&&"face-cover--small"],on:{click:function(s){return e.$emit("click")}}},[t("div",{staticClass:"face-cover__crop-container"},[t("img",{ref:"image",staticClass:"face-cover__image",style:e.coverDimensions,attrs:{src:e.coverUrl}})]),t("div",{staticClass:"face-cover__details"},[e.baseName.match(/^[0-9]+$/)?e._e():t("div",{staticClass:"face-cover__details__first-line"},[t("span",{staticClass:"face-cover__details__name"},[e._v(" "+e._s(e.baseName)+" ")])]),e.small?e._e():t("div",{staticClass:"face-cover__details__second-line"},[e._v(" "+e._s(e.n("photos","%n photos","%n photos",e.face.props.nbItems))+" ")])])])},oe=[],ie=m(se,ae,oe,!1,null,"232f1e9e");const P=ie.exports,ne={name:"UnassignedFacesCover",components:{AccountOffIcon:K},mixins:[F,k],props:{small:{type:Boolean,default:!1}},computed:{...f(["unassignedFilesCount"]),colorMainBackground(){return getComputedStyle(document.documentElement).getPropertyValue("--color-main-background")}},async mounted(){await this.fetchUnassignedFacesCount()}};var ce=function(){var e=this,t=e._self._c;return t("div",{class:["face-cover",e.small&&"face-cover--small"],on:{click:function(s){return e.$emit("click")}}},[t("div",{staticClass:"face-cover__crop-container"},[t("AccountOffIcon",{attrs:{size:"auto","fill-color":e.colorMainBackground}})],1),t("div",{staticClass:"face-cover__details"},[e.small?e._e():t("div",{staticClass:"face-cover__details__second-line"},[e._v(" "+e._s(e.n("photos","%n unassigned photo","%n unassigned photos",e.unassignedFilesCount))+" ")])])])},le=[],re=m(ne,ce,le,!1,null,"8b689a4b");const de=re.exports,fe={name:"Faces",components:{UnassignedFacesCover:de,FaceCover:P,NcEmptyContent:b,NcLoadingIcon:M,AccountBoxMultipleOutline:z},mixins:[F],computed:{...f(["facesFiles","unassignedFilesCount"]),noFaces(){return Object.keys(this.faces).length===0},orderedFaces(){return Object.values(this.faces).sort((e,t)=>e.props.nbItems&&t.props.nbItems?t.props.nbItems-e.props.nbItems:!this.facesFiles[t.basename]||!this.facesFiles[e.basename]?0:this.facesFiles[t.basename].length-this.facesFiles[e.basename].length)}}};var he=function(){var e=this,t=e._self._c;return e.errorFetchingFaces?t("NcEmptyContent",[e._v(" "+e._s(e.t("photos","An error occurred"))+" ")]):t("div",{staticClass:"faces"},[e.loadingFaces?t("NcLoadingIcon"):e._e(),e.noFaces&&!e.loadingFaces?t("div",{staticClass:"faces__empty"},[t("NcEmptyContent",{staticClass:"empty-content-with-illustration",scopedSlots:e._u([{key:"icon",fn:function(){return[t("AccountBoxMultipleOutline")]},proxy:!0},{key:"desc",fn:function(){return[e._v(" "+e._s(e.t("photos","This might take some time depending on the size of your photo library."))+" ")]},proxy:!0}],null,!1,149048332)},[e._v(" "+e._s(e.t("photos","Recognized people will show up here"))+" ")])],1):e.noFaces?e._e():t("div",{staticClass:"faces__list"},[e._l(e.orderedFaces,function(s){return t("router-link",{key:s.basename,attrs:{to:`/faces/${encodeURIComponent(s.basename)}`}},[t("FaceCover",{attrs:{"base-name":s.basename}})],1)}),t("router-link",{key:"unassigned",attrs:{to:"/faces/unassigned"}},[t("UnassignedFacesCover")],1)],2)],1)},ue=[],me=m(fe,he,ue,!1,null,"4a922d0c");const Fe=me.exports,Oe=Object.freeze(Object.defineProperty({__proto__:null,default:Fe},Symbol.toStringTag,{value:"Module"})),pe={name:"FaceMergeForm",components:{FaceCover:P},mixins:[k,F],props:{firstFace:{type:String,required:!0}},data(){return{loading:!1}},computed:{...f(["files","faces","facesFiles"]),filteredFaces(){return Object.values(this.faces).filter(e=>e.basename!==this.firstFace).sort((e,t)=>e.props.nbItems&&t.props.nbItems?t.props.nbItems-e.props.nbItems:!this.facesFiles[t.basename]||!this.facesFiles[e.basename]?0:this.facesFiles[t.basename].length-this.facesFiles[e.basename].length)}},methods:{handleSelect(e){this.$emit("select",e),this.loading=!0}}};var ge=function(){var e=this,t=e._self._c;return t("div",{staticClass:"merge-form face-list"},e._l(e.filteredFaces,function(s){return t("FaceCover",{key:s.basename,attrs:{"base-name":s.basename,small:""},on:{click:function(a){return e.handleSelect(s.basename)}}})}),1)},ve=[],_e=m(pe,ge,ve,!1,null,"ffc73136");const q=_e.exports,ye={name:"FaceContent",components:{Pencil:Y,Star:V,Download:j,Close:X,AlertCircle:E,Send:W,Merge:Q,ArrowLeft:U,AccountBoxMultipleOutline:z,FaceMergeForm:q,FilesListViewer:O,File:D,NcLoadingIcon:M,NcEmptyContent:b,NcActions:B,NcActionButton:x,NcDialog:A,NcButton:G,AccountSwitch:L},directives:{focus(e){u.nextTick(()=>e.focus())}},mixins:[F,T,R],props:{faceName:{type:String,default:"/"}},data(){return{showMoveModal:!1,showMergeModal:!1,showRenameModal:!1,loadingCount:0,appContent:document.getElementById("app-content-vue")}},computed:{...f(["files","facesFiles"]),face(){return this.faces[this.faceName]},faceFileIds(){return this.facesFiles[this.faceName]||[]},shouldFavoriteSelection(){return this.selectedFileIds.some(e=>this.$store.state.files.files[e].favorite===0)}},watch:{face(){this.face&&this.fetchFaceContent(this.faceName)}},mounted(){this.fetchFaceContent(this.faceName)},methods:{...w(["appendFiles","deleteFace","renameFace","downloadFiles","toggleFavoriteForFiles","removeFilesFromFace","moveFilesToFace"]),openViewer(e){const t=this.files[e];OCA.Viewer.open({path:"/"+t.filename.split("/").slice(3).join("/"),list:this.faceFileIds.map(s=>({...this.files[s],filename:"/"+this.files[s].filename.split("/").slice(3).join("/")})),loadMore:t.loadMore?async()=>await t.loadMore(!0):()=>[],canLoop:t.canLoop})},async handleRemoveFilesFromFace(e){try{this.loadingCount++,await this.removeFilesFromFace({faceName:this.faceName,fileIdsToRemove:e}),this.resetSelection()}catch(t){i.error(t)}finally{this.loadingCount--}},async handleDeleteFace(){try{this.loadingCount++,await this.deleteFace({faceName:this.faceName}),this.$router.push("/faces")}catch(e){i.error(e)}finally{this.loadingCount--}},async handleRenameFace(e){try{this.loadingCount++,this.showRenameModal=!1;const t=this.faceName;await this.renameFace({oldName:t,faceName:e}),this.$router.push({name:"facecontent",params:{faceName:e}})}catch(t){i.error(t)}finally{this.loadingCount--}},async handleMerge(e){try{this.loadingCount++,await this.moveFilesToFace({oldFace:this.faceName,faceName:e,fileIdsToMove:this.facesFiles[this.faceName]}),await this.deleteFace({faceName:this.faceName}),this.showMergeModal=!1,this.$router.push({name:"facecontent",params:{faceName:e}})}catch(t){i.error(t)}finally{this.loadingCount--}},async handleMove(e,t){try{this.loadingCount++,await this.moveFilesToFace({oldFace:this.faceName,faceName:e,fileIdsToMove:t}),this.showMoveModal=!1}catch(s){i.error(s)}finally{this.loadingCount--}},async favoriteSelection(){try{this.loadingCount++,await this.toggleFavoriteForFiles({fileIds:this.selectedFileIds,favoriteState:!0})}catch(e){i.error(e)}finally{this.loadingCount--}},async unFavoriteSelection(){try{this.loadingCount++,await this.toggleFavoriteForFiles({fileIds:this.selectedFileIds,favoriteState:!1})}catch(e){i.error(e)}finally{this.loadingCount--}},async downloadSelection(){try{this.loadingCount++,await this.downloadFiles(this.selectedFileIds)}catch(e){i.error(e)}finally{this.loadingCount--}}}};var Ne=function(){var e=this,t=e._self._c;return e.face===void 0&&!e.loadingFiles&&!e.loadingFaces?t("NcEmptyContent",{staticClass:"empty-content-with-illustration",scopedSlots:e._u([{key:"icon",fn:function(){return[t("AccountBoxMultipleOutline")]},proxy:!0}],null,!1,2861705255)},[e._v(" "+e._s(e.t("photos","This person could not be found"))+" ")]):e.errorFetchingFiles||e.errorFetchingFaces?t("NcEmptyContent",{scopedSlots:e._u([{key:"icon",fn:function(){return[t("AlertCircle")]},proxy:!0}])},[e._v(" "+e._s(e.t("photos","An error occurred"))+" ")]):t("div",{staticClass:"face"},[t("div",{staticClass:"face__header"},[t("div",{staticClass:"face__header__left"},[t("NcActions",[t("NcActionButton",{on:{click:function(s){return e.$router.push("/faces/")}},scopedSlots:e._u([{key:"icon",fn:function(){return[t("ArrowLeft")]},proxy:!0}])},[e._v(e._s(e.t("photos","Back"))+" ")])],1),t("div",{staticClass:"face__header__title"},[e.face!==void 0?t("h2",{class:{"face-name":!0,"hidden-visually":e.face.basename.match(/^[0-9]+$/)}},[e._v(" "+e._s(e.face.basename)+" ")]):e._e()]),e.loadingCount>0||e.loadingFaces?t("NcLoadingIcon"):e._e()],1),e.face!==void 0?t("div",{staticClass:"face__header__actions"},[t("NcActions",[t("NcActionButton",{attrs:{"close-after-click":!0,"aria-label":e.t("photos","Rename person")},on:{click:function(s){e.showRenameModal=!0}},scopedSlots:e._u([{key:"icon",fn:function(){return[t("Pencil")]},proxy:!0}],null,!1,514409694)},[e._v(" "+e._s(e.t("photos","Rename person"))+" ")])],1),t("NcActions",{attrs:{"force-menu":!0}},[Object.keys(e.faces).length>1?t("NcActionButton",{attrs:{"close-after-click":!0,"aria-label":e.t("photos","Merge with different person")},on:{click:function(s){e.showMergeModal=!0}},scopedSlots:e._u([{key:"icon",fn:function(){return[t("Merge")]},proxy:!0}],null,!1,3117189691)},[e._v(" "+e._s(e.t("photos","Merge with different person"))+" ")]):e._e(),e.selectedFileIds.length?[t("NcActionButton",{attrs:{"close-after-click":!0,"aria-label":e.t("photos","Download selected files")},on:{click:e.downloadSelection}},[t("Download",{attrs:{slot:"icon"},slot:"icon"}),e._v(" "+e._s(e.t("photos","Download selected photos"))+" ")],1),e.shouldFavoriteSelection?t("NcActionButton",{attrs:{"close-after-click":!0,"aria-label":e.t("photos","Mark selection as favorite")},on:{click:e.favoriteSelection}},[t("Star",{attrs:{slot:"icon"},slot:"icon"}),e._v(" "+e._s(e.t("photos","Favorite"))+" ")],1):t("NcActionButton",{attrs:{"close-after-click":!0,"aria-label":e.t("photos","Remove selection from favorites")},on:{click:e.unFavoriteSelection}},[t("Star",{attrs:{slot:"icon"},slot:"icon"}),e._v(" "+e._s(e.t("photos","Remove from favorites"))+" ")],1),t("NcActionButton",{attrs:{"close-after-click":!0},on:{click:function(s){e.showMoveModal=!0}},scopedSlots:e._u([{key:"icon",fn:function(){return[t("AccountSwitch")]},proxy:!0}],null,!1,2937983280)},[e._v(" "+e._s(e.n("photos","Move photo to a different person","Move photos to a different person",e.selectedFileIds.length))+" ")]),t("NcActionButton",{attrs:{"close-after-click":!0},on:{click:function(s){return e.handleRemoveFilesFromFace(e.selectedFileIds)}},scopedSlots:e._u([{key:"icon",fn:function(){return[t("Close")]},proxy:!0}],null,!1,1051939733)},[e._v(" "+e._s(e.n("photos","Remove photo from person","Remove photos from person",e.selectedFileIds.length))+" ")])]:e._e(),t("NcActionButton",{attrs:{"close-after-click":!0},on:{click:e.handleDeleteFace},scopedSlots:e._u([{key:"icon",fn:function(){return[t("Close")]},proxy:!0}],null,!1,1051939733)},[e._v(" "+e._s(e.t("photos","Remove person"))+" ")])],2)],1):e._e()]),e.face!==void 0?t("FilesListViewer",{staticClass:"face__photos",attrs:{"container-element":e.appContent,"file-ids":e.faceFileIds,loading:e.loadingFiles||e.loadingFaces},scopedSlots:e._u([{key:"default",fn:function({file:s,distance:a}){return t("File",{attrs:{file:e.files[s.id],"allow-selection":!0,selected:e.selection[s.id]===!0,distance:a},on:{click:e.openViewer,"select-toggled":e.onFileSelectToggle}})}}],null,!1,2716306842)}):e._e(),e.showRenameModal?t("NcDialog",{attrs:{name:e.t("photos","Rename person"),"close-on-click-outside":"",size:"small"},on:{closing:function(s){e.showRenameModal=!1}},scopedSlots:e._u([{key:"actions",fn:function(){return[t("NcButton",{attrs:{"aria-label":e.t("photos","Save."),type:"primary",disabled:e.$refs.nameInput&&e.$refs.nameInput.value.trim()===""},on:{click:function(s){return e.handleRenameFace(e.$refs.nameInput.value)}},scopedSlots:e._u([{key:"icon",fn:function(){return[e.loadingCount?t("NcLoadingIcon"):t("Send")]},proxy:!0}],null,!1,564208483)},[e._v(" "+e._s(e.t("photos","Save"))+" ")])]},proxy:!0}],null,!1,300100074)},[t("div",{staticClass:"rename-form"},[t("input",{directives:[{name:"focus",rawName:"v-focus"}],ref:"nameInput",attrs:{type:"text",name:"name",required:"",placeholder:e.t("photos","Name of this person")},domProps:{value:e.faceName},on:{keydown:function(s){return!s.type.indexOf("key")&&e._k(s.keyCode,"enter",13,s.key,"Enter")?null:e.handleRenameFace(e.$refs.nameInput.value)}}})])]):e._e(),e.showMergeModal?t("NcDialog",{attrs:{name:e.t("photos","Merge person"),"close-on-click-outside":"",size:"normal"},on:{closing:function(s){e.showMergeModal=!1}}},[t("FaceMergeForm",{attrs:{"first-face":e.faceName},on:{select:function(s){return e.handleMerge(s)}}})],1):e._e(),e.showMoveModal?t("NcDialog",{attrs:{name:e.t("photos","Move to different person"),"close-on-click-outside":"",size:"normal"},on:{closing:function(s){e.showMoveModal=!1}}},[t("FaceMergeForm",{attrs:{"first-face":e.faceName},on:{select:function(s){return e.handleMove(s,e.selectedFileIds)}}})],1):e._e()],1)},Ce=[],we=m(ye,Ne,Ce,!1,null,"716c9e34");const Me=we.exports,ze=Object.freeze(Object.defineProperty({__proto__:null,default:Me},Symbol.toStringTag,{value:"Module"})),be={name:"UnassignedFaces",components:{Star:V,Download:j,AlertCircle:E,ArrowLeft:U,FaceMergeForm:q,FilesListViewer:O,File:D,NcLoadingIcon:M,NcEmptyContent:b,NcActions:B,NcActionButton:x,NcDialog:A,AccountSwitch:L},directives:{focus(e){u.nextTick(()=>e.focus())}},mixins:[F,T,R],data(){return{showMoveModal:!1,loadingCount:0,appContent:document.getElementById("app-content-vue")}},computed:{...f(["files","unassignedFiles"]),faceFileIds(){return this.unassignedFiles||[]},shouldFavoriteSelection(){return this.selectedFileIds.some(e=>this.$store.state.files.files[e].favorite===0)}},mounted(){this.fetchUnassignedFaces()},methods:{...w(["appendFiles","deleteFace","renameFace","downloadFiles","toggleFavoriteForFiles","removeFilesFromFace","moveFilesToFace"]),openViewer(e){const t=this.files[e];OCA.Viewer.open({path:"/"+t.filename.split("/").slice(3).join("/"),list:this.faceFileIds.map(s=>({...this.files[s],filename:"/"+this.files[s].filename.split("/").slice(3).join("/")})),loadMore:t.loadMore?async()=>await t.loadMore(!0):()=>[],canLoop:t.canLoop})},async handleMove(e,t){try{this.loadingCount++,await this.moveFilesToFace({oldFace:null,faceName:e,fileIdsToMove:t}),this.showMoveModal=!1}catch(s){i.error(s)}finally{this.loadingCount--}},async favoriteSelection(){try{this.loadingCount++,await this.toggleFavoriteForFiles({fileIds:this.selectedFileIds,favoriteState:!0})}catch(e){i.error(e)}finally{this.loadingCount--}},async unFavoriteSelection(){try{this.loadingCount++,await this.toggleFavoriteForFiles({fileIds:this.selectedFileIds,favoriteState:!1})}catch(e){i.error(e)}finally{this.loadingCount--}},async downloadSelection(){try{this.loadingCount++,await this.downloadFiles(this.selectedFileIds)}catch(e){i.error(e)}finally{this.loadingCount--}}}};var ke=function(){var e=this,t=e._self._c;return e.errorFetchingFiles?t("NcEmptyContent",{scopedSlots:e._u([{key:"icon",fn:function(){return[t("AlertCircle")]},proxy:!0}],null,!1,794036927)},[e._v(" "+e._s(e.t("photos","An error occurred"))+" ")]):t("div",{staticClass:"face"},[t("div",{staticClass:"face__header"},[t("div",{staticClass:"face__header__left"},[t("NcActions",[t("NcActionButton",{on:{click:function(s){return e.$router.push("/faces/")}},scopedSlots:e._u([{key:"icon",fn:function(){return[t("ArrowLeft")]},proxy:!0}])},[e._v(e._s(e.t("photos","Back"))+" ")])],1),t("div",{staticClass:"face__header__title"},[t("h2",{class:{"face-name":!0}},[e._v(" "+e._s(e.t("photos","Unassigned faces"))+" ")])]),e.loadingCount>0||e.loadingFaces?t("NcLoadingIcon"):e._e()],1),t("div",{staticClass:"face__header__actions"},[t("NcActions",{attrs:{"force-menu":!0}},[e.selectedFileIds.length?[t("NcActionButton",{attrs:{"close-after-click":!0,"aria-label":e.t("photos","Download selected files")},on:{click:e.downloadSelection}},[t("Download",{attrs:{slot:"icon"},slot:"icon"}),e._v(" "+e._s(e.t("photos","Download selected photos"))+" ")],1),e.shouldFavoriteSelection?t("NcActionButton",{attrs:{"close-after-click":!0,"aria-label":e.t("photos","Mark selection as favorite")},on:{click:e.favoriteSelection}},[t("Star",{attrs:{slot:"icon"},slot:"icon"}),e._v(" "+e._s(e.t("photos","Favorite"))+" ")],1):t("NcActionButton",{attrs:{"close-after-click":!0,"aria-label":e.t("photos","Remove selection from favorites")},on:{click:e.unFavoriteSelection}},[t("Star",{attrs:{slot:"icon"},slot:"icon"}),e._v(" "+e._s(e.t("photos","Remove from favorites"))+" ")],1),t("NcActionButton",{attrs:{"close-after-click":!0},on:{click:function(s){e.showMoveModal=!0}},scopedSlots:e._u([{key:"icon",fn:function(){return[t("AccountSwitch")]},proxy:!0}],null,!1,2937983280)},[e._v(" "+e._s(e.n("photos","Move photo to a different person","Move photos to a different person",e.selectedFileIds.length))+" ")])]:e._e()],2)],1)]),t("FilesListViewer",{staticClass:"face__photos",attrs:{"container-element":e.appContent,"file-ids":e.faceFileIds,loading:e.loadingFiles||e.loadingFaces},scopedSlots:e._u([{key:"default",fn:function({file:s,distance:a}){return t("File",{attrs:{file:e.files[s.id],"allow-selection":!0,selected:e.selection[s.id]===!0,distance:a},on:{click:e.openViewer,"select-toggled":e.onFileSelectToggle}})}}])}),e.showMoveModal?t("NcDialog",{attrs:{name:e.t("photos","Move to different person"),"close-on-click-outside":"",size:"normal"},on:{closing:function(s){e.showMoveModal=!1}}},[t("FaceMergeForm",{attrs:{"first-face":"-1"},on:{select:function(s){return e.handleMove(s,e.selectedFileIds)}}})],1):e._e()],1)},Ie=[],Se=m(be,ke,Ie,!1,null,"af5ee551");const $e=Se.exports,Le=Object.freeze(Object.defineProperty({__proto__:null,default:$e},Symbol.toStringTag,{value:"Module"}));export{Oe as F,Le as U,ze as a,De as f};
//# sourceMappingURL=faces-CI2plmbg.chunk.mjs.map

{"version":3,"mappings":"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AC,EACA,EACA,OACA,OACA,WACA,QACA,CACA,EACA,UACA,UACA,OAAA1L,EAAA,wBAEA,EACA,gBACA,IACA,iBAAAsJ,GAAA,CACA,cACA,YACA,UAAAjJ,EACA,aACA,QACAoE,EAAA,CACAnI,EAAA,mDAAAmI,CAAA,WAEA,gBACA,CAEA,qpBC3DAlD,EAAI,UAAU,EAAIwH,EAClBxH,EAAI,UAAU,EAAIyH,EAElB,OAAO,iBAAiB,mBAAoB,IAAM,CACjD,IAAI,UAAU,SAAS,mBAAqB2C,GAAO,CAC3CC,GAAA,gBAAkB,IAAIrK,EAAI,CAChC,GAAAoK,EAAA,MACA1D,EACA,OAAaiB,KAAE2C,EAAkB,EACjC,EACD,CACF,CAAC,ECsBD,MAAAC,GAAA,CACA,kBACA,gBACA,OACA,MACA,YACA,YAEA,EAEA,OACA,OACA,UACA,QACA,CACA,EAEA,UACA,WACA,0CACA,EACA,YACA,yFACA,EACA,UACA,kDACA,EACA,cACA,wEACA,EACA,MACA,OAAA9L,EAAA,kIACA,EACA,gBACA,kDAEA,EAEA,gBAEA,iBACA,EAEA,SACA,aACA,iBACA,4BACA,6BACA,2FACA,mCACA,CACA,EAGA,SACA,cACA,EAEA,UACA,cACA,CAGA,+mCCtGe+L,EAAA,CACd,KAAM,uBAEN,MAAO,CACC,OACN,gBAAiB,IAAI,eACtB,CACD,EAEA,eAAgB,CACf,KAAK,gBAAgB,MAAM,CAC5B,EAEA,iBAAiBC,EAAMnK,EAAIoK,EAAM,CAChC,KAAK,gBAAgB,MAAM,EACtB,qBAAkB,IAAI,gBACtBA,EAAA,EAEP,ECsBAC,GAAA,CACA,wBAEA,YACA,UAAAC,GACA,SAAAzP,EACA,cAAA8O,CACA,EAEA,gBAEA,OACA,SACA,aACA,UACA,EACA,MACA,YACA,WACA,EACA,OACA,YACA,WACA,EACA,WACA,YACA,4BACA,EAEA,QACA,YACA,aAEA,EAEA,UACA,SACA,MAAAY,EAAA,gBACA,oCAAAA,CAAA,EACAA,CACA,EAEA,OACA,mBACA,eAEA,UACA,EAEA,aACA,MAAA3O,EAAA,qBACAA,EAAA,MACA,MA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","names":["_sfc_main$m","NcCheckboxRadioSwitch","value","getLogger","user","getLoggerBuilder","logger","getCurrentUser","_sfc_main$l","defineComponent","NcButton","PhotosFolder","Plus","FolderMultiple","debounce","args","title","getFilePickerBuilder","t","nodes","pickedFolder","index","folders","_sfc_main$k","Home","path","_sfc_main$j","NcAppSettingsDialog","NcAppSettingsSection","CroppedLayoutSettings","PhotosSourceLocationsSettings","PhotosUploadLocationSettings","imgplaceholder","videoplaceholder","maps","loadState","recognize","appStoreEnabled","_sfc_main$i","AccountBoxMultipleOutline","Cog","CalendarToday","Camera","AccountGroup","Folder","FolderMultipleImage","ImageIcon","ShareVariant","Star","Tag","VideoIcon","MapIcon","MapMarker","NcAppContent","NcAppNavigation","NcAppNavigationItem","NcContent","SettingsDialog","svgplaceholder","areTagsInstalled","isAppStoreEnabled","isMapsInstalled","isRecognizeInstalled","files","generateUrl","registration","registrationError","imageMimes","videoMimes","allMimes","Folders","__vitePreload","n","Albums","AlbumContent","SharedAlbums","SharedAlbumContent","PublicAlbumContent","Places","PlaceContent","Tags","TagContent","Timeline","Faces","FaceContent","UnassignedFaces","baseTitle","Vue","Router","mapsPath","parsePathParams","router","route","to","recognizeInstallLink","rootTitle","SemaphoreWithPriority","#capacity","#queue","#active","capacity","priority","info","symbol","resolve","#callNextJob","symbolIndex","prioritizedQueue","item","itemPriority","highestPriority","nextJob","jobIndex","davClient","getClient","state","mutations","newFiles","file","nomediaPath","defaultRootPath","date","moment","fileid","subfolders","folder","id","paths","fileId","favoriteState","getters","actions","context","fileIds","semaphore","Semaphore","promises","error","showError","symbole","collections","collection","collectionFileNames","collectionFileName","collectionFiles","fileIdsToAdd","fileIdsToRemove","prefix","newBaseName","newCollection","properties","updatedCollection","stringifiedProperties","name","isNumber","num","encodeFilePath","pathSections","relativePath","section","sortCompare","fileInfo1","fileInfo2","key","asc","getLanguage","genFileInfo","obj","fileInfo","flattenAndFormatObject","url","defaultRemoteURL","callback","resultObj","data","camelcase","props","getDefaultDavProps","getDavProperties","getPropFind","extraProps","configChangedEvent","getFolder","location","joinPaths","stat","getDefaultPropfind","resultToNode","module","commit","axios","emit","initPhotosLocationFolder","store","photosLocationFolder","Vuex","photosStore","Store","albums","sharedAlbums","publicAlbums","faces","systemtags","places","userConfig","mutation","sync","translate","translatePlural","registerDavProperty","h","Photos","_sfc_main$h","PhotosPublic","getPhotos","_options","options","orMime","str","mime","eqFavorites","onThisDay","_","years","start","end","sourceFolders","_sfc_main$g","NcIconSvgWrapper","StarSvg","SWCacheName","hotCache","isCachedPreview","previewUrl","response","_sfc_main$f","FavoriteIcon","PlayCircleIcon","size","token","width","height","pixels","decode","ctx","imageData","_sfc_main$e","File","NcLoadingIcon","NcEmptyContent","Image","el","global","DashboardOnThisDay","_sfc_main$d","AbortControllerMixin","from","next","_sfc_main$c","ArrowLeft","isRoot","parent","params","hide","navigationToggle","sizes","getGridConfig","val","currentSize","GridConfigMixin","fetchFile","fileName","_sfc_main$b","AlertCircle","_sfc_main$a","ImageMultiple","getCollectionDavRequest","getCollectionFilesDavRequest","fetchCollection","client","formatCollection","fetchCollections","rawCollection","collaborators","dateRange","dateRangeFormatted","fetchCollectionFiles","fetchedFiles","FetchCollectionContentMixin","mapActions","mappers","fetchSemaphoreSymbol","mapper","FetchCollectionsMixin","collectionHome","FetchFilesMixin","blacklist","force","numberOfImagesPerBatch","sources","source","_sfc_main$9","NcActionButton","mapGetters","FilesSelectionMixin","filesIds","filesId","splitItemsInRows","items","containerWidth","baseHeight","rows","rowNumber","currentItem","rowItems","computeRowWidth","rowHeight","computeRowHeight","sum","itemWidth","isLastRow","sumOfItemsRatio","itemRatio","_sfc_main$7","TiledRows","row","totalHeight","entries","entry","cr","_sfc_main$6","containerHeight","containerTop","containerBottom","currentRowTop","currentRowBottom","visibleSections","visibleRows","distance","visibleItems","usedTokens","unusedTokens","finalMapping","sectionHeight","paddingTop","buffer","currentRowTopDistanceFromTop","_sfc_main$5","PackageVariant","TiledLayout","VirtualScrolling","sectionId","total","length","subscribe","unsubscribe","fetchedFile","_sfc_main$4","FilesListViewer","isMobile","fileId1","fileId2","FilesByMonthMixin","filesByMonth","month","month1","month2","_sfc_main$3","ImagePlus","NcDialog","NcSelect","NcNoteCard","UploadPicker","useIsMobile","allowedMimes","event","_sfc_main$2","NcActionLink","filePaths","_sfc_main$1","Delete","PlusBoxMultiple","Download","Close","FolderAlertOutline","NcModal","NcActions","AlbumForm","AlbumPicker","ActionFavorite","ActionDownload","HeaderNavigation","album","_sfc_main","LControlAttribution","LTileLayer","LMap","LMarker","LTooltip"],"ignoreList":[],"sources":["../src/components/Settings/CroppedLayoutSettings.vue","../src/services/logger.ts","../src/components/Settings/PhotosSourceLocationsSettings.vue","../src/components/Settings/PhotosUploadLocationSettings.vue","../src/components/Settings/SettingsDialog.vue","../src/assets/image.svg","../src/assets/video.svg","../src/services/IsMapsInstalled.ts","../src/services/IsRecognizeInstalled.ts","../src/services/IsAppStoreEnabled.ts","../src/Photos.vue","../src/services/AllowedMimes.ts","../src/router/index.ts","../src/utils/semaphoreWithPriority.ts","../src/services/DavClient.ts","../src/store/files.ts","../src/store/collections.ts","../src/utils/numberUtils.ts","../src/utils/fileUtils.ts","../src/services/DavRequest.ts","../src/store/userConfig.ts","../src/store/index.ts","../src/main.ts","../src/PhotosPublic.vue","../src/public.ts","../src/services/PhotoSearch.ts","../src/components/FavoriteIcon.vue","../src/services/PreviewService.ts","../src/components/File.vue","../src/components/Dashboard/DashboardOnThisDay.vue","../src/dashboard.ts","../src/components/FileLegacy.vue","../src/mixins/AbortControllerMixin.ts","../src/components/HeaderNavigation.vue","../src/assets/grid-sizes.ts","../src/services/GridConfig.ts","../src/mixins/GridConfig.ts","../src/services/fileFetcher.ts","../src/components/Collection/CollectionsList.vue","../src/components/Collection/CollectionCover.vue","../src/services/collectionFetcher.ts","../src/mixins/FetchCollectionContentMixin.ts","../src/mixins/FetchCollectionsMixin.ts","../src/mixins/FetchFilesMixin.ts","../src/components/Actions/ActionFavorite.vue","../src/mixins/FilesSelectionMixin.ts","../src/services/TiledLayout.ts","../src/components/TiledLayout/TiledLayout.vue","../src/components/VirtualScrolling.vue","../src/components/FilesListViewer.vue","../src/components/Collection/CollectionContent.vue","../src/mixins/FilesByMonthMixin.ts","../src/components/PhotosPicker.vue","../src/components/Actions/ActionDownload.vue","../src/views/Timeline.vue","../src/components/LocationMap.vue"],"sourcesContent":["<!--\n - SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<NcCheckboxRadioSwitch :checked=\"croppedLayout\"\n\t\ttype=\"switch\"\n\t\t@update:checked=\"updateSetting\">\n\t\t{{ t('photos', 'Enable squared photos view') }}\n\t</NcCheckboxRadioSwitch>\n</template>\n\n<script lang='ts'>\nimport { NcCheckboxRadioSwitch } from '@nextcloud/vue'\n\nexport default {\n\tname: 'CroppedLayoutSettings',\n\n\tcomponents: {\n\t\tNcCheckboxRadioSwitch,\n\t},\n\n\tcomputed: {\n\t\tcroppedLayout() {\n\t\t\treturn this.$store.state.userConfig.croppedLayout\n\t\t},\n\t},\n\n\tmethods: {\n\t\tupdateSetting(value) {\n\t\t\tthis.$store.dispatch('updateUserConfig', { key: 'croppedLayout', value })\n\t\t},\n\t},\n}\n</script>\n","/**\n * SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { getCurrentUser } from '@nextcloud/auth'\nimport { getLoggerBuilder } from '@nextcloud/logger'\n\nconst getLogger = user => {\n\tif (user === null) {\n\t\treturn getLoggerBuilder()\n\t\t\t.setApp('photos')\n\t\t\t.build()\n\t}\n\treturn getLoggerBuilder()\n\t\t.setApp('photos')\n\t\t.setUid(user.uid)\n\t\t.build()\n}\n\nexport default getLogger(getCurrentUser())\n","<!--\n - SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<div class=\"photos-locations-container\">\n\t\t<div class=\"photos-locations\">\n\t\t\t<li v-for=\"(source, index) in photosSourceFolders\"\n\t\t\t\t:key=\"index\">\n\t\t\t\t<PhotosFolder :path=\"source\"\n\t\t\t\t\t:can-delete=\"photosSourceFolders.length !== 1\"\n\t\t\t\t\t:root-folder-label=\"t('photos', 'All folders')\"\n\t\t\t\t\t:root-folder-icon=\"FolderMultiple\"\n\t\t\t\t\t@remove-folder=\"removeSourceFolder(index)\" />\n\t\t\t</li>\n\t\t</div>\n\n\t\t<NcButton :aria-label=\"t('photos', 'Add a Photos source for the timelines')\"\n\t\t\t@click=\"debounceAddSourceFolder\">\n\t\t\t<template #icon>\n\t\t\t\t<Plus :size=\"20\" />\n\t\t\t</template>\n\t\t\t{{ t('photos', 'Add folder') }}\n\t\t</NcButton>\n\t</div>\n</template>\n\n<script lang='ts'>\nimport debounce from 'debounce'\nimport { defineComponent } from 'vue'\n\nimport FolderMultiple from 'vue-material-design-icons/FolderMultiple.vue'\nimport Plus from 'vue-material-design-icons/Plus.vue'\n\nimport { NcButton } from '@nextcloud/vue'\nimport { getFilePickerBuilder } from '@nextcloud/dialogs'\nimport { translate as t } from '@nextcloud/l10n'\n\nimport PhotosFolder from './PhotosFolder.vue'\nimport logger from '../../services/logger.js'\n\nexport default defineComponent({\n\tname: 'PhotosSourceLocationsSettings',\n\n\tcomponents: {\n\t\tNcButton,\n\t\tPhotosFolder,\n\t\tPlus,\n\t},\n\n\tdata() {\n\t\treturn {\n\t\t\tFolderMultiple,\n\t\t}\n\t},\n\n\tcomputed: {\n\t\t/** @return {string[]} */\n\t\tphotosSourceFolders() {\n\t\t\treturn this.$store.state.userConfig.photosSourceFolders\n\t\t},\n\t},\n\n\tmethods: {\n\t\tdebounceAddSourceFolder: debounce(function(...args) {\n\t\t\tthis.addSourceFolder(...args)\n\t\t}, 200, false),\n\n\t\tasync openFilePicker(title) {\n\t\t\tconst picker = getFilePickerBuilder(title)\n\t\t\t\t.setMultiSelect(false)\n\t\t\t\t.addMimeTypeFilter('httpd/unix-directory')\n\t\t\t\t.allowDirectories()\n\t\t\t\t.addButton({\n\t\t\t\t\tlabel: t('photos', 'Pick folder'),\n\t\t\t\t\tcallback: (nodes) => logger.debug('Picked', { nodes }),\n\t\t\t\t})\n\t\t\t\t.build()\n\n\t\t\treturn picker.pick()\n\t\t},\n\n\t\tasync addSourceFolder() {\n\t\t\tconst pickedFolder = await this.openFilePicker(t('photos', 'Select a source folder for your media'))\n\t\t\tif (this.photosSourceFolders.includes(pickedFolder)) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tthis.$store.dispatch('updateUserConfig', { key: 'photosSourceFolders', value: [...this.photosSourceFolders, pickedFolder] })\n\t\t},\n\n\t\tremoveSourceFolder(index) {\n\t\t\tconst folders = [...this.photosSourceFolders]\n\t\t\tfolders.splice(index, 1)\n\t\t\tthis.$store.dispatch('updateUserConfig', { key: 'photosSourceFolders', value: folders })\n\t\t},\n\n\t\tt,\n\t},\n})\n</script>\n\n<style lang=\"scss\" scoped>\n.photos-locations-container {\n\tdisplay: flex;\n\tflex-direction: column;\n\twidth: fit-content;\n\n\t.photos-locations {\n\t\tmargin-bottom: 16px;\n\n\t\tli {\n\t\t\tlist-style: none;\n\t\t}\n\t}\n}\n</style>\n","<!--\n - SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<div class=\"photos-location\">\n\t\t<PhotosFolder :path=\"photosLocation\" :root-folder-label=\"t('photos', 'Home')\" :root-folder-icon=\"Home\" />\n\n\t\t<NcButton :aria-label=\"t('photos', 'Choose default Photos upload and Albums location')\"\n\t\t\t@click=\"debounceSelectPhotosFolder\">\n\t\t\t{{ t('photos', 'Choose a different folder') }}\n\t\t</NcButton>\n\t</div>\n</template>\n\n<script lang='ts'>\nimport debounce from 'debounce'\nimport { defineComponent } from 'vue'\n\nimport Home from 'vue-material-design-icons/Home.vue'\n\nimport { NcButton } from '@nextcloud/vue'\nimport { getFilePickerBuilder } from '@nextcloud/dialogs'\nimport { translate as t } from '@nextcloud/l10n'\n\nimport PhotosFolder from './PhotosFolder.vue'\nimport logger from '../../services/logger.js'\n\nexport default defineComponent({\n\tname: 'PhotosUploadLocationSettings',\n\n\tcomponents: {\n\t\tNcButton,\n\t\tPhotosFolder,\n\t},\n\n\tdata() {\n\t\treturn {\n\t\t\tHome,\n\t\t}\n\t},\n\n\tcomputed: {\n\t\t/** @return {string} */\n\t\tphotosLocation() {\n\t\t\treturn this.$store.state.userConfig.photosLocation\n\t\t},\n\t},\n\n\tmethods: {\n\t\tdebounceSelectPhotosFolder: debounce(function() {\n\t\t\tthis.selectPhotosFolder()\n\t\t}),\n\n\t\tasync selectPhotosFolder() {\n\t\t\tconst pickedFolder = await this.openFilePicker(t('photos', 'Select the default upload location for your media'))\n\t\t\tthis.updatePhotosFolder(pickedFolder)\n\t\t},\n\n\t\tasync openFilePicker(title) {\n\t\t\tconst picker = getFilePickerBuilder(title)\n\t\t\t\t.setMultiSelect(false)\n\t\t\t\t.addMimeTypeFilter('httpd/unix-directory')\n\t\t\t\t.allowDirectories()\n\t\t\t\t.startAt(this.photosLocation)\n\t\t\t\t.addButton({\n\t\t\t\t\tlabel: t('photos', 'Pick folder'),\n\t\t\t\t\tcallback: (nodes) => logger.debug('Picked', { nodes }),\n\t\t\t\t})\n\t\t\t\t.build()\n\n\t\t\treturn picker.pick()\n\t\t},\n\n\t\tupdatePhotosFolder(path) {\n\t\t\tthis.$store.dispatch('updateUserConfig', { key: 'photosLocation', value: path })\n\t\t},\n\n\t\tt,\n\t},\n})\n</script>\n\n<style lang=\"scss\" scoped>\n.photos-location {\n\tdisplay: flex;\n\tflex-direction: column;\n\twidth: fit-content;\n\n\t.folder {\n\t\tmargin-bottom: 16px;\n\t}\n}\n</style>\n","<!--\n - SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<NcAppSettingsDialog :open=\"open\"\n\t\t:show-navigation=\"true\"\n\t\t:name=\"t('photos', 'Photos settings')\"\n\t\t@update:open=\"onClose\">\n\t\t<NcAppSettingsSection id=\"layout-settings\" :name=\"t('photos', 'View')\">\n\t\t\t<CroppedLayoutSettings />\n\t\t</NcAppSettingsSection>\n\n\t\t<NcAppSettingsSection id=\"source-directories-settings\" :name=\"t('photos', 'Media folders')\">\n\t\t\t<div class=\"setting-section-subline\">\n\t\t\t\t{{ t('photos', 'Choose the folders from where photos and videos are shown.') }}\n\t\t\t</div>\n\n\t\t\t<PhotosSourceLocationsSettings />\n\t\t</NcAppSettingsSection>\n\n\t\t<NcAppSettingsSection id=\"upload-directory-settings\" :name=\"t('photos', 'Upload folder')\">\n\t\t\t<div class=\"setting-section-subline\">\n\t\t\t\t{{ t('photos', 'Choose the folder where photos and albums are uploaded to.') }}\n\t\t\t</div>\n\n\t\t\t<PhotosUploadLocationSettings />\n\t\t</NcAppSettingsSection>\n\t</NcAppSettingsDialog>\n</template>\n\n<script lang='ts'>\nimport { NcAppSettingsDialog, NcAppSettingsSection } from '@nextcloud/vue'\nimport { translate as t } from '@nextcloud/l10n'\n\nimport CroppedLayoutSettings from './CroppedLayoutSettings.vue'\nimport PhotosSourceLocationsSettings from './PhotosSourceLocationsSettings.vue'\nimport PhotosUploadLocationSettings from './PhotosUploadLocationSettings.vue'\n\nexport default {\n\tname: 'SettingsDialog',\n\n\tcomponents: {\n\t\tNcAppSettingsDialog,\n\t\tNcAppSettingsSection,\n\t\tCroppedLayoutSettings,\n\t\tPhotosSourceLocationsSettings,\n\t\tPhotosUploadLocationSettings,\n\t},\n\n\tprops: {\n\t\topen: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\n\tmethods: {\n\t\t// This can only be called if the AppSettingsDialog\n\t\t// is shown. So closing only\n\t\tonClose() {\n\t\t\tthis.$emit('update:open', false)\n\t\t},\n\n\t\tt,\n\t},\n}\n</script>\n\n<style lang=\"scss\">\n.app-settings {\n\t.setting-section-subline {\n\t\tcolor: var(--color-text-lighter);\n\t\tmargin-bottom: 8px;\n\t}\n}\n</style>\n","export default \"data:image/svg+xml,%3csvg%20width='32'%20height='32'%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20style='fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2'%3e%3cpath%20d='M5%2021c-.55%200-1.021-.196-1.412-.587A1.927%201.927%200%200%201%203%2019V5c0-.55.196-1.021.588-1.413A1.926%201.926%200%200%201%205%203h14c.55%200%201.021.196%201.413.587.391.392.587.863.587%201.413v14a1.93%201.93%200%200%201-.587%201.413A1.93%201.93%200%200%201%2019%2021H5Zm0-2h14V5H5v14Zm1-2h12l-3.75-5-3%204L9%2013l-3%204Zm-1%202V5v14Zm3.5-9a1.45%201.45%200%200%200%201.063-.437A1.45%201.45%200%200%200%2010%208.5c0-.417-.146-.771-.437-1.062A1.447%201.447%200%200%200%208.5%207c-.417%200-.771.146-1.062.438A1.443%201.443%200%200%200%207%208.5c0%20.417.146.771.438%201.063.291.291.645.437%201.062.437Z'%20style='fill-rule:nonzero'%20transform='translate(-2.665%20-2.665)%20scale(1.55497)'/%3e%3c/svg%3e\"","export default \"data:image/svg+xml,%3csvg%20width='32'%20height='32'%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20style='fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2'%3e%3cpath%20d='m4%204%202%204h3L7%204h2l2%204h3l-2-4h2l2%204h3l-2-4h3c.55%200%201.021.196%201.413.587.391.392.587.863.587%201.413v12a1.93%201.93%200%200%201-.587%201.413A1.93%201.93%200%200%201%2020%2020H4c-.55%200-1.021-.196-1.412-.587A1.927%201.927%200%200%201%202%2018V6c0-.55.196-1.021.588-1.413A1.926%201.926%200%200%201%204%204Z'%20style='fill-rule:nonzero'%20transform='translate(-.804%20-.607)%20scale(1.40177)'/%3e%3c/svg%3e\"","/**\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { loadState } from '@nextcloud/initial-state'\n\nconst maps = loadState('photos', 'maps', false) as boolean\nexport default maps\n","/**\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { loadState } from '@nextcloud/initial-state'\n\nconst recognize = loadState('photos', 'recognize', false) as boolean\nexport default recognize\n","/**\n * SPDX-FileCopyrightText: 2024 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { loadState } from '@nextcloud/initial-state'\n\nconst appStoreEnabled = loadState('photos', 'appStoreEnabled', false) as boolean\nexport default appStoreEnabled\n","<!--\n  - SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<NcContent app-name=\"photos\">\n\t\t<NcAppNavigation :aria-label=\"t('photos', 'Photos')\">\n\t\t\t<template #list>\n\t\t\t\t<NcAppNavigationItem :to=\"{name: 'all_media'}\"\n\t\t\t\t\t:name=\"t('photos', 'All media')\"\n\t\t\t\t\tclass=\"app-navigation__all_media\"\n\t\t\t\t\tdata-id-app-nav-item=\"all-media\"\n\t\t\t\t\texact>\n\t\t\t\t\t<ImageIcon slot=\"icon\" :size=\"20\" />\n\t\t\t\t</NcAppNavigationItem>\n\t\t\t\t<NcAppNavigationItem to=\"/photos\"\n\t\t\t\t\t:name=\"t('photos', 'Photos')\"\n\t\t\t\t\tdata-id-app-nav-item=\"photos\">\n\t\t\t\t\t<Camera slot=\"icon\" :size=\"20\" />\n\t\t\t\t</NcAppNavigationItem>\n\t\t\t\t<NcAppNavigationItem to=\"/videos\"\n\t\t\t\t\t:name=\"t('photos', 'Videos')\"\n\t\t\t\t\tdata-id-app-nav-item=\"videos\">\n\t\t\t\t\t<VideoIcon slot=\"icon\" :size=\"20\" />\n\t\t\t\t</NcAppNavigationItem>\n\t\t\t\t<NcAppNavigationItem :to=\"{name: 'albums'}\"\n\t\t\t\t\t:name=\"t('photos', 'Albums')\"\n\t\t\t\t\tdata-id-app-nav-item=\"albums\">\n\t\t\t\t\t<FolderMultipleImage slot=\"icon\" :size=\"20\" />\n\t\t\t\t</NcAppNavigationItem>\n\t\t\t\t<NcAppNavigationItem :to=\"{name: 'sharedAlbums'}\"\n\t\t\t\t\t:name=\"t('photos', 'Collaborative albums')\"\n\t\t\t\t\tdata-id-app-nav-item=\"shared-albums\">\n\t\t\t\t\t<AccountGroup slot=\"icon\" :size=\"20\" />\n\t\t\t\t</NcAppNavigationItem>\n\t\t\t\t<NcAppNavigationItem v-if=\"showPeopleMenuEntry\"\n\t\t\t\t\t:to=\"{name: 'faces'}\"\n\t\t\t\t\t:name=\"t('photos', 'People')\"\n\t\t\t\t\tdata-id-app-nav-item=\"faces\">\n\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t<AccountBoxMultipleOutline :size=\"20\" />\n\t\t\t\t\t</template>\n\t\t\t\t</NcAppNavigationItem>\n\t\t\t\t<NcAppNavigationItem :to=\"{name: 'folders'}\"\n\t\t\t\t\t:name=\"t('photos', 'Folders')\"\n\t\t\t\t\tdata-id-app-nav-item=\"folders\">\n\t\t\t\t\t<Folder slot=\"icon\" :size=\"20\" />\n\t\t\t\t</NcAppNavigationItem>\n\t\t\t\t<NcAppNavigationItem to=\"/favorites\"\n\t\t\t\t\t:name=\"t('photos', 'Favorites')\"\n\t\t\t\t\tdata-id-app-nav-item=\"favorites\">\n\t\t\t\t\t<Star slot=\"icon\" :size=\"20\" />\n\t\t\t\t</NcAppNavigationItem>\n\t\t\t\t<NcAppNavigationItem :to=\"{name: 'thisday'}\"\n\t\t\t\t\t:name=\"t('photos', 'On this day')\"\n\t\t\t\t\tdata-id-app-nav-item=\"this-day\">\n\t\t\t\t\t<CalendarToday slot=\"icon\" :size=\"20\" />\n\t\t\t\t</NcAppNavigationItem>\n\t\t\t\t<NcAppNavigationItem :to=\"{name: 'shared'}\"\n\t\t\t\t\t:name=\"t('photos', 'Shared with you')\"\n\t\t\t\t\tdata-id-app-nav-item=\"shared\">\n\t\t\t\t\t<ShareVariant slot=\"icon\" :size=\"20\" />\n\t\t\t\t</NcAppNavigationItem>\n\t\t\t\t<NcAppNavigationItem v-if=\"areTagsInstalled\"\n\t\t\t\t\t:to=\"{name: 'tags'}\"\n\t\t\t\t\t:name=\"t('photos', 'Tags')\"\n\t\t\t\t\tdata-id-app-nav-item=\"tags\">\n\t\t\t\t\t<Tag slot=\"icon\" :size=\"20\" />\n\t\t\t\t</NcAppNavigationItem>\n\t\t\t\t<NcAppNavigationItem :to=\"{name: 'places'}\"\n\t\t\t\t\t:name=\"t('photos', 'Places')\"\n\t\t\t\t\tdata-id-app-nav-item=\"places\">\n\t\t\t\t\t<MapMarker slot=\"icon\" :size=\"20\" />\n\t\t\t\t</NcAppNavigationItem>\n\t\t\t\t<NcAppNavigationItem v-if=\"showLocationMenuEntry\"\n\t\t\t\t\t:to=\"{name: 'maps'}\"\n\t\t\t\t\t:name=\"t('photos', 'Map')\"\n\t\t\t\t\tdata-id-app-nav-item=\"maps\">\n\t\t\t\t\t<MapIcon slot=\"icon\" :size=\"20\" />\n\t\t\t\t</NcAppNavigationItem>\n\t\t\t</template>\n\t\t\t<template #footer>\n\t\t\t\t<div class=\"app-navigation__footer\">\n\t\t\t\t\t<NcButton type=\"tertiary\"\n\t\t\t\t\t\talignment=\"start\"\n\t\t\t\t\t\twide\n\t\t\t\t\t\t@click=\"showSettings\">\n\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t<Cog slot=\"icon\" :size=\"20\" />\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t{{ t('photos', 'Photos settings') }}\n\t\t\t\t\t</NcButton>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</NcAppNavigation>\n\t\t<NcAppContent>\n\t\t\t<RouterView />\n\n\t\t\t<!-- svg img loading placeholder (linked to the File component) -->\n\t\t\t<!-- eslint-disable-next-line vue/no-v-html (because it's an SVG file) -->\n\t\t\t<span class=\"hidden-visually\" role=\"none\" v-html=\"svgplaceholder\" />\n\t\t\t<!-- eslint-disable-next-line vue/no-v-html (because it's an SVG file) -->\n\t\t\t<span class=\"hidden-visually\" role=\"none\" v-html=\"imgplaceholder\" />\n\t\t\t<!-- eslint-disable-next-line vue/no-v-html (because it's an SVG file) -->\n\t\t\t<span class=\"hidden-visually\" role=\"none\" v-html=\"videoplaceholder\" />\n\t\t</NcAppContent>\n\n\t\t<!-- Main settings Modal-->\n\t\t<SettingsDialog :open.sync=\"openedSettings\" />\n\t</NcContent>\n</template>\n\n<script lang='ts'>\nimport { getCurrentUser } from '@nextcloud/auth'\nimport { generateUrl } from '@nextcloud/router'\nimport { loadState } from '@nextcloud/initial-state'\n\nimport Camera from 'vue-material-design-icons/Camera.vue'\nimport ImageIcon from 'vue-material-design-icons/Image.vue'\nimport VideoIcon from 'vue-material-design-icons/Video.vue'\nimport FolderMultipleImage from 'vue-material-design-icons/FolderMultipleImage.vue'\nimport Folder from 'vue-material-design-icons/Folder.vue'\nimport Star from 'vue-material-design-icons/Star.vue'\nimport CalendarToday from 'vue-material-design-icons/CalendarToday.vue'\nimport AccountGroup from 'vue-material-design-icons/AccountGroup.vue'\nimport Tag from 'vue-material-design-icons/Tag.vue'\nimport MapIcon from 'vue-material-design-icons/Map.vue'\nimport MapMarker from 'vue-material-design-icons/MapMarker.vue'\nimport ShareVariant from 'vue-material-design-icons/ShareVariant.vue'\nimport AccountBoxMultipleOutline from 'vue-material-design-icons/AccountBoxMultipleOutline.vue'\nimport Cog from 'vue-material-design-icons/Cog.vue'\n\nimport { NcContent, NcAppContent, NcAppNavigation, NcAppNavigationItem, NcButton } from '@nextcloud/vue'\n\nimport SettingsDialog from './components/Settings/SettingsDialog.vue'\n\nimport svgplaceholder from './assets/file-placeholder.svg'\nimport imgplaceholder from './assets/image.svg'\nimport videoplaceholder from './assets/video.svg'\nimport areTagsInstalled from './services/AreTagsInstalled.js'\nimport isMapsInstalled from './services/IsMapsInstalled.js'\nimport isRecognizeInstalled from './services/IsRecognizeInstalled.js'\nimport isAppStoreEnabled from './services/IsAppStoreEnabled.js'\nimport logger from './services/logger.js'\n\nexport default {\n\tname: 'Photos',\n\tcomponents: {\n\t\tAccountBoxMultipleOutline,\n\t\tCog,\n\t\tCalendarToday,\n\t\tCamera,\n\t\tAccountGroup,\n\t\tFolder,\n\t\tFolderMultipleImage,\n\t\tImageIcon,\n\t\tShareVariant,\n\t\tStar,\n\t\tTag,\n\t\tVideoIcon,\n\t\tMapIcon,\n\t\tMapMarker,\n\t\tNcAppContent,\n\t\tNcAppNavigation,\n\t\tNcAppNavigationItem,\n\t\tNcButton,\n\t\tNcContent,\n\t\tSettingsDialog,\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tsvgplaceholder,\n\t\t\timgplaceholder,\n\t\t\tvideoplaceholder,\n\t\t\tareTagsInstalled,\n\n\t\t\tshowLocationMenuEntry: getCurrentUser() === null\n\t\t\t\t? false\n\t\t\t\t: (getCurrentUser().isAdmin && isAppStoreEnabled) || isMapsInstalled,\n\t\t\tshowPeopleMenuEntry: getCurrentUser() === null\n\t\t\t\t? false\n\t\t\t\t: (getCurrentUser().isAdmin && loadState('photos', 'showPeopleMenuEntry', true) && isAppStoreEnabled) || isRecognizeInstalled,\n\n\t\t\topenedSettings: false,\n\t\t}\n\t},\n\tasync beforeMount() {\n\t\t// Register excluded paths\n\t\tconst files = loadState('photos', 'nomedia-paths', [])\n\t\tthis.$store.dispatch('setNomediaPaths', files)\n\t\tlogger.debug('Known .nomedia and .noimage  paths', { files })\n\n\t\tif ('serviceWorker' in navigator) {\n\t\t\t// Use the window load event to keep the page load performant\n\t\t\twindow.addEventListener('load', () => {\n\t\t\t\tnavigator.serviceWorker.register(generateUrl('/apps/photos/service-worker.js', {}, {\n\t\t\t\t\tnoRewrite: true,\n\t\t\t\t}), {\n\t\t\t\t\tscope: generateUrl('/apps/photos'),\n\t\t\t\t}).then(registration => {\n\t\t\t\t\tlogger.debug('SW registered: ', { registration })\n\t\t\t\t}).catch(registrationError => {\n\t\t\t\t\tlogger.error('SW registration failed: ', { registrationError })\n\t\t\t\t})\n\n\t\t\t})\n\t\t} else {\n\t\t\tlogger.debug('Service Worker is not enabled on this browser.')\n\t\t}\n\t},\n\n\tbeforeDestroy() {\n\t\twindow.removeEventListener('load', () => {\n\t\t\tnavigator.serviceWorker.register(generateUrl('/apps/photos/service-worker.js', {}, {\n\t\t\t\tnoRewrite: true,\n\t\t\t}))\n\t\t})\n\t},\n\n\tmethods: {\n\t\tshowSettings() {\n\t\t\tthis.openedSettings = true\n\t\t},\n\t},\n}\n</script>\n<style lang=\"scss\">\n.app-content {\n\tdisplay: flex;\n\tflex-grow: 1;\n\tflex-direction: column;\n\talign-content: space-between;\n}\n\n.app-navigation__photos :deep(.app-navigation-entry-icon.icon-photos) {\n\tbackground-size: 20px;\n}\n\n.app-navigation__footer {\n\tpadding: calc(var(--default-grid-baseline) * 2);\n}\n</style>\n","/**\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { loadState } from '@nextcloud/initial-state'\n\nconst imageMimes = loadState('photos', 'image-mimes', [])\nconst videoMimes = loadState('photos', 'video-mimes', [])\nconst allMimes = [...imageMimes, ...videoMimes] as string[]\n\nexport { allMimes as default, allMimes, imageMimes, videoMimes }\n","/**\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { generateUrl } from '@nextcloud/router'\nimport Router from 'vue-router'\nimport Vue from 'vue'\n\nimport { t } from '@nextcloud/l10n'\n\nimport isMapsInstalled from '../services/IsMapsInstalled.js'\nimport areTagsInstalled from '../services/AreTagsInstalled.js'\nimport { imageMimes, videoMimes } from '../services/AllowedMimes.js'\n\nimport isRecognizeInstalled from '../services/IsRecognizeInstalled.js'\n\nconst Folders = () => import('../views/Folders.vue')\nconst Albums = () => import('../views/Albums.vue')\nconst AlbumContent = () => import('../views/AlbumContent.vue')\nconst SharedAlbums = () => import('../views/SharedAlbums.vue')\nconst SharedAlbumContent = () => import('../views/SharedAlbumContent.vue')\nconst PublicAlbumContent = () => import('../views/PublicAlbumContent.vue')\nconst Places = () => import('../views/Places.vue')\nconst PlaceContent = () => import('../views/PlaceContent.vue')\nconst Tags = () => import('../views/Tags.vue')\nconst TagContent = () => import('../views/TagContent.vue')\nconst Timeline = () => import('../views/Timeline.vue')\nconst Faces = () => import('../views/Faces.vue')\nconst FaceContent = () => import('../views/FaceContent.vue')\n\nconst UnassignedFaces = () => import('../views/UnassignedFaces.vue')\n\nconst baseTitle = document.title\n\nVue.use(Router)\n\nlet mapsPath = generateUrl('/apps/maps')\nif (!isMapsInstalled) {\n\tmapsPath = generateUrl('/settings/apps/integration/maps')\n}\n\n/**\n * Parse the path of a route : join the elements of the array and return a single string with slashes\n * + always lead current path with a slash\n */\nconst parsePathParams = (path: string|string[]): string => {\n\treturn `/${Array.isArray(path) ? path.join('/') : path || ''}`\n}\n\nconst router = new Router({\n\tmode: 'history',\n\t// if index.php is in the url AND we got this far, then it's working:\n\t// let's keep using index.php in the url\n\tbase: generateUrl('/apps/photos'),\n\tlinkActiveClass: 'active',\n\troutes: [\n\t\t{\n\t\t\tpath: '/',\n\t\t\tcomponent: Timeline,\n\t\t\tname: 'all_media',\n\t\t\tprops: () => ({\n\t\t\t\trootTitle: t('photos', 'All your media'),\n\t\t\t}),\n\t\t\tmeta: {\n\t\t\t\trootTitle: () => {\n\t\t\t\t\treturn t('photos', 'All your media')\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tpath: '/photos',\n\t\t\tcomponent: Timeline,\n\t\t\tname: 'photos',\n\t\t\tprops: () => ({\n\t\t\t\trootTitle: t('photos', 'Photos'),\n\t\t\t\tmimesType: imageMimes,\n\t\t\t}),\n\t\t\tmeta: {\n\t\t\t\trootTitle: () => {\n\t\t\t\t\treturn t('photos', 'Photos')\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tpath: '/videos',\n\t\t\tcomponent: Timeline,\n\t\t\tname: 'videos',\n\t\t\tprops: () => ({\n\t\t\t\trootTitle: t('photos', 'Videos'),\n\t\t\t\tmimesType: videoMimes,\n\t\t\t}),\n\t\t\tmeta: {\n\t\t\t\trootTitle: () => {\n\t\t\t\t\treturn t('photos', 'Videos')\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tpath: '/albums',\n\t\t\tcomponent: Albums,\n\t\t\tname: 'albums',\n\t\t\tmeta: {\n\t\t\t\trootTitle: () => {\n\t\t\t\t\treturn t('photos', 'Albums')\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tpath: '/albums/:albumName*',\n\t\t\tcomponent: AlbumContent,\n\t\t\tname: 'albumsContent',\n\t\t\tprops: route => ({\n\t\t\t\talbumName: route.params.albumName,\n\t\t\t}),\n\t\t\tmeta: {\n\t\t\t\trootTitle: (to) => {\n\t\t\t\t\treturn t('photos', 'Album {title}', { title: to.params.albumName })\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tpath: '/sharedalbums',\n\t\t\tcomponent: SharedAlbums,\n\t\t\tname: 'sharedAlbums',\n\t\t\tmeta: {\n\t\t\t\trootTitle: () => {\n\t\t\t\t\treturn t('photos', 'Shared Albums')\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tpath: '/sharedalbums/:albumName*',\n\t\t\tcomponent: SharedAlbumContent,\n\t\t\tname: 'sharedAlbumsContent',\n\t\t\tprops: route => ({\n\t\t\t\talbumName: route.params.albumName,\n\t\t\t}),\n\t\t\tmeta: {\n\t\t\t\trootTitle: (to) => {\n\t\t\t\t\treturn t('photos', 'Shared album {title}', { title: to.params.albumName })\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tpath: '/public/:token',\n\t\t\tcomponent: PublicAlbumContent,\n\t\t\tname: 'publicAlbums',\n\t\t\tprops: route => ({\n\t\t\t\ttoken: route.params.token,\n\t\t\t}),\n\t\t\tmeta: {\n\t\t\t\trootTitle: (to) => {\n\t\t\t\t\treturn t('photos', 'Public album {title}', { title: to.params.token })\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tpath: '/places',\n\t\t\tcomponent: Places,\n\t\t\tname: 'places',\n\t\t},\n\t\t{\n\t\t\tpath: '/places/:placeName*',\n\t\t\tcomponent: PlaceContent,\n\t\t\tname: 'placesContent',\n\t\t\tprops: route => ({\n\t\t\t\tplaceName: route.params.placeName,\n\t\t\t}),\n\t\t},\n\t\t{\n\t\t\tpath: '/folders/:path*',\n\t\t\tcomponent: Folders,\n\t\t\tname: 'folders',\n\t\t\tprops: route => ({\n\t\t\t\tpath: parsePathParams(route.params.path),\n\t\t\t\t// if path is empty\n\t\t\t\tisRoot: !route.params.path,\n\t\t\t\trootTitle: t('photos', 'Folders'),\n\t\t\t}),\n\t\t\tmeta: {\n\t\t\t\trootTitle: () => {\n\t\t\t\t\treturn t('photos', 'Folders')\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tpath: '/shared/:path*',\n\t\t\tcomponent: Folders,\n\t\t\tname: 'shared',\n\t\t\tprops: route => ({\n\t\t\t\tpath: parsePathParams(route.params.path),\n\t\t\t\t// if path is empty\n\t\t\t\tisRoot: !route.params.path,\n\t\t\t\trootTitle: t('photos', 'Shared with you'),\n\t\t\t\tshowShared: true,\n\t\t\t}),\n\t\t\tmeta: {\n\t\t\t\trootTitle: () => {\n\t\t\t\t\treturn t('photos', 'Shared with you')\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tpath: '/favorites',\n\t\t\tcomponent: Timeline,\n\t\t\tname: 'favorites',\n\t\t\tprops: () => ({\n\t\t\t\trootTitle: t('photos', 'Favorites'),\n\t\t\t\tonlyFavorites: true,\n\t\t\t}),\n\t\t\tmeta: {\n\t\t\t\trootTitle: () => {\n\t\t\t\t\treturn t('photos', 'Favorites')\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tpath: '/tags/',\n\t\t\tcomponent: Tags,\n\t\t\tname: 'tags',\n\t\t\tredirect: !areTagsInstalled ? { name: 'timeline' } : undefined,\n\t\t\tprops: route => ({\n\t\t\t\tpath: '',\n\t\t\t\tisRoot: !route.params.path,\n\t\t\t\trootTitle: t('photos', 'Tagged photos'),\n\t\t\t}),\n\t\t\tmeta: {\n\t\t\t\trootTitle: () => {\n\t\t\t\t\treturn t('photos', 'Tagged photos')\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tpath: '/tags/:path',\n\t\t\tcomponent: TagContent,\n\t\t\tname: 'tagcontent',\n\t\t\tredirect: !areTagsInstalled ? { name: 'timeline' } : undefined,\n\t\t\tprops: route => ({\n\t\t\t\tpath: `${route.params.path ? route.params.path : ''}`,\n\t\t\t}),\n\t\t\tmeta: {\n\t\t\t\trootTitle: (to) => {\n\t\t\t\t\treturn t('photos', 'Tagged photo {title}', { title: to.params.path })\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tpath: '/maps',\n\t\t\tname: 'maps',\n\t\t\t// router-link doesn't support external url, let's force the redirect\n\t\t\tbeforeEnter() {\n\t\t\t\twindow.open(mapsPath, '_blank')\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tpath: '/thisday',\n\t\t\tname: 'thisday',\n\t\t\tcomponent: Timeline,\n\t\t\tprops: () => ({\n\t\t\t\trootTitle: t('photos', 'On this day'),\n\t\t\t\tonThisDay: true,\n\t\t\t}),\n\t\t\tmeta: {\n\t\t\t\trootTitle: () => {\n\t\t\t\t\treturn t('photos', 'On this day')\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tpath: '/faces',\n\t\t\tname: 'faces',\n\t\t\tcomponent: Faces,\n\t\t\t...((!isRecognizeInstalled) && {\n\t\t\t\tbeforeEnter() {\n\t\t\t\t\tconst recognizeInstallLink = generateUrl('/settings/apps/installed/recognize')\n\t\t\t\t\twindow.open(recognizeInstallLink, '_blank')\n\t\t\t\t},\n\t\t\t}),\n\t\t},\n\t\t{\n\t\t\tpath: '/faces/unassigned',\n\t\t\tname: 'unassignedfaces',\n\t\t\tcomponent: UnassignedFaces,\n\t\t\tmeta: {\n\t\t\t\trootTitle: () => {\n\t\t\t\t\treturn t('photos', 'Unassigned faces')\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tpath: '/faces/:faceName',\n\t\t\tname: 'facecontent',\n\t\t\tcomponent: FaceContent,\n\t\t\tprops: route => ({\n\t\t\t\trootTitle: route.params.faceName,\n\t\t\t\tfaceName: route.params.faceName,\n\t\t\t}),\n\t\t\tmeta: {\n\t\t\t\trootTitle: (to) => {\n\t\t\t\t\treturn t('photos', \"{title}'s face\", { title: to.params.faceName })\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t],\n})\n\nrouter.afterEach((to) => {\n\tconst rootTitle = to.meta?.rootTitle?.(to)\n\tif (rootTitle) {\n\t\tdocument.title = `${rootTitle} - ${baseTitle}`\n\t} else {\n\t\tdocument.title = baseTitle\n\t}\n})\n\nexport default router\n","/**\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\ntype SemaphoreWithPriorityItem = {\n\tsymbol: symbol\n\tpriority: () => number\n\tresolve: (value: symbol) => void\n}\n\n/**\n *\n * @param capacity - The number of simultaneous access to the ressource.\n */\nexport default class SemaphoreWithPriority {\n\n\t#capacity: number = 0\n\t#queue: SemaphoreWithPriorityItem[] = []\n\t#active: symbol[] = []\n\n\tconstructor(capacity: number) {\n\t\tthis.#capacity = capacity\n\n\t}\n\n\t/**\n\t * @param priority - A function that return a priority. This function will be call when looking for a next job to run so keep it quick.\n\t * @param info - An additional string to initialise the Symbol and help debugging.\n\t */\n\tasync acquire(priority: () => number = () => 1, info: string = ''): Promise<symbol> {\n\t\tconst symbol = Symbol(info)\n\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.#queue.push({ symbol, priority, resolve })\n\t\t\tif (this.#active.length < this.#capacity) {\n\t\t\t\tthis.#callNextJob()\n\t\t\t}\n\t\t})\n\t}\n\n\t/**\n\t *\n\t * @param symbol - The symbole returned by the acquire method.\n\t */\n\trelease(symbol: symbol) {\n\t\tconst symbolIndex = this.#active.indexOf(symbol)\n\t\tif (symbolIndex === -1) {\n\t\t\tthrow new Error(\"Can't release non active symbol\")\n\t\t}\n\t\tthis.#active.splice(symbolIndex, 1)\n\n\t\tif (this.#queue.length > 0 && this.#active.length < this.#capacity) {\n\t\t\tthis.#callNextJob()\n\t\t}\n\t}\n\n\t#callNextJob() {\n\t\tconst prioritizedQueue: Record<number, SemaphoreWithPriorityItem[]> = {}\n\n\t\tfor (const item of this.#queue) {\n\t\t\tconst itemPriority = item.priority()\n\t\t\tprioritizedQueue[itemPriority] = prioritizedQueue[itemPriority] ?? []\n\t\t\tprioritizedQueue[itemPriority].push(item)\n\t\t}\n\n\t\tconst highestPriority = Number.parseInt(Object.keys(prioritizedQueue).sort()[0])\n\t\tconst nextJob = prioritizedQueue[highestPriority][0]\n\t\tconst jobIndex = this.#queue.indexOf(nextJob)\n\t\tif (jobIndex === -1) {\n\t\t\tthrow new Error(\"Can't call non existant job\")\n\t\t}\n\t\tthis.#queue.splice(jobIndex, 1)\n\n\t\tthis.#active.push(nextJob.symbol)\n\t\tnextJob.resolve(nextJob.symbol)\n\t}\n}\n","/**\n * SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport type { WebDAVClient } from 'webdav'\nimport { getClient } from '@nextcloud/files/dav'\n\nexport const davClient: WebDAVClient = getClient()\n","/**\n * SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\nimport Vue from 'vue'\n\nimport moment from '@nextcloud/moment'\nimport { showError } from '@nextcloud/dialogs'\nimport { defaultRootPath } from '@nextcloud/files/dav'\nimport { t } from '@nextcloud/l10n'\n\nimport logger from '../services/logger.js'\nimport Semaphore from '../utils/semaphoreWithPriority.js'\nimport { davClient } from '../services/DavClient.ts'\nimport type { PhotoNode } from '../utils/fileUtils.ts'\n\nconst state = {\n\tfiles: {},\n\tnomediaPaths: [] as string[],\n}\n\ntype FilesState = typeof state\n\nconst mutations = {\n\t/**\n\t * Append or update given files\n\t */\n\tupdateFiles(state: FilesState, newFiles: PhotoNode[]) {\n\t\tconst files = {}\n\t\tnewFiles\n\t\t\t.filter(file => !file.hidden)\n\t\t\t.forEach(file => {\n\t\t\t\t// Ignore the file if the path is excluded\n\t\t\t\tif (state.nomediaPaths.some(nomediaPath => file.filename.startsWith(nomediaPath)\n\t\t\t\t\t|| file.filename.startsWith(`${defaultRootPath}${nomediaPath}`))) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tif (file.fileid >= 0) {\n\t\t\t\t\tfile.metadataPhotosSize ??= { width: 256, height: 256 }\n\t\t\t\t}\n\n\t\t\t\t// Make the fileId a string once and for all.\n\t\t\t\tfile.fileid = file.fileid.toString()\n\n\t\t\t\t// Precalculate dates as it is expensive.\n\t\t\t\tconst date = moment((file.metadataPhotosOriginalDateTime * 1000) || file.lastmod)\n\t\t\t\tfile.timestamp = date.unix() // For sorting\n\t\t\t\tfile.month = date.format('YYYYMM') // For grouping by month\n\t\t\t\tfile.day = date.format('MMDD') // For On this day\n\n\t\t\t\t// Schedule the file to add\n\t\t\t\tfiles[file.fileid] = file\n\t\t\t})\n\n\t\tstate.files = {\n\t\t\t...state.files,\n\t\t\t...files,\n\t\t}\n\t},\n\n\t/**\n\t * Set a folder subfolders\n\t */\n\tsetSubFolders(state: FilesState, { fileid, folders }: { fileid: number, folders: PhotoNode[] }) {\n\t\tif (state.files[fileid]) {\n\t\t\tconst subfolders = folders\n\t\t\t\t.map(folder => folder.fileid)\n\t\t\t\t// some invalid folders have an id of -1 (ext storage)\n\t\t\t\t.filter(id => id >= 0)\n\t\t\tVue.set(state.files[fileid], 'folders', subfolders)\n\t\t}\n\t},\n\n\t/**\n\t * Set list of all .nomedia/.noimage files\n\t */\n\tsetNomediaPaths(state: FilesState, paths: string[]) {\n\t\tstate.nomediaPaths = paths\n\t},\n\n\t/**\n\t * Delete a file\n\t */\n\tdeleteFile(state: FilesState, fileId: number) {\n\t\tVue.delete(state.files, fileId)\n\t},\n\n\t/**\n\t * Favorite a list of files\n\t */\n\tfavoriteFile(state: FilesState, { fileId, favoriteState }: { fileId: number, favoriteState: 0|1 }) {\n\t\tVue.set(state.files[fileId], 'favorite', favoriteState)\n\t},\n}\n\nconst getters = {\n\tfiles: (state: FilesState) => state.files,\n\tnomediaPaths: (state: FilesState) => state.nomediaPaths,\n}\n\nconst actions = {\n\t/**\n\t * Update files, folders and their respective subfolders\n\t */\n\tupdateFiles(context, { folder, files = [], folders = [] }: { folder: PhotoNode, files: PhotoNode[], folders: PhotoNode[]}) {\n\t\t// we want all the FileInfo! Folders included!\n\t\tcontext.commit('updateFiles', [folder, ...files, ...folders])\n\t\tcontext.commit('setSubFolders', { fileid: folder.fileid, folders })\n\t},\n\n\t/**\n\t * Append or update given files\n\t */\n\tappendFiles(context, files: PhotoNode[] = []) {\n\t\tcontext.commit('updateFiles', files)\n\t},\n\n\t/**\n\t * Set list of all .nomedia/.noimage files\n\t */\n\tsetNomediaPaths(context, paths: string[]) {\n\t\tlogger.debug('Ignored paths', { paths })\n\t\tcontext.commit('setNomediaPaths', paths)\n\t},\n\n\t/**\n\t * Delete a list of files\n\t */\n\tdeleteFiles(context, fileIds: number[]) {\n\t\tconst semaphore = new Semaphore(5)\n\n\t\tconst files = fileIds\n\t\t\t.map(fileId => state.files[fileId])\n\t\t\t.reduce((files, file) => ({ ...files, [file.fileid]: file }), {})\n\n\t\tfileIds.forEach(fileId => context.commit('deleteFile', fileId))\n\n\t\tconst promises = fileIds\n\t\t\t.map(async (fileId) => {\n\t\t\t\tconst file = files[fileId]\n\t\t\t\tconst symbol = await semaphore.acquire()\n\n\t\t\t\ttry {\n\t\t\t\t\tawait davClient.deleteFile(file.filename)\n\t\t\t\t} catch (error) {\n\t\t\t\t\tlogger.error(t('photos', 'Failed to delete {fileId}', { fileId }), { error })\n\t\t\t\t\tshowError(t('photos', 'Failed to delete {fileName}', { fileName: file.basename }))\n\t\t\t\t\tcontext.dispatch('appendFiles', [file])\n\t\t\t\t} finally {\n\t\t\t\t\tsemaphore.release(symbol)\n\t\t\t\t}\n\t\t\t})\n\n\t\treturn Promise.all(promises)\n\t},\n\n\t/**\n\t * Favorite a list of files\n\t */\n\ttoggleFavoriteForFiles(context, { fileIds, favoriteState }: { fileIds: string[], favoriteState: 0|1 }) {\n\t\tconst semaphore = new Semaphore(5)\n\n\t\tconst promises = fileIds\n\t\t\t.map(async (fileId) => {\n\t\t\t\tconst file = context.state.files[fileId]\n\t\t\t\tconst symbole = await semaphore.acquire()\n\n\t\t\t\ttry {\n\t\t\t\t\tcontext.commit('favoriteFile', { fileId, favoriteState })\n\t\t\t\t\tawait davClient.customRequest(\n\t\t\t\t\t\tfile.filename,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmethod: 'PROPPATCH',\n\t\t\t\t\t\t\tdata: `<?xml version=\"1.0\"?>\n\t\t\t\t\t\t\t<d:propertyupdate xmlns:d=\"DAV:\"\n\t\t\t\t\t\t\t\txmlns:oc=\"http://owncloud.org/ns\"\n\t\t\t\t\t\t\t\txmlns:nc=\"http://nextcloud.org/ns\"\n\t\t\t\t\t\t\t\txmlns:ocs=\"http://open-collaboration-services.org/ns\">\n\t\t\t\t\t\t\t<d:set>\n\t\t\t\t\t\t\t\t<d:prop>\n\t\t\t\t\t\t\t\t\t<oc:favorite>${favoriteState}</oc:favorite>\n\t\t\t\t\t\t\t\t</d:prop>\n\t\t\t\t\t\t\t</d:set>\n\t\t\t\t\t\t\t</d:propertyupdate>`,\n\t\t\t\t\t\t},\n\t\t\t\t\t)\n\t\t\t\t} catch (error) {\n\t\t\t\t\tcontext.commit('favoriteFile', { fileId, favoriteState: favoriteState === 0 ? 1 : 0 })\n\t\t\t\t\tlogger.error(t('photos', 'Failed to set favorite state for {fileId}', { fileId: file.fileid }), { error })\n\t\t\t\t\tshowError(t('photos', 'Failed to set favorite state for {fileName}', { fileName: file.basename }))\n\t\t\t\t}\n\n\t\t\t\treturn semaphore.release(symbole)\n\t\t\t})\n\n\t\treturn Promise.all(promises)\n\t},\n}\n\nexport default { state, mutations, getters, actions }\n","/**\n * SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { MutationTree } from 'vuex'\n\nimport { showError } from '@nextcloud/dialogs'\nimport { translate as t } from '@nextcloud/l10n'\n\nimport { davClient } from '../services/DavClient.ts'\nimport logger from '../services/logger.js'\nimport Semaphore from '../utils/semaphoreWithPriority.js'\nimport type { Collection } from '../services/collectionFetcher.ts'\n\n/**\n * Collections are indexed by their `filename`.\n */\nconst state = {\n\tcollections: {\n\t\t// \"photos/{userName}/{collection}/{collectionName}\": Collection,\n\t\t// ...\n\t} as Record<string, Collection>,\n\tcollectionsFiles: {\n\t\t// \"photos/{userName}/{collection}/{collectionName}\": [\"1\", \"2\", ...],\n\t\t// ...\n\t} as Record<string, string[]>,\n}\n\ntype CollectionState = typeof state\n\nconst mutations: MutationTree = {\n\t/**\n\t * Add new collections.\n\t */\n\taddCollections(state: CollectionState, { collections }: { collections: Collection[]}) {\n\t\tstate.collections = {\n\t\t\t...state.collections,\n\t\t\t...collections.reduce((collections, collection) => ({ ...collections, [collection.filename]: collection }), {}),\n\t\t}\n\t},\n\n\t/**\n\t * Add collections to the collection collection.\n\t */\n\tupdateCollection(state: CollectionState, { collection }: { collection: Collection}) {\n\t\tstate.collections[collection.filename] = collection\n\t},\n\n\t/**\n\t * Remove collections from the collection collection.\n\t */\n\tremoveCollections(state: CollectionState, { collectionFileNames }: { collectionFileNames: string[]}) {\n\t\tcollectionFileNames.forEach(collectionFileName => delete state.collections[collectionFileName])\n\t\tcollectionFileNames.forEach(collectionFileName => delete state.collectionsFiles[collectionFileName])\n\t},\n\n\t/**\n\t * Add files to an collection.\n\t */\n\tsetCollectionFiles(state: CollectionState, { collectionFileName, fileIds = [] }: { collectionFileName: string, fileIds: string[]}) {\n\t\tconst collectionFiles = state.collectionsFiles[collectionFileName] || []\n\t\tstate.collectionsFiles = {\n\t\t\t...state.collectionsFiles,\n\t\t\t[collectionFileName]: [...new Set([...collectionFiles, ...fileIds])],\n\t\t}\n\n\t\tif (state.collections[collectionFileName] !== undefined) {\n\t\t\tstate.collections[collectionFileName].nbItems = fileIds.length\n\t\t\tstate.collections[collectionFileName].lastPhoto = Number.parseInt(fileIds[fileIds.length - 1])\n\t\t}\n\t},\n\n\t/**\n\t * Add files to an collection.\n\t */\n\taddFilesToCollection(state: CollectionState, { collectionFileName, fileIdsToAdd }: { collectionFileName: string, fileIdsToAdd: string[]}) {\n\t\tconst collectionFiles = state.collectionsFiles[collectionFileName] || []\n\t\tstate.collectionsFiles = {\n\t\t\t...state.collectionsFiles,\n\t\t\t[collectionFileName]: [...new Set([...collectionFiles, ...fileIdsToAdd])],\n\t\t}\n\n\t\tstate.collections[collectionFileName].nbItems += fileIdsToAdd.length\n\t\tstate.collections[collectionFileName].lastPhoto = Number.parseInt(fileIdsToAdd[fileIdsToAdd.length - 1])\n\t},\n\n\t/**\n\t * Remove files from a collection.\n\t */\n\tremoveFilesFromCollection(state: CollectionState, { collectionFileName, fileIdsToRemove }: { collectionFileName: string, fileIdsToRemove: string[]}) {\n\t\tstate.collectionsFiles = {\n\t\t\t...state.collectionsFiles,\n\t\t\t[collectionFileName]: state.collectionsFiles[collectionFileName].filter(fileId => !fileIdsToRemove.includes(fileId)),\n\t\t}\n\n\t\tstate.collections[collectionFileName].nbItems -= fileIdsToRemove.length\n\t\tif (fileIdsToRemove.includes(state.collections[collectionFileName].lastPhoto.toString())) {\n\t\t\tstate.collections[collectionFileName].lastPhoto = Number.parseInt(state.collectionsFiles[collectionFileName][state.collectionsFiles[collectionFileName].length])\n\t\t}\n\t},\n}\n\nconst getters = {\n\tcollections: (state: CollectionState) => state.collections,\n\tcollectionsFiles: (state: CollectionState) => state.collectionsFiles,\n\tcollectionsWithPrefix: (state: CollectionState) => function(prefix) {\n\t\treturn Object.values(state.collections)\n\t\t\t.filter(collection => collection.filename.startsWith(prefix))\n\t\t\t.reduce((collections, collection) => ({ ...collections, [collection.filename]: collection }), {})\n\t},\n}\n\nconst actions = {\n\t/**\n\t * Update files and collections\n\t */\n\taddCollections(context, { collections }: { collections: Collection[]}) {\n\t\tcontext.commit('addCollections', { collections })\n\t},\n\n\t/**\n\t * Add files to an collection.\n\t */\n\tasync addFilesToCollection(context, { collectionFileName, fileIdsToAdd }: { collectionFileName: string, fileIdsToAdd: string[] }) {\n\t\tconst semaphore = new Semaphore(5)\n\n\t\tcontext.commit('addFilesToCollection', { collectionFileName, fileIdsToAdd })\n\n\t\tconst promises = fileIdsToAdd\n\t\t\t.map(async (fileId) => {\n\t\t\t\tconst file = context.getters.files[fileId]\n\t\t\t\tconst collection = context.getters.collections[collectionFileName]\n\t\t\t\tconst symbol = await semaphore.acquire()\n\n\t\t\t\ttry {\n\t\t\t\t\tawait davClient.copyFile(\n\t\t\t\t\t\tfile.filename,\n\t\t\t\t\t\t`${collection.filename}/${file.basename}`,\n\t\t\t\t\t)\n\t\t\t\t} catch (error) {\n\t\t\t\t\tif (error.response.status !== 409) { // Already in the collection.\n\t\t\t\t\t\tcontext.commit('removeFilesFromCollection', { collectionFileName, fileIdsToRemove: [fileId] })\n\n\t\t\t\t\t\tlogger.error(t('photos', 'Failed to add {fileBaseName} to collection {collectionFileName}', { fileBaseName: file.basename, collectionFileName }), { error })\n\t\t\t\t\t\tshowError(t('photos', 'Failed to add {fileBaseName} to collection {collectionFileName}', { fileBaseName: file.basename, collectionFileName }))\n\t\t\t\t\t}\n\t\t\t\t} finally {\n\t\t\t\t\tsemaphore.release(symbol)\n\t\t\t\t}\n\t\t\t})\n\n\t\treturn Promise.all(promises)\n\t},\n\n\t/**\n\t * Remove files to an collection.\n\t */\n\tasync removeFilesFromCollection(context, { collectionFileName, fileIdsToRemove }: { collectionFileName: string, fileIdsToRemove: string[] }) {\n\t\tconst semaphore = new Semaphore(5)\n\n\t\tcontext.commit('removeFilesFromCollection', { collectionFileName, fileIdsToRemove })\n\n\t\tconst promises = fileIdsToRemove\n\t\t\t.map(async (fileId) => {\n\t\t\t\tconst file = context.getters.files[fileId]\n\t\t\t\tconst symbol = await semaphore.acquire()\n\n\t\t\t\ttry {\n\t\t\t\t\tawait davClient.deleteFile(file.filename)\n\t\t\t\t} catch (error) {\n\t\t\t\t\tcontext.commit('addFilesToCollection', { collectionFileName, fileIdsToAdd: [fileId] })\n\n\t\t\t\t\tlogger.error(t('photos', 'Failed to delete {fileBaseName}', { fileBaseName: file.basename }), { error })\n\t\t\t\t\tshowError(t('photos', 'Failed to delete {fileBaseName}', { fileBaseName: file.basename }))\n\t\t\t\t} finally {\n\t\t\t\t\tsemaphore.release(symbol)\n\t\t\t\t}\n\t\t\t})\n\n\t\treturn Promise.all(promises)\n\t},\n\n\t/**\n\t * Create an collection.\n\t */\n\tasync createCollection(context, { collection }: { collection: Collection }) {\n\t\ttry {\n\t\t\tawait davClient.createDirectory(collection.filename)\n\t\t\tcontext.commit('addCollections', { collections: [collection] })\n\t\t\treturn collection\n\t\t} catch (error) {\n\t\t\tlogger.error(t('photos', 'Failed to create {collectionFileName}', { collectionFileName: collection.filename }), { error })\n\t\t\tshowError(t('photos', 'Failed to create {collectionFileName}', { collectionFileName: collection.filename }))\n\t\t}\n\t},\n\n\t/**\n\t * Rename an collection.\n\t */\n\tasync renameCollection(context, { collectionFileName, newBaseName }: { collectionFileName: string, newBaseName: string}) {\n\t\tconst collection = state.collections[collectionFileName]\n\t\tconst newCollection = {\n\t\t\t...collection,\n\t\t\tbasename: newBaseName,\n\t\t\tfilename: collection.filename.replace(new RegExp(`${collection.basename}$`), newBaseName),\n\t\t}\n\n\t\ttry {\n\t\t\tcontext.commit('addCollections', { collections: [newCollection] })\n\t\t\tcontext.commit('setCollectionFiles', { collectionFileName: newCollection.filename, fileIds: context.state.collectionsFiles[collectionFileName] })\n\t\t\tawait davClient.moveFile(collection.filename, newCollection.filename)\n\t\t\tcontext.commit('removeCollections', { collectionFileNames: [collectionFileName] })\n\t\t\treturn newCollection\n\t\t} catch (error) {\n\t\t\tcontext.commit('removeCollections', { collectionFileNames: [newCollection.filename] })\n\t\t\tlogger.error(t('photos', 'Failed to rename {currentCollectionFileName} to {newCollectionFileName}', { currentCollectionFileName: collectionFileName, newCollectionFileName: newCollection.filename }), { error })\n\t\t\tshowError(t('photos', 'Failed to rename {currentCollectionFileName} to {newCollectionFileName}', { currentCollectionFileName: collectionFileName, newCollectionFileName: newCollection.filename }))\n\t\t\treturn collection\n\t\t}\n\t},\n\n\t/**\n\t * Update an collection's properties.\n\t */\n\tasync updateCollection(context, { collectionFileName, properties }: { collectionFileName: string, properties: object }) {\n\t\tconst collection = context.state.collections[collectionFileName]\n\n\t\tconst updatedCollection = { ...collection, ...properties }\n\n\t\tconst stringifiedProperties = Object\n\t\t\t.entries(properties)\n\t\t\t.map(([name, value]) => {\n\t\t\t\tswitch (typeof value) {\n\t\t\t\tcase 'string':\n\t\t\t\t\treturn `<nc:${name}>${value}</nc:${name}>`\n\t\t\t\tcase 'object':\n\t\t\t\t\treturn `<nc:${name}>${JSON.stringify(value)}</nc:${name}>`\n\t\t\t\tdefault:\n\t\t\t\t\treturn ''\n\t\t\t\t}\n\t\t\t})\n\t\t\t.join()\n\n\t\ttry {\n\t\t\tcontext.commit('updateCollection', { collection: updatedCollection })\n\n\t\t\tawait davClient.customRequest(\n\t\t\t\tcollection.filename,\n\t\t\t\t{\n\t\t\t\t\tmethod: 'PROPPATCH',\n\t\t\t\t\tdata: `<?xml version=\"1.0\"?>\n\t\t\t\t\t\t\t<d:propertyupdate xmlns:d=\"DAV:\"\n\t\t\t\t\t\t\t\txmlns:oc=\"http://owncloud.org/ns\"\n\t\t\t\t\t\t\t\txmlns:nc=\"http://nextcloud.org/ns\"\n\t\t\t\t\t\t\t\txmlns:ocs=\"http://open-collaboration-services.org/ns\">\n\t\t\t\t\t\t\t<d:set>\n\t\t\t\t\t\t\t\t<d:prop>\n\t\t\t\t\t\t\t\t\t${stringifiedProperties}\n\t\t\t\t\t\t\t\t</d:prop>\n\t\t\t\t\t\t\t</d:set>\n\t\t\t\t\t\t\t</d:propertyupdate>`,\n\t\t\t\t},\n\t\t\t)\n\n\t\t\treturn updatedCollection\n\t\t} catch (error) {\n\t\t\tcontext.commit('updateCollection', { collection })\n\t\t\tlogger.error(t('photos', 'Failed to update properties of {collectionFileName} with {properties}', { collectionFileName, properties: JSON.stringify(properties) }), { error })\n\t\t\tshowError(t('photos', 'Failed to update properties of {collectionFileName} with {properties}', { collectionFileName, properties: JSON.stringify(properties) }))\n\t\t\treturn collection\n\t\t}\n\t},\n\n\t/**\n\t * Delete an collection.\n\t */\n\tasync deleteCollection(context, { collectionFileName }: { collectionFileName: string}) {\n\t\ttry {\n\t\t\tconst collection = context.getters.collections[collectionFileName]\n\t\t\tawait davClient.deleteFile(collection.filename)\n\t\t\tcontext.commit('removeCollections', { collectionFileNames: [collectionFileName] })\n\t\t} catch (error) {\n\t\t\tlogger.error(t('photos', 'Failed to delete {collectionFileName}', { collectionFileName }), { error })\n\t\t\tshowError(t('photos', 'Failed to delete {collectionFileName}', { collectionFileName }))\n\t\t}\n\t},\n}\n\nexport default { state, mutations, getters, actions }\n","/**\n * SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nconst isNumber = function(num: number): boolean {\n\tif (!num) {\n\t\treturn false\n\t}\n\treturn Number(num).toString() === num.toString()\n}\n\nexport { isNumber }\n","/**\n * SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\nimport { defaultRemoteURL } from '@nextcloud/files/dav'\nimport { getLanguage } from '@nextcloud/l10n'\nimport camelcase from 'camelcase'\nimport { isNumber } from './numberUtils.js'\n\nexport type PhotoNode = {\n\tfileid: string\n\tbasename: string\n\tfilename: string\n\tsource: string\n\tisFavorite: boolean\n\ttype: 'file' | 'folder'\n\tmime: string\n\thidden: boolean\n\tmetadataPhotosSize: { width: number, height: number }\n\tmetadataPhotosOriginalDateTime: number\n\tlastmod: number\n\ttimestamp: number\n\tmonth: string\n\tday: string\n}\n\n/**\n * Get an url encoded path\n */\nconst encodeFilePath = function(path: string): string {\n\tconst pathSections = (path.startsWith('/') ? path : `/${path}`).split('/')\n\tlet relativePath = ''\n\tpathSections.forEach((section) => {\n\t\tif (section !== '') {\n\t\t\trelativePath += '/' + encodeURIComponent(section)\n\t\t}\n\t})\n\treturn relativePath\n}\n\n/**\n * Extract dir and name from file path\n */\nconst extractFilePaths = function(path: string): [string, string] {\n\tconst pathSections = path.split('/')\n\tconst fileName = pathSections[pathSections.length - 1]\n\tconst dirPath = pathSections.slice(0, pathSections.length - 1).join('/')\n\treturn [dirPath, fileName]\n}\n\n/**\n * Sorting comparison function\n */\nconst sortCompare = function(fileInfo1: PhotoNode, fileInfo2: PhotoNode, key: string, asc: boolean = true): number {\n\n\t// favorite always first\n\tif (fileInfo1.isFavorite && !fileInfo2.isFavorite) {\n\t\treturn -1\n\t} else if (!fileInfo1.isFavorite && fileInfo2.isFavorite) {\n\t\treturn 1\n\t}\n\n\t// if this is a number, let's sort by integer\n\tif (isNumber(fileInfo1[key]) && isNumber(fileInfo2[key])) {\n\t\treturn asc\n\t\t\t? Number(fileInfo2[key]) - Number(fileInfo1[key])\n\t\t\t: Number(fileInfo1[key]) - Number(fileInfo2[key])\n\t}\n\n\t// else we sort by string, so let's sort directories first\n\tif (fileInfo1.type !== 'file' && fileInfo2.type === 'file') {\n\t\treturn asc ? -1 : 1\n\t} else if (fileInfo1.type === 'file' && fileInfo2.type !== 'file') {\n\t\treturn asc ? 1 : -1\n\t}\n\n\t// if this is a date, let's sort by date\n\tif (isNumber(new Date(fileInfo1[key]).getTime()) && isNumber(new Date(fileInfo2[key]).getTime())) {\n\t\treturn asc\n\t\t\t? new Date(fileInfo2[key]).getTime() - new Date(fileInfo1[key]).getTime()\n\t\t\t: new Date(fileInfo1[key]).getTime() - new Date(fileInfo2[key]).getTime()\n\t}\n\n\t// finally sort by name\n\treturn asc\n\t\t? fileInfo1[key]?.toString()?.localeCompare(fileInfo2[key].toString(), getLanguage()) || 1\n\t\t: -fileInfo1[key]?.toString()?.localeCompare(fileInfo2[key].toString(), getLanguage()) || -1\n}\n\nfunction genFileInfo(obj: { filename: string }): PhotoNode {\n\tconst fileInfo = flattenAndFormatObject(obj, flattenAndFormatObject) as PhotoNode\n\n\tif (fileInfo.filename) {\n\t\tconst url = new URL(fileInfo.filename, defaultRemoteURL)\n\t\t// Adding context\n\t\tfileInfo.source = url.href\n\t\tfileInfo.filename = fileInfo.filename.replace('remote.php/dav/', '')\n\t}\n\n\treturn fileInfo\n}\n\nfunction extractTagInfo(obj: object): PhotoNode {\n\treturn flattenAndFormatObject(obj, flattenAndFormatObject) as PhotoNode\n}\n\nfunction flattenAndFormatObject(obj: object, callback?: (data: object) => Partial<PhotoNode>): Partial<PhotoNode> {\n\treturn Object.entries(obj).reduce((resultObj, [key, data]) => {\n\t\t// flatten object if any\n\t\tif (!!data && typeof data === 'object' && !Array.isArray(data)) {\n\t\t\treturn { ...resultObj, ...(callback ? callback(data) : { [camelcase(key)]: data }) }\n\t\t}\n\n\t\t// format key and add it to the tagInfo\n\t\tswitch (data) {\n\t\tcase 'false':\n\t\t\treturn { ...resultObj, [camelcase(key)]: false }\n\t\tcase 'true':\n\t\t\treturn { ...resultObj, [camelcase(key)]: true }\n\t\tdefault:\n\t\t\treturn { ...resultObj, [camelcase(key)]: isNumber(data) ? Number(data) : data }\n\t\t}\n\t}, {})\n}\n\nexport { encodeFilePath, extractFilePaths, sortCompare, genFileInfo, extractTagInfo }\n","/**\n * SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { getDavProperties } from '@nextcloud/files/dav'\n\n/**\n * Used to cache the props\n */\nlet props: string|null = null\n\n/**\n * Get the default WebDAV properties\n * This is cached for performance reasons\n */\nexport const getDefaultDavProps = () => {\n\tif (props === null) {\n\t\tprops = getDavProperties()\n\t}\n\treturn props\n}\n\nexport function getPropFind(extraProps: string[] = []): string {\n\treturn `<?xml version=\"1.0\"?>\n\t\t\t<d:propfind xmlns:d=\"DAV:\"\n\t\t\t\txmlns:oc=\"http://owncloud.org/ns\"\n\t\t\t\txmlns:nc=\"http://nextcloud.org/ns\"\n\t\t\t\txmlns:ocs=\"http://open-collaboration-services.org/ns\">\n\t\t\t\t<d:prop>\n\t\t\t\t\t${getDefaultDavProps()}\n\t\t\t\t\t${extraProps.join('\\n')}\n\t\t\t\t</d:prop>\n\t\t\t</d:propfind>`\n}\n","/* eslint-disable jsdoc/require-jsdoc */\n/**\n * SPDX-FileCopyrightText: 2024 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { getDefaultPropfind, resultToNode, defaultRootPath } from '@nextcloud/files/dav'\nimport { loadState } from '@nextcloud/initial-state'\nimport { joinPaths } from '@nextcloud/paths'\nimport { showError } from '@nextcloud/dialogs'\nimport { emit } from '@nextcloud/event-bus'\nimport { translate as t } from '@nextcloud/l10n'\nimport { generateUrl } from '@nextcloud/router'\nimport axios from '@nextcloud/axios'\n\nimport { davClient } from '../services/DavClient.ts'\nimport logger from '../services/logger.js'\nimport type { FileStat, ResponseDataDetailed } from 'webdav'\nimport type { Folder } from '@nextcloud/files'\n\nexport const configChangedEvent = 'photos:user-config-changed'\n\nexport async function getFolder(path) {\n\tconst location = joinPaths(defaultRootPath, path) + '/'\n\n\ttry {\n\t\tconst stat = await davClient.stat(location, { details: true, data: getDefaultPropfind() }) as ResponseDataDetailed<FileStat>\n\t\treturn resultToNode(stat.data)\n\t} catch (error) {\n\t\tif (error.response?.status === 404) {\n\t\t\tlogger.debug('Photo location does not exist, creating it.')\n\t\t\tawait davClient.createDirectory(location)\n\t\t\tconst stat = await davClient.stat(location, { details: true, data: getDefaultPropfind() }) as ResponseDataDetailed<FileStat>\n\t\t\treturn resultToNode(stat.data)\n\t\t} else {\n\t\t\tlogger.fatal(error)\n\t\t\tshowError(t('photos', 'Could not load photos folder'))\n\t\t}\n\t}\n\n\tthrow new Error(\"Couldn't fetch photos upload folder\")\n}\n\ntype UserConfigState = {\n\tcroppedLayout: boolean\n\tphotosSourceFolders: string[]\n\tphotosLocation: string\n\tphotosLocationFolder?: Folder\n}\n\nconst module = {\n\tstate() {\n\t\treturn {\n\t\t\tcroppedLayout: loadState('photos', 'croppedLayout', 'false') as 'false'|'true' === 'true',\n\t\t\tphotosSourceFolders: JSON.parse(loadState('photos', 'photosSourceFolders', '[\"/Photos\"]')),\n\t\t\tphotosLocation: loadState('photos', 'photosLocation', ''),\n\t\t\tphotosLocationFolder: undefined,\n\t\t} as UserConfigState\n\t},\n\tmutations: {\n\t\tupdateUserConfig(state: UserConfigState, { key, value }) {\n\t\t\tstate[key] = value\n\t\t},\n\t},\n\tactions: {\n\t\tasync updateUserConfig({ commit }, { key, value }) {\n\t\t\tcommit('updateUserConfig', { key, value })\n\t\t\tawait axios.put(generateUrl('apps/photos/api/v1/config/' + key), {\n\t\t\t\tvalue: (typeof value === 'string') ? value : JSON.stringify(value),\n\t\t\t})\n\t\t\temit(configChangedEvent, { key, value })\n\t\t},\n\t},\n}\n\nexport default module\n","/**\n * SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport Vue from 'vue'\nimport Vuex, { Store } from 'vuex'\n\nimport { getCurrentUser } from '@nextcloud/auth'\n\nimport files from './files.js'\nimport albums from './albums.js'\nimport publicAlbums from './publicAlbums.js'\nimport sharedAlbums from './sharedAlbums.js'\nimport collections from './collections.js'\nimport places from './places.js'\nimport faces from './faces.js'\nimport folders from './folders.js'\nimport systemtags from './systemtags.js'\nimport userConfig, { getFolder } from './userConfig.js'\n\n/**\n * Get the information of photosLocation and store it as photosLocationFolder\n */\nasync function initPhotosLocationFolder(store: typeof photosStore, state) {\n\tconst photosLocationFolder = await getFolder(state.userConfig.photosLocation)\n\tstore.commit('updateUserConfig', { key: 'photosLocationFolder', value: photosLocationFolder })\n}\n\nVue.use(Vuex)\nconst photosStore = new Store({\n\tmodules: {\n\t\tfiles,\n\t\tfolders,\n\t\talbums,\n\t\tsharedAlbums,\n\t\tpublicAlbums,\n\t\tfaces,\n\t\tsystemtags,\n\t\tcollections,\n\t\tplaces,\n\t\tuserConfig,\n\t},\n\n\tplugins: [\n\t\t(store) => {\n\t\t\tif (getCurrentUser() !== null) {\n\t\t\t\tinitPhotosLocationFolder(store, store.state)\n\t\t\t}\n\n\t\t\tstore.subscribe(async (mutation, state) => {\n\t\t\t\tif (mutation.type === 'updateUserConfig' && mutation.payload.key === 'photosLocation') {\n\t\t\t\t\tinitPhotosLocationFolder(store, state)\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\t],\n\n\tstrict: process.env.NODE_ENV !== 'production',\n})\n\nexport default photosStore\n","/**\n * SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { registerDavProperty } from '@nextcloud/files/dav'\nimport { sync } from 'vuex-router-sync'\nimport { translate, translatePlural } from '@nextcloud/l10n'\nimport Vue from 'vue'\n\nimport Photos from './Photos.vue'\nimport router from './router/index.js'\nimport store from './store/index.js'\n\nsync(store, router)\n\nVue.prototype.t = translate\nVue.prototype.n = translatePlural\n\nregisterDavProperty('nc:metadata-photos-size')\nregisterDavProperty('nc:metadata-files-live-photo')\nregisterDavProperty('nc:metadata-blurhash')\nregisterDavProperty('nc:metadata-photos-original_date_time')\n\n// TODO: remove when we have a proper fileinfo standalone library\n// original scripts are loaded from\n// https://github.com/nextcloud/server/blob/5bf3d1bb384da56adbf205752be8f840aac3b0c5/lib/private/legacy/template.php#L120-L122\nwindow.addEventListener('DOMContentLoaded', () => {\n\tif (!window.OCA.Files) {\n\t\twindow.OCA.Files = {}\n\t}\n\t// register unused client for the sidebar to have access to its parser methods\n\tObject.assign(window.OCA.Files, { App: { fileList: { filesClient: OC.Files.getClient() } } }, window.OCA.Files)\n})\n\nexport default new Vue({\n\tel: '#content',\n\t// eslint-disable-next-line vue/match-component-file-name\n\tname: 'PhotosRoot',\n\trouter,\n\tstore,\n\trender: h => h(Photos),\n})\n","<!--\n  - SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<NcContent app-name=\"photos\">\n\t\t<NcAppContent>\n\t\t\t<router-view />\n\n\t\t\t<!-- svg img loading placeholder (linked to the File component) -->\n\t\t\t<!-- eslint-disable-next-line vue/no-v-html (because it's an SVG file) -->\n\t\t\t<span class=\"hidden-visually\" role=\"none\" v-html=\"svgplaceholder\" />\n\t\t\t<!-- eslint-disable-next-line vue/no-v-html (because it's an SVG file) -->\n\t\t\t<span class=\"hidden-visually\" role=\"none\" v-html=\"imgplaceholder\" />\n\t\t\t<!-- eslint-disable-next-line vue/no-v-html (because it's an SVG file) -->\n\t\t\t<span class=\"hidden-visually\" role=\"none\" v-html=\"videoplaceholder\" />\n\t\t</NcAppContent>\n\t</NcContent>\n</template>\n\n<script lang='ts'>\nimport { generateUrl } from '@nextcloud/router'\n\nimport { NcContent, NcAppContent } from '@nextcloud/vue'\n\nimport logger from './services/logger.js'\nimport svgplaceholder from './assets/file-placeholder.svg'\nimport imgplaceholder from './assets/image.svg'\nimport videoplaceholder from './assets/video.svg'\n\nexport default {\n\tname: 'PhotosPublic',\n\tcomponents: {\n\t\tNcAppContent,\n\t\tNcContent,\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tsvgplaceholder,\n\t\t\timgplaceholder,\n\t\t\tvideoplaceholder,\n\t\t}\n\t},\n\n\tasync beforeMount() {\n\t\tif ('serviceWorker' in navigator) {\n\t\t\t// Use the window load event to keep the page load performant\n\t\t\twindow.addEventListener('load', async () => {\n\t\t\t\ttry {\n\t\t\t\t\tconst url = generateUrl('/apps/photos/service-worker.js', {}, { noRewrite: true })\n\t\t\t\t\tconst registration = await navigator.serviceWorker.register(url, { scope: generateUrl('/apps/photos') })\n\t\t\t\t\tlogger.debug('SW registered: ', { registration })\n\t\t\t\t} catch (error) {\n\t\t\t\t\tlogger.error('SW registration failed: ', { error })\n\t\t\t\t}\n\t\t\t})\n\t\t} else {\n\t\t\tlogger.debug('Service Worker is not enabled on this browser.')\n\t\t}\n\t},\n\n\tbeforeDestroy() {\n\t\twindow.removeEventListener('load', () => {\n\t\t\tnavigator.serviceWorker.register(generateUrl('/apps/photos/service-worker.js', {}, {\n\t\t\t\tnoRewrite: true,\n\t\t\t}))\n\t\t})\n\t},\n}\n</script>\n<style lang=\"scss\">\n.app-content {\n\tdisplay: flex;\n\tflex-grow: 1;\n\tflex-direction: column;\n\talign-content: space-between;\n}\n\n.app-navigation__photos:deep(.app-navigation-entry-icon.icon-photos) {\n\tbackground-size: 20px;\n}\n</style>\n","/**\n * SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { sync } from 'vuex-router-sync'\nimport { translate, translatePlural } from '@nextcloud/l10n'\nimport Vue from 'vue'\n\nimport PhotosPublic from './PhotosPublic.vue'\nimport router from './router/index.js'\nimport store from './store/index.js'\n\nsync(store, router)\n\nVue.prototype.t = translate\nVue.prototype.n = translatePlural\n\n// TODO: remove when we have a proper fileinfo standalone library\n// original scripts are loaded from\n// https://github.com/nextcloud/server/blob/5bf3d1bb384da56adbf205752be8f840aac3b0c5/lib/private/legacy/template.php#L120-L122\nwindow.addEventListener('DOMContentLoaded', () => {\n\tif (!window.OCA.Files) {\n\t\twindow.OCA.Files = {}\n\t}\n\t// register unused client for the sidebar to have access to its parser methods\n\tObject.assign(window.OCA.Files, { App: { fileList: { filesClient: OC.Files.getClient() } } }, window.OCA.Files)\n})\n\nexport default new Vue({\n\tel: '#content',\n\t// eslint-disable-next-line vue/match-component-file-name\n\tname: 'PhotosRoot',\n\trouter,\n\tstore,\n\trender: h => h(PhotosPublic),\n})\n","/**\n * SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport moment from '@nextcloud/moment'\nimport store from '../store/index.js'\nimport { joinPaths } from '@nextcloud/paths'\n\nimport { allMimes } from './AllowedMimes.js'\nimport { genFileInfo, type PhotoNode } from '../utils/fileUtils.js'\nimport { getDefaultDavProps } from './DavRequest.ts'\nimport { davClient } from './DavClient.ts'\nimport { defaultRootPath } from '@nextcloud/files/dav'\nimport type { ResponseDataDetailed, SearchOptions, SearchResult } from 'webdav'\n\nexport type PhotoSearchOptions = SearchOptions & {\n\tfirstResult: number // Index of the first result that we want (starts at 0). Default: 0.\n\tnbResults: number // The number of file to fetch. Default: 200.\n\tmimesType: string[] // Mime type of the files. Default: allMimes.\n\tfull: boolean // get full data of the files. Default: false.\n\tonThisDay: boolean // get only items from this day of year. Default: false.\n\tonlyFavorites: boolean // get only favorite items. Default: false.\n}\n\n/**\n * List files from a folder and filter out unwanted mimes\n */\nexport default async function(_options: Partial<PhotoSearchOptions> = {}): Promise<PhotoNode[]> {\n\t// default function options\n\tconst options: PhotoSearchOptions = {\n\t\tfirstResult: 0,\n\t\tnbResults: 200,\n\t\tmimesType: allMimes,\n\t\tonThisDay: false,\n\t\tonlyFavorites: false,\n\t\tfull: false,\n\t\t..._options,\n\t}\n\n\t// generating the search or condition\n\t// based on the allowed mimetypes\n\tconst orMime = options.mimesType.reduce((str, mime) => `${str}\n\t\t<d:eq>\n\t\t\t<d:prop>\n\t\t\t\t<d:getcontenttype/>\n\t\t\t</d:prop>\n\t\t\t<d:literal>${mime}</d:literal>\n\t\t</d:eq>\n\t`, '')\n\n\tconst eqFavorites = options.onlyFavorites\n\t\t? `<d:eq>\n\t\t\t\t<d:prop>\n\t\t\t\t\t<oc:favorite/>\n\t\t\t\t</d:prop>\n\t\t\t\t<d:literal>1</d:literal>\n\t\t\t</d:eq>`\n\t\t: ''\n\n\tconst onThisDay = options.onThisDay\n\t\t? `<d:or>${Array(20).fill(1)\n\t\t\t.map((_, years) => {\n\t\t\t\tconst start = moment(Date.now()).startOf('day').subtract(3, 'd').subtract(years + 1, 'y')\n\t\t\t\tconst end = moment(Date.now()).endOf('day').add(3, 'd').subtract(years + 1, 'y')\n\t\t\t\treturn `<d:and>\n\t\t\t\t<d:gt>\n\t\t\t\t\t<d:prop>\n\t\t\t\t\t\t<d:getlastmodified />\n\t\t\t\t\t</d:prop>\n\t\t\t\t\t<d:literal>${start.format(moment.defaultFormatUtc)}</d:literal>\n\t\t\t\t</d:gt>\n\t\t\t\t<d:lt>\n\t\t\t\t\t<d:prop>\n\t\t\t\t\t\t<d:getlastmodified />\n\t\t\t\t\t</d:prop>\n\t\t\t\t\t<d:literal>${end.format(moment.defaultFormatUtc)}</d:literal>\n\t\t\t\t</d:lt>\n\t\t\t</d:and>`\n\t\t\t}).join('\\n')}</d:or>`\n\t\t: ''\n\n\tconst sourceFolders = store.state.userConfig.photosSourceFolders\n\t\t.map(folder => `\n\t\t\t<d:scope>\n\t\t\t\t<d:href>${joinPaths(defaultRootPath, folder)}</d:href>\n\t\t\t\t<d:depth>infinity</d:depth>\n\t\t\t</d:scope>`,\n\t\t)\n\t\t.join('\\n')\n\n\toptions.data = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\t\t<d:searchrequest xmlns:d=\"DAV:\"\n\t\t\txmlns:oc=\"http://owncloud.org/ns\"\n\t\t\txmlns:nc=\"http://nextcloud.org/ns\"\n\t\t\txmlns:ns=\"https://github.com/icewind1991/SearchDAV/ns\"\n\t\t\txmlns:ocs=\"http://open-collaboration-services.org/ns\">\n\t\t\t<d:basicsearch>\n\t\t\t\t<d:select>\n\t\t\t\t\t<d:prop>\n\t\t\t\t\t\t${getDefaultDavProps()}\n\t\t\t\t\t</d:prop>\n\t\t\t\t</d:select>\n\t\t\t\t<d:from>\n\t\t\t\t\t${sourceFolders}\n\t\t\t\t</d:from>\n\t\t\t\t<d:where>\n\t\t\t\t\t<d:and>\n\t\t\t\t\t\t<d:or>\n\t\t\t\t\t\t\t${orMime}\n\t\t\t\t\t\t</d:or>\n\t\t\t\t\t\t${eqFavorites}\n\t\t\t\t\t\t${onThisDay}\n\t\t\t\t\t</d:and>\n\t\t\t\t</d:where>\n\t\t\t\t<d:orderby>\n\t\t\t\t\t<d:order>\n\t\t\t\t\t\t<d:prop><nc:metadata-photos-original_date_time/></d:prop>\n\t\t\t\t\t\t<d:descending/>\n\t\t\t\t\t</d:order>\n\t\t\t\t\t<d:order>\n\t\t\t\t\t\t<d:prop><d:getlastmodified/></d:prop>\n\t\t\t\t\t\t<d:descending/>\n\t\t\t\t\t</d:order>\n\t\t\t\t</d:orderby>\n\t\t\t\t<d:limit>\n\t\t\t\t\t<d:nresults>${options.nbResults}</d:nresults>\n\t\t\t\t\t<ns:firstresult>${options.firstResult}</ns:firstresult>\n\t\t\t\t</d:limit>\n\t\t\t</d:basicsearch>\n\t\t</d:searchrequest>`\n\n\toptions.details = true\n\n\tconst response = await davClient.search('/', options) as ResponseDataDetailed<SearchResult>\n\n\treturn response.data.results.map((data) => genFileInfo(data))\n}\n","<!--\n - SPDX-FileCopyrightText: 2023 Nextcloud GmbH and Nextcloud contributors\n - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n<template>\n\t<NcIconSvgWrapper class=\"favorite-marker-icon\" :name=\"t('photos', 'Favorite')\" :svg=\"StarSvg\" />\n</template>\n\n<script lang='ts'>\nimport { translate as t } from '@nextcloud/l10n'\nimport { NcIconSvgWrapper } from '@nextcloud/vue'\nimport { defineComponent } from 'vue'\n\n// eslint-disable-next-line import/no-unresolved, n/no-missing-import\nimport StarSvg from '@mdi/svg/svg/star.svg?raw'\n\n/**\n * A favorite icon to be used for overlaying favorite entries like the file preview / icon\n * It has a stroke around the star icon to ensure enough contrast for accessibility.\n *\n * If the background has a hover state you might want to also apply it to the stroke like this:\n * ```scss\n * .parent:hover :deep(.favorite-marker-icon svg path) {\n *      stroke: var(--color-background-hover);\n * }\n * ```\n */\nexport default defineComponent({\n\tname: 'FavoriteIcon',\n\tcomponents: {\n\t\tNcIconSvgWrapper,\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tStarSvg,\n\t\t}\n\t},\n\tmounted() {\n\t\tthis.$nextTick(() => {\n\t\t\t// MDI default viewbox is \"0 0 24 24\" but we add a stroke of 10px so we must adjust it\n\t\t\tconst el = this.$el.querySelector('svg')\n\t\t\tel?.setAttribute?.('viewBox', '-4 -4 30 30')\n\t\t})\n\t},\n\tmethods: {\n\t\tt,\n\t},\n})\n</script>\n\n<style lang=\"scss\" scoped>\n.favorite-marker-icon {\n\tcolor: #a08b00;\n\t// Override NcIconSvgWrapper defaults (clickable area)\n\tmin-width: unset !important;\n\tmin-height: unset !important;\n\n\t:deep() {\n\t\tsvg {\n\t\t\t// We added a stroke for a11y so we must increase the size to include the stroke\n\t\t\twidth: 32px !important;\n\t\t\theight: 32px !important;\n\n\t\t\t// Override NcIconSvgWrapper defaults of 20px\n\t\t\tmax-width: unset !important;\n\t\t\tmax-height: unset !important;\n\n\t\t\t// Sow a border around the icon for better contrast\n\t\t\tpath {\n\t\t\t\tstroke: var(--color-main-background);\n\t\t\t\tstroke-width: 10px;\n\t\t\t\tstroke-linejoin: round;\n\t\t\t\tpaint-order: stroke;\n\t\t\t}\n\t\t}\n\t}\n}\n</style>\n","/**\n * SPDX-FileCopyrightText: 2023 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\n// The preview service worker cache name (see webpack config)\nconst SWCacheName = 'images'\nconst hotCache = []\n\n/**\n * Check if the preview is already cached by the service worker\n */\nexport const isCachedPreview = async function(previewUrl: string): Promise<boolean> {\n\ttry {\n\t\t// Browser's cache take ~100ms to check, hot cache ~10ms.\n\t\tif (!hotCache[previewUrl]) {\n\t\t\tconst cache = await window.caches?.open(SWCacheName)\n\t\t\tconst response = await cache?.match(previewUrl)\n\t\t\thotCache[previewUrl] = response !== undefined\n\t\t}\n\n\t\treturn hotCache[previewUrl]\n\t} catch {\n\t\treturn false\n\t}\n}\n","<!--\n - SPDX-FileCopyrightText: 2020 Nextcloud GmbH and Nextcloud contributors\n - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<div class=\"file-container\"\n\t\tdata-test=\"media\"\n\t\t:class=\"{selected}\">\n\t\t<a class=\"file\"\n\t\t\t:href=\"file.source\"\n\t\t\t:aria-label=\"ariaLabel\"\n\t\t\t@click.stop.prevent=\"emitClick\">\n\n\t\t\t<!-- image and loading placeholder -->\n\t\t\t<div class=\"file__images\">\n\t\t\t\t<VideoIcon v-if=\"file.mime.includes('video')\" class=\"icon-overlay\" :size=\"64\" />\n\t\t\t\t<PlayCircleIcon v-else-if=\"file.metadataFilesLivePhoto !== undefined\" class=\"icon-overlay\" :size=\"64\" />\n\n\t\t\t\t<!-- We have two img elements to load the small and large preview -->\n\t\t\t\t<!-- Do not show the small preview if the larger one is loaded -->\n\t\t\t\t<!-- Prioritize visible files -->\n\t\t\t\t<!-- Load small preview first, then the larger one -->\n\t\t\t\t<!-- Preload large preview for near visible files -->\n\t\t\t\t<!-- Preload small preview for further away files -->\n\t\t\t\t<template v-if=\"initialized\">\n\t\t\t\t\t<canvas v-if=\"hasBlurhash && !loadedSmall && !loadedLarge\"\n\t\t\t\t\t\tref=\"canvas\"\n\t\t\t\t\t\tclass=\"file__blurhash\"\n\t\t\t\t\t\taria-hidden=\"true\" />\n\n\t\t\t\t\t<img v-if=\"!loadedLarge && (loadedSmall || (distance < 5 && !errorSmall))\"\n\t\t\t\t\t\tref=\"imgSmall\"\n\t\t\t\t\t\t:key=\"`${file.basename}-small`\"\n\t\t\t\t\t\t:src=\"srcSmall\"\n\t\t\t\t\t\t:alt=\"file.basename\"\n\t\t\t\t\t\t:decoding=\"loadedSmall || isVisible ? 'sync' : 'async'\"\n\t\t\t\t\t\t:fetchpriority=\"loadedSmall || isVisible ? 'high' : 'low'\"\n\t\t\t\t\t\t:loading=\"loadedSmall || isVisible ? 'eager' : distance < 2 ? 'auto' : 'lazy'\"\n\t\t\t\t\t\t@load=\"onLoadSmall\"\n\t\t\t\t\t\t@error=\"onErrorSmall\">\n\n\t\t\t\t\t<img v-if=\"loadedLarge || ((isVisible || (distance < 2 && (loadedSmall || errorSmall))) && !errorLarge)\"\n\t\t\t\t\t\tref=\"imgLarge\"\n\t\t\t\t\t\t:key=\"`${file.basename}-large`\"\n\t\t\t\t\t\t:src=\"srcLarge\"\n\t\t\t\t\t\t:alt=\"file.basename\"\n\t\t\t\t\t\t:decoding=\"loadedLarge || isVisible ? 'sync' : 'async'\"\n\t\t\t\t\t\t:fetchpriority=\"loadedLarge || isVisible ? 'high' : 'low'\"\n\t\t\t\t\t\t:loading=\"loadedLarge || isVisible ? 'auto' : 'lazy'\"\n\t\t\t\t\t\t@load=\"onLoadLarge\"\n\t\t\t\t\t\t@error=\"onErrorLarge\">\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</a>\n\n\t\t<NcCheckboxRadioSwitch v-if=\"allowSelection\"\n\t\t\tclass=\"selection-checkbox\"\n\t\t\t:aria-label=\"t('photos', 'Select image {imageName}', {imageName: file.basename})\"\n\t\t\t:checked=\"selected\"\n\t\t\t@update:checked=\"onToggle\" />\n\n\t\t<FavoriteIcon v-if=\"file.favorite === 1\"\n\t\t\tv-once\n\t\t\tclass=\"favorite-state\" />\n\t</div>\n</template>\n\n<script lang='ts'>\nimport VideoIcon from 'vue-material-design-icons/Video.vue'\nimport PlayCircleIcon from 'vue-material-design-icons/PlayCircle.vue'\nimport { decode } from 'blurhash'\n\nimport { generateUrl } from '@nextcloud/router'\nimport { NcCheckboxRadioSwitch } from '@nextcloud/vue'\n\nimport FavoriteIcon from './FavoriteIcon.vue'\nimport { isCachedPreview } from '../services/PreviewService.js'\n\nexport default {\n\tname: 'File',\n\tcomponents: {\n\t\tFavoriteIcon,\n\t\tNcCheckboxRadioSwitch,\n\t\tVideoIcon,\n\t\tPlayCircleIcon,\n\t},\n\tinheritAttrs: false,\n\tprops: {\n\t\tfile: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tselected: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tallowSelection: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\tdistance: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0,\n\t\t},\n\t},\n\n\tdata() {\n\t\treturn {\n\t\t\tinitialized: false,\n\t\t\tloadedSmall: false,\n\t\t\terrorSmall: false,\n\t\t\tloadedLarge: false,\n\t\t\terrorLarge: false,\n\t\t}\n\t},\n\n\tcomputed: {\n\t\t/** @return {string} */\n\t\tariaLabel() {\n\t\t\tif (this.file.favorite) {\n\t\t\t\treturn t('photos', 'Favorite image, open the full size \"{name}\" image', { name: this.file.basename })\n\t\t\t}\n\t\t\treturn t('photos', 'Open the full size \"{name}\" image', { name: this.file.basename })\n\t\t},\n\t\t/** @return {boolean} */\n\t\tisImage() {\n\t\t\treturn this.file.mime.startsWith('image')\n\t\t},\n\t\t/** @return {string} */\n\t\tdecodedEtag() {\n\t\t\treturn this.file.etag.replace('&quot;', '').replace('&quot;', '')\n\t\t},\n\t\t/** @return {string} */\n\t\tsrcLarge() {\n\t\t\treturn this.getItemURL(512)\n\t\t},\n\t\t/** @return {string} */\n\t\tsrcSmall() {\n\t\t\treturn this.getItemURL(64)\n\t\t},\n\t\t/** @return {boolean} */\n\t\tisVisible() {\n\t\t\treturn this.distance === 0\n\t\t},\n\t\thasBlurhash() {\n\t\t\treturn this.file.metadataBlurhash !== undefined\n\t\t},\n\t},\n\n\twatch: {\n\t\tasync file() {\n\t\t\tthis.initialized = false\n\t\t\tthis.loadedSmall = false\n\t\t\tthis.errorSmall = false\n\t\t\tthis.loadedLarge = false\n\t\t\tthis.errorLarge = false\n\n\t\t\tawait this.init()\n\t\t},\n\t},\n\n\tasync mounted() {\n\t\tawait this.init()\n\t},\n\n\tbeforeDestroy() {\n\t\t// cancel any pending load\n\t\tif (this.$refs.imgSmall !== undefined) {\n\t\t\tthis.$refs.imgSmall.src = ''\n\t\t}\n\t\tif (this.$refs.srcLarge !== undefined) {\n\t\t\tthis.$refs.srcLarge.src = ''\n\t\t}\n\t},\n\n\tmethods: {\n\t\tasync init() {\n\t\t\t[this.loadedSmall, this.loadedLarge] = await Promise.all([\n\t\t\t\tawait isCachedPreview(this.srcSmall),\n\t\t\t\tawait isCachedPreview(this.srcLarge),\n\t\t\t])\n\n\t\t\tthis.initialized = true\n\n\t\t\tawait this.$nextTick() // Wait for next tick to have the canvas in the DOM\n\n\t\t\tthis.drawBlurhash()\n\t\t},\n\n\t\temitClick() {\n\t\t\tthis.$emit('click', this.file.fileid)\n\t\t},\n\n\t\tonLoadSmall() {\n\t\t\tthis.loadedSmall = true\n\t\t},\n\n\t\tonLoadLarge() {\n\t\t\tthis.loadedLarge = true\n\t\t},\n\n\t\tonErrorSmall() {\n\t\t\tthis.errorSmall = true\n\t\t},\n\n\t\tonErrorLarge() {\n\t\t\tthis.errorLarge = true\n\t\t},\n\n\t\tonToggle(value) {\n\t\t\tthis.$emit('select-toggled', { id: this.file.fileid, value })\n\t\t},\n\n\t\tgetItemURL(size) {\n\t\t\tconst token = this.$route?.params.token\n\t\t\tif (token) {\n\t\t\t\treturn generateUrl(`/apps/photos/api/v1/publicPreview/${this.file.fileid}?etag=${this.decodedEtag}&x=${size}&y=${size}&token=${token}`)\n\t\t\t} else {\n\t\t\t\treturn generateUrl(`/apps/photos/api/v1/preview/${this.file.fileid}?etag=${this.decodedEtag}&x=${size}&y=${size}`)\n\t\t\t}\n\t\t},\n\t\tdrawBlurhash() {\n\t\t\tif (!this.hasBlurhash || !this.$refs.canvas) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tconst width = this.$refs.canvas.width\n\t\t\tconst height = this.$refs.canvas.height\n\n\t\t\tconst pixels = decode(this.file.metadataBlurhash, width, height)\n\n\t\t\tconst ctx = this.$refs.canvas.getContext('2d')\n\t\t\tconst imageData = ctx.createImageData(width, height)\n\t\t\timageData.data.set(pixels)\n\t\t\tctx.putImageData(imageData, 0, 0)\n\t\t},\n\t},\n\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.file-container {\n\tcontain: strict;\n\tbackground: var(--color-primary-element-light);\n\tposition: relative;\n\theight: 100%;\n\twidth: 100%;\n\tborder: 2px solid var(--color-main-background); // Use border so create a separation between images.\n\tbox-sizing: border-box;\n\n\t// Selection border.\n\t&.selected,\n\t&:focus-within,\n\t&:has(:focus) {\n\t\t&::after {\n\t\t\tposition: absolute;\n\t\t\ttop: 0;\n\t\t\tleft: 0;\n\t\t\tz-index: 2;\n\t\t\twidth: 100%;\n\t\t\theight: 100%;\n\t\t\tcontent: '';\n\t\t\toutline: var(--color-primary-element) solid 4px;\n\t\t\toutline-offset: -4px;\n\t\t\tpointer-events: none;\n\t\t}\n\n\t\t.selection-checkbox {\n\t\t\topacity: 1;\n\t\t}\n\t}\n\n\t.file {\n\t\twidth: 100%;\n\t\theight: 100%;\n\t\tbox-sizing: border-box;\n\t\toutline: none; // Override global focus state.\n\t\tdisplay: flex; // Fill parent size\n\n\t\t&__blurhash {\n\t\t\tposition: absolute;\n\t\t\ttop: 0;\n\t\t\theight: 100%;\n\t\t\twidth: 100%;\n\t\t\tobject-fit: cover;\n\t\t}\n\n\t\t&__images {\n\t\t\twidth: 100%;\n\t\t\theight: 100%;\n\n\t\t\t.icon-overlay {\n\t\t\t\tposition: absolute;\n\t\t\t\ttop: 0px;\n\t\t\t\tright: 0px;\n\t\t\t\twidth: 100%;\n\t\t\t\theight: 100%;\n\t\t\t\tz-index: 1;\n\t\t\t\topacity: 0.8;\n\n\t\t\t\t:deep(.material-design-icon__svg) {\n\t\t\t\t\tfill: var(--color-main-background);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\timg {\n\t\t\t\twidth: 100%;\n\t\t\t\theight: 100%;\n\t\t\t\tobject-fit: cover;\n\t\t\t\tposition: absolute;\n\t\t\t\tcolor: transparent; /// Hide alt='' text when loading.\n\t\t\t}\n\t\t}\n\t}\n\n\t// Reveal checkbox on hover.\n\t&:hover, &.selected, &:focus-within {\n\t\t.selection-checkbox {\n\t\t\topacity: 1;\n\t\t}\n\n\t\t.favorite-state {\n\t\t\tdisplay: none;\n\t\t}\n\t}\n\n\t.selection-checkbox {\n\t\topacity: 0;\n\t\tposition: absolute;\n\t\ttop: 8px;\n\t\t// Fancy calculation to render the checkbox in the middle of narrow images.\n\t\tright: min(22px, calc(50% - 7px));\n\t\tz-index: 1;\n\t\twidth: fit-content;\n\n\t\t:deep .checkbox-radio-switch__input:focus-visible + .checkbox-radio-switch__content,\n\t\t.checkbox-radio-switch__input:focus-visible {\n\t\t\toutline: 2px solid var(--color-main-text);\n\t\t\tbox-shadow: 0 0 0 3px var(--color-main-background);\n\t\t\toutline-offset: 0px;\n\t\t}\n\n\t\t:deep(.checkbox-radio-switch__content) {\n\t\t\tpadding: 10px;\n\t\t\tbox-sizing: border-box;\n\t\t\tbackground: var(--color-main-background);\n\n\t\t\t// Add a background to the checkbox so we do not see the image through it.\n\t\t\t&::after {\n\t\t\t\tcontent: '';\n\t\t\t\twidth: 16px;\n\t\t\t\theight: 16px;\n\t\t\t\tposition: absolute;\n\t\t\t\tleft: 14px;\n\t\t\t\tz-index: -1;\n\t\t\t}\n\n\t\t\t.checkbox-radio-switch__icon {\n\t\t\t\tmargin: 0;\n\t\t\t}\n\t\t}\n\n\t\t.input-label {\n\t\t\tposition: fixed;\n\t\t\tz-index: -1;\n\t\t\ttop: -5000px;\n\t\t\tleft: -5000px;\n\t\t}\n\t}\n\n\t.favorite-state {\n\t\tposition: absolute;\n\t\ttop: 2px;\n\t\t// Fancy calculation to render the start in the middle of narrow images.\n\t\tright: min(2px, calc(50% - 7px));\n\t}\n}\n</style>\n","<!--\n - SPDX-FileCopyrightText: 2020 The Nextcloud Bookmarks contributors.\n - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n<template>\n\t<div class=\"on-this-day-dashboard\">\n\t\t<NcLoadingIcon v-if=\"loading\" :size=\"48\" />\n\t\t<NcEmptyContent v-else-if=\"items.length === 0\"\n\t\t\t:name=\"t('photos', 'No picture for this day')\"\n\t\t\t:description=\"t('photos', 'Picture taken on this day will show up here.')\">\n\t\t\t<template #icon>\n\t\t\t\t<ImageIcon />\n\t\t\t</template>\n\t\t</NcEmptyContent>\n\t\t<template v-else>\n\t\t\t<File class=\"on-this-day-dashboard__file\"\n\t\t\t\t:file=\"items[0]\"\n\t\t\t\t:allow-selection=\"false\" />\n\t\t\t<NcButton :href=\"moreUrl\">\n\t\t\t\t{{ t('photos', 'More photos from this day') }}\n\t\t\t</NcButton>\n\t\t</template>\n\t</div>\n</template>\n\n<script lang='ts'>\nimport Image from 'vue-material-design-icons/Image.vue'\n\nimport { generateUrl } from '@nextcloud/router'\nimport { NcButton, NcLoadingIcon, NcEmptyContent } from '@nextcloud/vue'\n\nimport getPhotos from '../../services/PhotoSearch.js'\nimport { allMimes } from '../../services/AllowedMimes.js'\nimport File from '../File.vue'\nimport logger from '../../services/logger.js'\n\nexport default {\n\tname: 'DashboardOnThisDay',\n\tcomponents: {\n\t\tFile,\n\t\tNcButton,\n\t\tNcLoadingIcon,\n\t\tNcEmptyContent,\n\t\tImageIcon: Image,\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tloading: true,\n\t\t\titems: [],\n\t\t}\n\t},\n\tcomputed: {\n\t\tmoreUrl() {\n\t\t\treturn generateUrl('/apps/photos/thisday')\n\t\t},\n\t},\n\tasync created() {\n\t\ttry {\n\t\t\tthis.items = await getPhotos({\n\t\t\t\tfirstResult: 0,\n\t\t\t\tnbResults: 1,\n\t\t\t\tmimesType: allMimes,\n\t\t\t\tonThisDay: true,\n\t\t\t})\n\t\t} catch (error) {\n\t\t\tlogger.error('Failed to load on this day pictures', { error })\n\t\t} finally {\n\t\t\tthis.loading = false\n\t\t}\n\t},\n}\n</script>\n<style lang=\"scss\" scoped>\n.on-this-day-dashboard {\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\theight: 100%;\n\tgap: 16px;\n\n\t.file-container {\n\t\tflex-grow: 1;\n\t\tborder: none;\n\t}\n}\n</style>\n","/**\n * SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { translate, translatePlural } from '@nextcloud/l10n'\nimport Vue from 'vue'\n\nimport store from './store/index.js'\nimport DashboardOnThisDay from './components/Dashboard/DashboardOnThisDay.vue'\n\nVue.prototype.t = translate\nVue.prototype.n = translatePlural\n\nwindow.addEventListener('DOMContentLoaded', () => {\n\tOCA.Dashboard.register('photos-onthisday', (el) => {\n\t\tglobal.PhotosOnThisDay = new Vue({\n\t\t\tel,\n\t\t\tstore,\n\t\t\trender: h => h(DashboardOnThisDay),\n\t\t})\n\t})\n})\n","<!--\n - SPDX-FileCopyrightText: 2020 Nextcloud GmbH and Nextcloud contributors\n - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<a :class=\"{\n\t\t\t'file--cropped': croppedLayout,\n\t\t}\"\n\t\tclass=\"file\"\n\t\t:href=\"item.injected.source\"\n\t\t:aria-label=\"ariaLabel\"\n\t\t@click.prevent=\"openViewer\">\n\t\t<div v-if=\"item.injected.mime.includes('video') && item.injected.hasPreview\" class=\"icon-video-white\" />\n\t\t<!-- image and loading placeholder -->\n\t\t<transition-group name=\"fade\" class=\"transition-group\">\n\t\t\t<img v-if=\"!error\"\n\t\t\t\tref=\"img\"\n\t\t\t\t:key=\"`${item.injected.basename}-img`\"\n\t\t\t\t:src=\"src\"\n\t\t\t\t:alt=\"item.injected.basename\"\n\t\t\t\t:aria-describedby=\"ariaUuid\"\n\t\t\t\t@load=\"onLoad\"\n\t\t\t\t@error=\"onError\">\n\n\t\t\t<svg v-if=\"!loaded || error\"\n\t\t\t\t:key=\"`${item.injected.basename}-svg`\"\n\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\tviewBox=\"0 0 32 32\"\n\t\t\t\tfill=\"url(#placeholder__gradient)\">\n\t\t\t\t<use v-if=\"isImage\" href=\"#placeholder--img\" />\n\t\t\t\t<use v-else href=\"#placeholder--video\" />\n\t\t\t</svg>\n\t\t</transition-group>\n\n\t\t<!-- image name and cover -->\n\t\t<p :id=\"ariaUuid\" class=\"hidden-visually\">{{ item.injected.basename }}</p>\n\t\t<div class=\"cover\" role=\"none\" />\n\t</a>\n</template>\n\n<script lang='ts'>\nimport { generateUrl } from '@nextcloud/router'\n\nexport default {\n\tname: 'FileLegacy',\n\tinheritAttrs: false,\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tdata() {\n\t\treturn {\n\t\t\tloaded: false,\n\t\t\terror: false,\n\t\t}\n\t},\n\n\tcomputed: {\n\t\tariaUuid() {\n\t\t\treturn `image-${this.item.injected.fileid}`\n\t\t},\n\t\tariaLabel() {\n\t\t\treturn t('photos', 'Open the full size \"{name}\" image', { name: this.item.injected.basename })\n\t\t},\n\t\tisImage() {\n\t\t\treturn this.item.injected.mime.startsWith('image')\n\t\t},\n\t\tdecodedEtag() {\n\t\t\treturn this.item.injected.etag.replace('&quot;', '').replace('&quot;', '')\n\t\t},\n\t\tsrc() {\n\t\t\treturn generateUrl(`/core/preview?fileId=${this.item.injected.fileid}&c=${this.decodedEtag}&x=${250}&y=${250}&forceIcon=0&a=${this.croppedLayout ? '0' : '1'}`)\n\t\t},\n\t\tcroppedLayout() {\n\t\t\treturn this.$store.state.userConfig.croppedLayout\n\t\t},\n\t},\n\n\tbeforeDestroy() {\n\t\t// cancel any pending load\n\t\tthis.$refs.src = ''\n\t},\n\n\tmethods: {\n\t\topenViewer() {\n\t\t\tOCA.Viewer.open({\n\t\t\t\tfileInfo: this.item.injected,\n\t\t\t\tlist: this.item.injected.list,\n\t\t\t\tloadMore: this.item.injected.loadMore ? async () => await this.item.injected.loadMore(true) : () => [],\n\t\t\t\tcanLoop: this.item.injected.canLoop,\n\t\t\t})\n\t\t},\n\n\t\t/** When the image is fully loaded by browser we remove the placeholder */\n\t\tonLoad() {\n\t\t\tthis.loaded = true\n\t\t},\n\n\t\tonError() {\n\t\t\tthis.error = true\n\t\t},\n\t},\n\n}\n</script>\n\n<style lang=\"scss\" scoped>\n@use '../mixins/FileFolder';\n\n.transition-group {\n\tdisplay: contents;\n}\n\n.icon-video-white {\n\tposition: absolute;\n\ttop: 10px;\n\tright: 10px;\n\tz-index: 20;\n}\n\nimg {\n\tposition: absolute;\n\twidth: 100%;\n\theight: 100%;\n\tz-index: 10;\n\n\tcolor: transparent; // should be diplayed on error\n\n\tobject-fit: contain;\n\n\t.file--cropped & {\n\t\tobject-fit: cover;\n\t}\n}\n\nsvg {\n\tposition: absolute;\n\twidth: 70%;\n\theight: 70%;\n}\n</style>\n","/**\n * SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nexport default {\n\tname: 'AbortControllerMixin',\n\n\tdata() {\n\t\treturn {\n\t\t\tabortController: new AbortController(),\n\t\t}\n\t},\n\n\tbeforeDestroy() {\n\t\tthis.abortController.abort()\n\t},\n\n\tbeforeRouteLeave(from, to, next) {\n\t\tthis.abortController.abort()\n\t\tthis.abortController = new AbortController()\n\t\tnext()\n\t},\n}\n","<!--\n - SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<div :class=\"{'photos-navigation--root': isRoot}\" class=\"photos-navigation\" role=\"toolbar\">\n\t\t<!-- Back navigation button -->\n\t\t<NcButton v-if=\"!isRoot\"\n\t\t\tclass=\"photos-navigation__back\"\n\t\t\t:aria-label=\"t('photos', 'Go back')\"\n\t\t\ttype=\"tertiary\"\n\t\t\t@click=\"folderUp\">\n\t\t\t<template #icon>\n\t\t\t\t<ArrowLeft :size=\"20\" />\n\t\t\t</template>\n\t\t</NcButton>\n\n\t\t<!-- Main Navigation title -->\n\t\t<div class=\"photos-navigation__title\">\n\t\t\t<h1 class=\"photos-navigation__title__main\" @click=\"refresh\">\n\t\t\t\t{{ name }}\n\t\t\t</h1>\n\t\t\t<div class=\"photos-navigation__title__sub\" />\n\t\t\t<slot name=\"subtitle\" />\n\t\t</div>\n\n\t\t<!-- Main slot -->\n\t\t<div v-if=\"$slots.default\" class=\"photos-navigation__content\">\n\t\t\t<slot />\n\t\t</div>\n\n\t\t<NcLoadingIcon v-show=\"loading\" class=\"photos-navigation__loader\" />\n\n\t\t<div class=\"photos-navigation__content-right\">\n\t\t\t<slot name=\"right\" />\n\t\t</div>\n\t</div>\n</template>\n\n<script lang='ts'>\nimport ArrowLeft from 'vue-material-design-icons/ArrowLeft.vue'\n\nimport { NcButton, NcLoadingIcon } from '@nextcloud/vue'\n\nexport default {\n\tname: 'HeaderNavigation',\n\n\tcomponents: {\n\t\tArrowLeft,\n\t\tNcButton,\n\t\tNcLoadingIcon,\n\t},\n\n\tinheritAttrs: false,\n\n\tprops: {\n\t\tloading: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tpath: {\n\t\t\ttype: String,\n\t\t\tdefault: '/',\n\t\t},\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\trootTitle: {\n\t\t\ttype: String,\n\t\t\tdefault: t('photos', 'Photos'),\n\t\t},\n\t\t// The route params\n\t\tparams: {\n\t\t\ttype: Object,\n\t\t\tdefault: null,\n\t\t},\n\t},\n\n\tcomputed: {\n\t\tisRoot() {\n\t\t\tconst isRoot = this.path === '/'\n\t\t\tthis.toggleNavigationButton(!isRoot)\n\t\t\treturn isRoot\n\t\t},\n\n\t\tname() {\n\t\t\tif (this.isRoot) {\n\t\t\t\treturn this.rootTitle\n\t\t\t}\n\t\t\treturn this.title\n\t\t},\n\n\t\tparentPath() {\n\t\t\tconst path = this.path.split('/')\n\t\t\tpath.pop()\n\t\t\tconst parent = path.join('/')\n\t\t\treturn this.isRoot || parent.trim() === ''\n\t\t\t\t? '/'\n\t\t\t\t: path.join('/')\n\t\t},\n\n\t\tparentName() {\n\t\t\treturn this.parentPath && this.parentPath.split('/').pop()\n\t\t},\n\n\t\tbackToText() {\n\t\t\tif (this.parentPath === '/') {\n\t\t\t\treturn t('photos', 'Back to {folder}', { folder: this.rootTitle })\n\t\t\t}\n\t\t\treturn t('photos', 'Back to {folder}', { folder: this.parentName })\n\t\t},\n\n\t\t/**\n\t\t * We do not want encoded slashes when browsing by folder\n\t\t * so we generate a new valid route object, get the final url back\n\t\t * decode it and use it as a direct string, which vue-router\n\t\t * does not encode afterwards\n\t\t *\n\t\t * @return {string|object}\n\t\t */\n\t\tto() {\n\t\t\t// always remove first slash, the router\n\t\t\t// manage it automatically\n\t\t\tconst regex = /^\\/?(.*)/i\n\t\t\tconst path = regex.exec(this.parentPath)[1]\n\n\t\t\t// apply to current route\n\t\t\tconst { name, params } = Object.assign({}, this.$route, {\n\t\t\t\tparams: this.params || { path },\n\t\t\t})\n\n\t\t\t// return the full object as we don't care about\n\t\t\t// an empty path if this is route\n\t\t\tif (path === '') {\n\t\t\t\treturn { name }\n\t\t\t}\n\n\t\t\t// returning a string prevent vue-router to encode it again\n\t\t\treturn decodeURIComponent(this.$router.resolve({ name, params }).resolved.path)\n\t\t},\n\t},\n\n\tmethods: {\n\t\tfolderUp() {\n\t\t\tthis.$router.push(this.to)\n\t\t},\n\n\t\trefresh() {\n\t\t\tthis.$emit('refresh')\n\t\t},\n\n\t\ttoggleNavigationButton(hide) {\n\t\t\t// Hide the navigation toggle if the back button is shown\n\t\t\tconst navigationToggle = document.querySelector('button.app-navigation-toggle')\n\t\t\tif (navigationToggle !== null) {\n\t\t\t\tnavigationToggle.style.display = hide ? 'none' : null\n\t\t\t}\n\t\t},\n\t},\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.photos-navigation {\n\tposition: sticky;\n\tz-index: 20;\n\ttop: 0;\n\tdisplay: flex;\n\t// We need to wrap on small devices for accessibility\n\tflex-wrap: wrap;\n\tgap: calc(2 * var(--app-navigation-padding));\n\talign-items: center;\n\tjustify-content: flex-start;\n\twidth: 100%;\n\t// Ensure to not overlap with app navigation toggle\n\tpadding-inline: calc(var(--default-clickable-area) + 2 * var(--app-navigation-padding)) var(--app-navigation-padding);\n\t// Align with app navigation toggle\n\tpadding-block: var(--app-navigation-padding);\n\tbackground: var(--color-main-background);\n\n\t&__back {\n\t\t// Replaces the app navigation button\n\t\tposition: absolute !important;\n\t\tleft: var(--app-navigation-padding);\n\t}\n\n\t&__title {\n\t\tmax-width: 45%;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\n\t\t&__main {\n\t\t\tcursor: pointer;\n\t\t\tfont-weight: 700;\n\t\t\tfont-size: 20px;\n\t\t\tline-height: 44px;\n\t\t}\n\n\t\t&__main, &__sub {\n\t\t\toverflow: hidden;\n\t\t\twhite-space: nowrap;\n\t\t\ttext-overflow: ellipsis;\n\t\t}\n\t}\n\n\t&__loader {\n\t\tmargin-inline-start: 32px;\n\t}\n\n\t&__content-right {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tmargin-inline-start: auto;\n\t}\n}\n\n</style>\n","/**\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\n/**\n * Define the max width proportions\n * The number (key) indicate the MAX size\n *\n * needs to be compatible with webpack config\n * so no export default {}\n */\nexport default {\n\t400: {\n\t\tmarginTop: 66,\n\t\tmarginW: 8,\n\t\tcount: 3,\n\t\tfolderCount: 1,\n\t},\n\t700: {\n\t\tmarginTop: 66,\n\t\tmarginW: 8,\n\t\tcount: 4,\n\t\tfolderCount: 1,\n\t},\n\t1024: {\n\t\tmarginTop: 66,\n\t\tmarginW: 44,\n\t\tcount: 5,\n\t\tfolderCount: 2,\n\t},\n\t1280: {\n\t\tmarginTop: 66,\n\t\tmarginW: 44,\n\t\tcount: 4,\n\t\tfolderCount: 2,\n\t},\n\t1440: {\n\t\tmarginTop: 88,\n\t\tmarginW: 66,\n\t\tcount: 5,\n\t\tfolderCount: 3,\n\t},\n\t1600: {\n\t\tmarginTop: 88,\n\t\tmarginW: 66,\n\t\tcount: 6,\n\t\tfolderCount: 4,\n\t},\n\t2048: {\n\t\tmarginTop: 88,\n\t\tmarginW: 66,\n\t\tcount: 7,\n\t\tfolderCount: 4,\n\t},\n\t2560: {\n\t\tmarginTop: 88,\n\t\tmarginW: 88,\n\t\tcount: 8,\n\t\tfolderCount: 6,\n\t},\n\t3440: {\n\t\tmarginTop: 88,\n\t\tmarginW: 88,\n\t\tcount: 9,\n\t\tfolderCount: 8,\n\t},\n\tmax: {\n\t\tmarginTop: 88,\n\t\tmarginW: 88,\n\t\tcount: 10,\n\t\tfolderCount: 10,\n\t},\n}\n","/**\n * SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport Vue from 'vue'\nimport sizes from '../assets/grid-sizes.js'\n\nexport default new Vue({\n\tdata() {\n\t\treturn {\n\t\t\tgridConfig: sizes.max,\n\t\t}\n\t},\n\twatch: {\n\t\tgridConfig(val) {\n\t\t\tthis.$emit('changed', val)\n\t\t},\n\t},\n\tcreated() {\n\t\twindow.addEventListener('resize', this.handleWindowResize)\n\t\tthis.handleWindowResize()\n\t},\n\tbeforeDestroy() {\n\t\twindow.removeEventListener('resize', this.handleWindowResize)\n\t},\n\tmethods: {\n\t\thandleWindowResize() {\n\t\t\t// find the first grid size that fit the current window width\n\t\t\tconst currentSize = Object.keys(sizes).find(size => size > document.documentElement.clientWidth)\n\t\t\tthis.gridConfig = sizes[currentSize] || sizes.max\n\t\t},\n\t},\n})\n","/**\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport getGridConfig from '../services/GridConfig.js'\nimport logger from '../services/logger.js'\n\n/**\n * Get the current used grid config\n */\nexport default {\n\tdata() {\n\t\treturn {\n\t\t\tgridConfig: {},\n\t\t}\n\t},\n\n\tcreated() {\n\t\tgetGridConfig.$on('changed', val => {\n\t\t\tthis.gridConfig = val\n\t\t})\n\t\tlogger.debug('Grid config', { gridConfig: getGridConfig.gridConfig })\n\t\tthis.gridConfig = getGridConfig.gridConfig\n\t},\n\n\tbeforeDestroy() {\n\t\tgetGridConfig.$off('changed', this.gridConfig)\n\t},\n}\n","/**\n * SPDX-FileCopyrightText: 2023 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport type { AxiosError } from 'axios'\nimport type { FileStat, ResponseDataDetailed, StatOptions } from 'webdav'\nimport { genFileInfo } from '../utils/fileUtils.js'\nimport { davClient } from './DavClient'\nimport { getPropFind } from './DavRequest'\n\nexport async function fetchFile(fileName: string, options: StatOptions = {}) {\n\ttry {\n\t\tconst response = await davClient.stat(fileName, {\n\t\t\tdata: getPropFind(),\n\t\t\tdetails: true,\n\t\t\t...options,\n\t\t}) as ResponseDataDetailed<FileStat>\n\n\t\treturn genFileInfo(response.data)\n\t} catch (error) {\n\t\tif ((error as AxiosError).code === 'ERR_CANCELED') {\n\t\t\treturn null\n\t\t}\n\n\t\tthrow error\n\t}\n}\n","<!--\n  - SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n<template>\n\t<!-- Errors handlers-->\n\t<NcEmptyContent v-if=\"error\" :name=\"t('photos', 'An error occurred') \">\n\t\t<AlertCircle slot=\"icon\" />\n\t</NcEmptyContent>\n\n\t<div v-else class=\"collections\">\n\t\t<!-- Collection header -->\n\t\t<slot name=\"header\" />\n\n\t\t<!-- No collections -->\n\t\t<slot v-if=\"noCollection && !loading\" name=\"empty-collections-list\" class=\"collections__empty\" />\n\n\t\t<!-- List -->\n\t\t<ul v-else-if=\"!noCollection\" class=\"collections__list\">\n\t\t\t<slot v-for=\"collection in collections\"\n\t\t\t\t:collection=\"collection\"\n\t\t\t\tclass=\"collection\" />\n\t\t</ul>\n\t</div>\n</template>\n\n<script lang='ts'>\nimport AlertCircle from 'vue-material-design-icons/AlertCircle.vue'\n\nimport { NcEmptyContent } from '@nextcloud/vue'\nimport { translate } from '@nextcloud/l10n'\nimport type { Collection } from '../../services/collectionFetcher'\nimport type { PropType } from 'vue'\n\nexport default {\n\tname: 'CollectionsList',\n\n\tcomponents: {\n\t\tAlertCircle,\n\t\tNcEmptyContent,\n\t},\n\n\tprops: {\n\t\tcollections: {\n\t\t\ttype: Object as PropType<Record<string, Collection>>,\n\t\t\trequired: true,\n\t\t},\n\t\tloading: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\terror: {\n\t\t\ttype: Error,\n\t\t\tdefault: null,\n\t\t},\n\t},\n\n\tcomputed: {\n\t\tnoCollection(): boolean {\n\t\t\treturn Object.keys(this.collections).length === 0\n\t\t},\n\t},\n\n\tmethods: {\n\t\tt: translate,\n\t},\n}\n</script>\n<style lang=\"scss\" scoped>\n.collections {\n\tdisplay: flex;\n\tflex-direction: column;\n\theight: 100%;\n\n\t&__list {\n\t\tpadding: 32px 48px;\n\t\tflex-grow: 1;\n\t\tdisplay: flex;\n\t\tflex-wrap: wrap;\n\t\tgap: 16px;\n\t\talign-items: flex-start;\n\t\theight: calc(100% - 60px);\n\t\toverflow-x: scroll;\n\n\t\t@media only screen and (max-width: 1200px) {\n\t\t\tpadding: 32px 12px;\n\t\t\tjustify-content: center;\n\t\t}\n\t}\n}\n</style>\n","<!--\n  - SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n<template>\n\t<li>\n\t\t<router-link class=\"collection-cover\" :to=\"link\">\n\t\t\t<img v-if=\"coverUrl !== ''\"\n\t\t\t\tclass=\"collection-cover__image\"\n\t\t\t\t:src=\"coverUrl\"\n\t\t\t\t:alt=\"altImg\">\n\n\t\t\t<div v-else class=\"collection-cover__image collection-cover__image--placeholder\">\n\t\t\t\t<ImageMultiple :size=\"128\" />\n\t\t\t</div>\n\t\t\t<div class=\"collection-cover__details\">\n\t\t\t\t<div class=\"collection-cover__details__title\">\n\t\t\t\t\t<slot name=\"default\" />\n\t\t\t\t</div>\n\t\t\t\t<div class=\"collection-cover__details__subtitle\">\n\t\t\t\t\t<slot name=\"subtitle\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</router-link>\n\t</li>\n</template>\n<script lang='ts'>\nimport ImageMultiple from 'vue-material-design-icons/ImageMultiple.vue'\n\nexport default {\n\tname: 'CollectionCover',\n\n\tcomponents: {\n\t\tImageMultiple,\n\t},\n\n\tprops: {\n\t\tcoverUrl: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\taltImg: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tlink: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n}\n</script>\n<style lang=\"scss\" scoped>\n.collection-cover {\n\tdisplay: flex;\n\tflex-direction: column;\n\tpadding: 16px;\n\tborder-radius: var(--border-radius-large);\n\n\t&:hover, &:focus {\n\t\tbackground: var(--color-background-dark);\n\t}\n\n\t&__image {\n\t\twidth: 350px;\n\t\theight: 350px;\n\t\tobject-fit: cover;\n\t\tborder-radius: var(--border-radius-large);\n\n\t\t@media only screen and (max-width: 1200px) {\n\t\t\twidth: 250px;\n\t\t\theight: 250px;\n\t\t}\n\n\t\t&--placeholder {\n\t\t\tbackground: var(--color-primary-element-light);\n\n\t\t\t:deep(.material-design-icon) {\n\t\t\t\twidth: 100%;\n\t\t\t\theight: 100%;\n\n\t\t\t\t.material-design-icon__svg {\n\t\t\t\t\tfill: var(--color-primary-element);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t&__details {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tmargin-top: 16px;\n\t\twidth: 350px;\n\n\t\t@media only screen and (max-width: 1200px) {\n\t\t\twidth: 250px;\n\t\t}\n\n\t\t&__title {\n\t\t\tdisplay: flex;\n\t\t}\n\n\t\t&__subtitle {\n\t\t\tdisplay: flex;\n\t\t\tcolor: var(--color-text-lighter);\n\t\t}\n\t}\n\n}\n</style>\n","/**\n * SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport moment from '@nextcloud/moment'\nimport { translate as t } from '@nextcloud/l10n'\n\nimport logger from './logger.js'\nimport { genFileInfo, type PhotoNode } from '../utils/fileUtils.js'\nimport { davClient } from './DavClient.ts'\nimport type { FileStat, ResponseDataDetailed, StatOptions, WebDAVClient } from 'webdav'\n\nexport type Collection = PhotoNode & {\n\tnbItems: number // The number of item in the collection.\n\tlastPhoto: number // The file id for the cover of the collection.\n\tdate: string // The date of the collection.\n\tcollaborators: object[] // The list of collaborators.\n}\n\nexport type RawCollaborators = ''|{collaborator: object[]|object}\nexport type RawCollection = FileStat & { filename: string, props: { collaborators: RawCollaborators }, dateRange: string }\n\nfunction getCollectionDavRequest(extraProps: string[] = []): string {\n\treturn `<?xml version=\"1.0\"?>\n\t\t\t<d:propfind xmlns:d=\"DAV:\"\n\t\t\t\txmlns:oc=\"http://owncloud.org/ns\"\n\t\t\t\txmlns:nc=\"http://nextcloud.org/ns\"\n\t\t\t\txmlns:ocs=\"http://open-collaboration-services.org/ns\">\n\t\t\t\t<d:prop>\n\t\t\t\t\t<nc:last-photo />\n\t\t\t\t\t<nc:nbItems />\n\t\t\t\t\t${extraProps.join('')}\n\t\t\t\t</d:prop>\n\t\t\t</d:propfind>`\n}\n\nfunction getCollectionFilesDavRequest(extraProps: string[] = []): string {\n\treturn `<?xml version=\"1.0\"?>\n\t\t\t<d:propfind xmlns:d=\"DAV:\"\n\t\t\t\txmlns:oc=\"http://owncloud.org/ns\"\n\t\t\t\txmlns:nc=\"http://nextcloud.org/ns\"\n\t\t\t\txmlns:ocs=\"http://open-collaboration-services.org/ns\">\n\t\t\t\t<d:prop>\n\t\t\t\t\t<d:getcontentlength />\n\t\t\t\t\t<d:getcontenttype />\n\t\t\t\t\t<d:getetag />\n\t\t\t\t\t<d:getlastmodified />\n\t\t\t\t\t<d:resourcetype />\n\t\t\t\t\t<nc:metadata-photos-size />\n\t\t\t\t\t<nc:metadata-photos-original_date_time />\n\t\t\t\t\t<nc:metadata-files-live-photo />\n\t\t\t\t\t<nc:has-preview />\n\t\t\t\t\t<nc:hidden />\n\t\t\t\t\t<oc:favorite />\n\t\t\t\t\t<oc:fileid />\n\t\t\t\t\t<oc:permissions />\n\t\t\t\t\t${extraProps.join('')}\n\t\t\t\t</d:prop>\n\t\t\t</d:propfind>`\n}\n\nexport async function fetchCollection(path: string, options: StatOptions, extraProps: string[] = [], client: WebDAVClient = davClient): Promise<Collection|null> {\n\ttry {\n\t\tconst response = await client.stat(path, {\n\t\t\tdata: getCollectionDavRequest(extraProps),\n\t\t\tdetails: true,\n\t\t\t...options,\n\t\t}) as ResponseDataDetailed<RawCollection>\n\n\t\tlogger.debug('[Collections] Fetched a collection: ', { data: response.data })\n\n\t\treturn formatCollection(response.data)\n\t} catch (error) {\n\t\tif (error instanceof DOMException && error.code === error.ABORT_ERR) {\n\t\t\treturn null\n\t\t}\n\n\t\tthrow error\n\t}\n}\n\nexport async function fetchCollections(path: string, options: StatOptions, extraProps: string[] = [], client: WebDAVClient = davClient): Promise<Collection[]> {\n\ttry {\n\t\tconst response = await client.getDirectoryContents(path, {\n\t\t\tdata: getCollectionDavRequest(extraProps),\n\t\t\tdetails: true,\n\t\t\t...options,\n\t\t}) as ResponseDataDetailed<Array<RawCollection>>\n\n\t\tlogger.debug(`[Collections] Fetched ${response.data.length} collections: `, { data: response.data })\n\n\t\treturn response.data\n\t\t\t.filter(collection => collection.filename !== path)\n\t\t\t.map(formatCollection)\n\t} catch (error) {\n\t\tif (error instanceof DOMException && error.code === error.ABORT_ERR) {\n\t\t\treturn []\n\t\t}\n\n\t\tthrow error\n\t}\n}\n\nfunction formatCollection(rawCollection: RawCollection): Collection {\n\tlet collaborators: object[] = []\n\n\t// Ensure that we have a proper collaborators array.\n\tif (rawCollection.props.collaborators === undefined || rawCollection.props.collaborators === '') {\n\t\tcollaborators = []\n\t} else if (typeof rawCollection.props.collaborators.collaborator === 'object') {\n\t\tif (Array.isArray(rawCollection.props.collaborators.collaborator)) {\n\t\t\tcollaborators = rawCollection.props.collaborators.collaborator\n\t\t} else {\n\t\t\tcollaborators = [rawCollection.props.collaborators.collaborator]\n\t\t}\n\t}\n\n\t// Extract custom props.\n\tconst collection = genFileInfo(rawCollection) as Collection\n\tcollection.collaborators = collaborators\n\n\t// Compute date range label.\n\tconst dateRange = JSON.parse(rawCollection.dateRange?.replace(/&quot;/g, '\"') ?? '{}')\n\tif (dateRange.start === null) {\n\t\tdateRange.start = moment().unix()\n\t\tdateRange.end = moment().unix()\n\t}\n\tconst dateRangeFormatted = {\n\t\tstartDate: moment.unix(dateRange.start).format('MMMM YYYY'),\n\t\tendDate: moment.unix(dateRange.end).format('MMMM YYYY'),\n\t}\n\tif (dateRangeFormatted.startDate === dateRangeFormatted.endDate) {\n\t\tcollection.date = dateRangeFormatted.startDate\n\t} else {\n\t\tcollection.date = t('photos', '{startDate} to {endDate}', dateRangeFormatted)\n\t}\n\n\treturn collection\n}\n\nexport async function fetchCollectionFiles(path: string, options: StatOptions, extraProps: string[] = [], client: WebDAVClient = davClient): Promise<PhotoNode[]> {\n\ttry {\n\t\tconst response = await client.getDirectoryContents(path, {\n\t\t\tdata: getCollectionFilesDavRequest(extraProps),\n\t\t\tdetails: true,\n\t\t\t...options,\n\t\t}) as ResponseDataDetailed<Array<FileStat>>\n\n\t\tconst fetchedFiles = response.data\n\t\t\t.map(file => genFileInfo(file))\n\t\t\t.filter(file => file.fileid)\n\n\t\tlogger.debug(`[Collections] Fetched ${fetchedFiles.length} new files: `, { fetchedFiles })\n\n\t\treturn fetchedFiles\n\t} catch (error) {\n\t\tif (error instanceof DOMException && error.code === error.ABORT_ERR) {\n\t\t\treturn []\n\t\t}\n\n\t\tlogger.error('Error fetching collection files', { error })\n\t\tthrow error\n\t}\n}\n","/**\n * SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { mapActions } from 'vuex'\nimport type { WebDAVClient } from 'webdav'\n\nimport { showError } from '@nextcloud/dialogs'\n\nimport AbortControllerMixin from './AbortControllerMixin.js'\nimport { fetchCollection, fetchCollectionFiles, type Collection } from '../services/collectionFetcher.js'\nimport logger from '../services/logger.js'\nimport SemaphoreWithPriority from '../utils/semaphoreWithPriority.js'\nimport type { PhotoNode } from '../utils/fileUtils.js'\n\nexport default {\n\tname: 'FetchCollectionContentMixin',\n\n\tdata() {\n\t\treturn {\n\t\t\tfetchSemaphore: new SemaphoreWithPriority(1),\n\t\t\tloadingCollection: false,\n\t\t\tloadingCollectionFiles: false,\n\t\t\terrorFetchingCollection: null,\n\t\t\terrorFetchingCollectionFiles: null,\n\t\t}\n\t},\n\n\tmixins: [\n\t\tAbortControllerMixin,\n\t],\n\n\tmethods: {\n\t\t...mapActions([\n\t\t\t'appendFiles',\n\t\t\t'addCollections',\n\t\t\t'setCollectionFiles',\n\t\t]),\n\t\tasync fetchCollection(collectionFileName: string, extraProps: string[], client: WebDAVClient): Promise<Collection|null> {\n\t\t\tif (this.loadingCollection) {\n\t\t\t\treturn null\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tthis.loadingCollection = true\n\t\t\t\tthis.errorFetchingCollection = null\n\n\t\t\t\tconst collection = await fetchCollection(collectionFileName, { signal: this.abortController.signal }, extraProps, client)\n\t\t\t\tthis.addCollections({ collections: [collection] })\n\t\t\t\treturn collection\n\t\t\t} catch (error) {\n\t\t\t\tif (error.response?.status === 404) {\n\t\t\t\t\tthis.errorFetchingCollection = 404\n\t\t\t\t\treturn null\n\t\t\t\t}\n\n\t\t\t\tthis.errorFetchingCollection = error\n\t\t\t\tlogger.error('[PublicCollectionContent] Error fetching collection', { error })\n\t\t\t\tshowError(this.t('photos', 'Failed to fetch collection.'))\n\t\t\t} finally {\n\t\t\t\tthis.loadingCollection = false\n\t\t\t}\n\n\t\t\treturn null\n\t\t},\n\n\t\tasync fetchCollectionFiles(collectionFileName: string, extraProps: string[], client: WebDAVClient, mappers: ((nodes: PhotoNode) => PhotoNode)[] = []): Promise<PhotoNode[]> {\n\t\t\tif (this.loadingCollectionFiles) {\n\t\t\t\treturn []\n\t\t\t}\n\n\t\t\tconst fetchSemaphoreSymbol = await this.fetchSemaphore.acquire()\n\n\t\t\ttry {\n\t\t\t\tthis.errorFetchingCollectionFiles = null\n\t\t\t\tthis.loadingCollectionFiles = true\n\n\t\t\t\tlet fetchedFiles = await fetchCollectionFiles(collectionFileName, { signal: this.abortController.signal }, extraProps, client)\n\t\t\t\tconst fileIds = fetchedFiles.map(file => file.fileid.toString())\n\n\t\t\t\tmappers.forEach(mapper => (fetchedFiles = fetchedFiles.map(mapper)))\n\n\t\t\t\tthis.appendFiles(fetchedFiles)\n\n\t\t\t\tif (fetchedFiles.length > 0) {\n\t\t\t\t\tawait this.$store.commit('setCollectionFiles', { collectionFileName, fileIds })\n\t\t\t\t}\n\n\t\t\t\treturn fetchedFiles\n\t\t\t} catch (error) {\n\t\t\t\tif (error.response?.status === 404) {\n\t\t\t\t\tthis.errorFetchingCollectionFiles = 404\n\t\t\t\t\treturn []\n\t\t\t\t}\n\n\t\t\t\tthis.errorFetchingCollectionFiles = error\n\n\t\t\t\tshowError(this.t('photos', 'Failed to fetch collections list.'))\n\t\t\t\tlogger.error('[PublicCollectionContent] Error fetching collection files', { error })\n\t\t\t} finally {\n\t\t\t\tthis.loadingCollectionFiles = false\n\t\t\t\tthis.fetchSemaphore.release(fetchSemaphoreSymbol)\n\t\t\t}\n\n\t\t\treturn []\n\t\t},\n\t},\n}\n","/**\n * SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { mapActions } from 'vuex'\n\nimport AbortControllerMixin from './AbortControllerMixin.js'\nimport { fetchCollections, type Collection } from '../services/collectionFetcher.js'\nimport logger from '../services/logger.js'\nimport type { WebDAVClient } from 'webdav'\n\nexport default {\n\tname: 'FetchCollectionsMixin',\n\n\tdata() {\n\t\treturn {\n\t\t\terrorFetchingCollections: null,\n\t\t\tloadingCollections: false,\n\t\t}\n\t},\n\n\tmixins: [\n\t\tAbortControllerMixin,\n\t],\n\n\tmethods: {\n\t\t...mapActions([\n\t\t\t'addCollections',\n\t\t]),\n\n\t\tasync fetchCollections(collectionHome: string, extraProps: string[], client: WebDAVClient): Promise<Collection[]> {\n\t\t\tif (this.loadingCollections) {\n\t\t\t\treturn []\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tthis.loadingCollections = true\n\t\t\t\tthis.errorFetchingCollections = null\n\n\t\t\t\tconst collections = await fetchCollections(collectionHome, { signal: this.abortController.signal }, extraProps, client)\n\n\t\t\t\tthis.addCollections({ collections })\n\n\t\t\t\treturn collections\n\t\t\t} catch (error) {\n\t\t\t\tif (error.response?.status === 404) {\n\t\t\t\t\tthis.errorFetchingCollections = 404\n\t\t\t\t} else {\n\t\t\t\t\tthis.errorFetchingCollections = error\n\t\t\t\t}\n\t\t\t\tlogger.error('Error fetching collections:', { error })\n\t\t\t} finally {\n\t\t\t\tthis.loadingCollections = false\n\t\t\t}\n\n\t\t\treturn []\n\t\t},\n\t},\n}\n","/**\n * SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { showError } from '@nextcloud/dialogs'\nimport { defaultRootPath } from '@nextcloud/files/dav'\nimport { joinPaths } from '@nextcloud/paths'\nimport { translate as t } from '@nextcloud/l10n'\n\nimport { davClient } from '../services/DavClient.ts'\nimport logger from '../services/logger.js'\nimport getPhotos, { type PhotoSearchOptions } from '../services/PhotoSearch.js'\nimport SemaphoreWithPriority from '../utils/semaphoreWithPriority.js'\nimport AbortControllerMixin from './AbortControllerMixin.js'\nimport store from '../store/index.js'\nimport type { ComponentOptions } from 'vue'\n\nexport default {\n\tname: 'FetchFilesMixin',\n\n\tmixins: [\n\t\tAbortControllerMixin,\n\t],\n\n\tdata() {\n\t\treturn {\n\t\t\terrorFetchingFiles: null,\n\t\t\tloadingFiles: false,\n\t\t\tdoneFetchingFiles: false,\n\t\t\tfetchSemaphore: new SemaphoreWithPriority(1),\n\t\t\tfetchedFileIds: [] as string[],\n\t\t}\n\t},\n\n\twatch: {\n\t\t'$route.path'() {\n\t\t\tthis.resetFetchFilesState()\n\t\t},\n\t},\n\n\tmethods: {\n\t\t/**\n\t\t * @param options - Options to pass to getPhotos.\n\t\t * @param blacklist - Array of ids to filter out.\n\t\t * @param force - Force fetching even if doneFetchingFiles is true\n\t\t * @return {Promise<string[]>} - The next batch of data depending on global offset.\n\t\t */\n\t\tasync fetchFiles(options: Partial<PhotoSearchOptions> = {}, blacklist: string[] = [], force: boolean = false) {\n\t\t\tif ((this.doneFetchingFiles && !force) || this.loadingFiles) {\n\t\t\t\treturn []\n\t\t\t}\n\n\t\t\tconst fetchSemaphoreSymbol = await this.fetchSemaphore.acquire()\n\n\t\t\ttry {\n\t\t\t\tthis.errorFetchingFiles = null\n\t\t\t\tthis.loadingFiles = true\n\n\t\t\t\tconst numberOfImagesPerBatch = 200\n\n\t\t\t\t// Load next batch of images\n\t\t\t\tconst fetchedFiles = await getPhotos({\n\t\t\t\t\tfirstResult: this.fetchedFileIds.length,\n\t\t\t\t\tnbResults: numberOfImagesPerBatch,\n\t\t\t\t\t...options,\n\t\t\t\t\tsignal: this.abortController.signal,\n\t\t\t\t})\n\n\t\t\t\t// If we get less files than requested that means we got to the end\n\t\t\t\tif (fetchedFiles.length !== numberOfImagesPerBatch) {\n\t\t\t\t\tthis.doneFetchingFiles = true\n\t\t\t\t}\n\n\t\t\t\tconst fileIds = fetchedFiles\n\t\t\t\t\t.map(file => file.fileid)\n\t\t\t\t\t.filter(fileId => !this.fetchedFileIds.includes(fileId.toString())) // Filter to prevent duplicate fileIds.\n\n\t\t\t\tthis.fetchedFileIds.push(\n\t\t\t\t\t...fileIds\n\t\t\t\t\t\t.map((fileId) => fileId.toString())\n\t\t\t\t\t\t.filter((fileId) => !blacklist.includes(fileId)),\n\t\t\t\t)\n\n\t\t\t\tthis.$store.dispatch('appendFiles', fetchedFiles)\n\n\t\t\t\tlogger.debug(`[FetchFilesMixin] Fetched ${fileIds.length} new files: `, { fileIds })\n\n\t\t\t\treturn fileIds\n\t\t\t} catch (error) {\n\t\t\t\tif (error.response?.status === 404) {\n\t\t\t\t\tconst sources = store.state.userConfig.photosSourceFolders\n\t\t\t\t\tfor (const source of sources) {\n\t\t\t\t\t\tif (error.response?.data?.match(`File with name /${source} could not be located`) === null) {\n\t\t\t\t\t\t\tcontinue\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlogger.debug(`The ${source} folder does not exist, creating it.`)\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tawait davClient.createDirectory(joinPaths(defaultRootPath, source))\n\t\t\t\t\t\t\tthis.resetFetchFilesState()\n\t\t\t\t\t\t\treturn []\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tthis.errorFetchingFiles = 404\n\t\t\t\t\t\t\tlogger.error('Fail to create source directory', { error })\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if (error instanceof DOMException && error.code === error.ABORT_ERR) {\n\t\t\t\t\treturn []\n\t\t\t\t} else {\n\t\t\t\t\tthis.errorFetchingFiles = error\n\t\t\t\t}\n\n\t\t\t\t// cancelled request, moving on...\n\t\t\t\tshowError(t('photos', 'Error fetching files'))\n\t\t\t\tlogger.error(error)\n\t\t\t} finally {\n\t\t\t\tthis.loadingFiles = false\n\t\t\t\tthis.fetchSemaphore.release(fetchSemaphoreSymbol)\n\t\t\t}\n\n\t\t\treturn []\n\t\t},\n\n\t\tresetFetchFilesState() {\n\t\t\tthis.doneFetchingFiles = false\n\t\t\tthis.errorFetchingFiles = null\n\t\t\tthis.loadingFiles = false\n\t\t\tthis.fetchedFileIds = []\n\t\t},\n\t},\n} as ComponentOptions<Vue>\n","<!--\n  - SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n<template>\n\t<NcActionButton v-if=\"shouldFavoriteSelection\"\n\t\t:close-after-click=\"true\"\n\t\t:aria-label=\"t('photos', 'Mark selection as favorite')\"\n\t\t@click=\"favoriteSelection\">\n\t\t{{ t('photos', 'Add selection to favorites') }}\n\t\t<Star slot=\"icon\" />\n\t</NcActionButton>\n\t<NcActionButton v-else\n\t\t:close-after-click=\"true\"\n\t\t:aria-label=\"t('photos', 'Remove selection from favorites')\"\n\t\t@click=\"unFavoriteSelection\">\n\t\t{{ t('photos', 'Remove selection from favorites') }}\n\t\t<Star slot=\"icon\" />\n\t</NcActionButton>\n</template>\n\n<script lang='ts'>\nimport { mapActions, mapGetters } from 'vuex'\nimport Star from 'vue-material-design-icons/Star.vue'\n\nimport { NcActionButton } from '@nextcloud/vue'\n\nexport default {\n\tname: 'ActionFavorite',\n\tcomponents: {\n\t\tStar,\n\t\tNcActionButton,\n\t},\n\n\tprops: {\n\t\tselectedFileIds: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tcomputed: {\n\t\t...mapGetters([\n\t\t\t'files',\n\t\t]),\n\n\t\t/** @return {boolean} */\n\t\tshouldFavoriteSelection() {\n\t\t\t// Favorite all selection if at least one file is not in the favorites.\n\t\t\treturn this.selectedFileIds.some((fileId) => this.files[fileId].favorite === 0)\n\t\t},\n\t},\n\n\tmethods: {\n\t\t...mapActions([\n\t\t\t'toggleFavoriteForFiles',\n\t\t]),\n\n\t\tasync favoriteSelection() {\n\t\t\tawait this.toggleFavoriteForFiles({ fileIds: this.selectedFileIds, favoriteState: 1 })\n\t\t},\n\n\t\tasync unFavoriteSelection() {\n\t\t\tawait this.toggleFavoriteForFiles({ fileIds: this.selectedFileIds, favoriteState: 0 })\n\t\t},\n\t},\n}\n</script>\n","/**\n * SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nexport default {\n\tname: 'FilesSelectionMixin',\n\n\tdata() {\n\t\treturn {\n\t\t\tselection: {} as Record<string, boolean>,\n\t\t}\n\t},\n\n\twatch: {\n\t\t$route() {\n\t\t\tthis.resetSelection()\n\t\t},\n\t},\n\n\tmethods: {\n\t\tonFileSelectToggle({ id, value }): void {\n\t\t\tthis.$set(this.selection, id, value)\n\t\t},\n\n\t\tonUncheckFiles(filesIds: string[]): void {\n\t\t\tfilesIds.forEach((filesId: string) => this.$set(this.selection, filesId, false))\n\t\t},\n\n\t\tresetSelection(): void {\n\t\t\tthis.selection = {}\n\t\t},\n\t},\n\n\tcomputed: {\n\t\tselectedFileIds(): string[] {\n\t\t\treturn Object.keys(this.selection).filter(fileId => this.selection[fileId])\n\t\t},\n\t},\n}\n","/**\n * SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nexport type TiledItem = {\n\tid: string // Unique id for the item.\n\twidth: number // Real width of the item.\n\theight: number // Real height of the item.\n\tratio: number // The aspect ratio of the item.\n}\n\nexport type Section = {\n\tid: string // Unique id for the section.\n\titems: TiledItem[] // Real width of the item.\n}\n\nexport type TiledRow = {\n\titems: TiledItem[] // List of item in the row.\n\theight: number // Height of the row.\n\tkey: string // Unique key for the row.\n}\n\nexport type TiledSection = Section & {\n\tkey: string // Unique key for the section.\n\trows: TiledRow[] // Real width of the item.\n\theight: number // Height of the section.\n}\n\n/**\n * Split items in rows of equal width.\n * The last row will not be forced to match containerWidth.\n */\nexport function splitItemsInRows(items: TiledItem[], containerWidth: number, baseHeight: number = 200): TiledRow[] {\n\tif (containerWidth === 0) {\n\t\treturn []\n\t}\n\n\tconst rows: TiledRow[] = []\n\tlet rowNumber = 0\n\tlet currentItem = 0\n\n\twhile (currentItem < items.length) {\n\t\tconst rowItems: TiledItem[] = []\n\n\t\t// Fill the row with new items as long as the width is less than containerWidth.\n\t\tdo {\n\t\t\trowItems.push(items[currentItem++])\n\t\t} while (\n\t\t\tcurrentItem < items.length\n\t\t\t&& computeRowWidth([...rowItems, items[currentItem]], baseHeight) <= containerWidth\n\t\t)\n\n\t\tconst rowHeight = computeRowHeight(\n\t\t\trowItems,\n\t\t\tcontainerWidth,\n\t\t\titems.length === currentItem,\n\t\t\tbaseHeight,\n\t\t)\n\n\t\trows[rowNumber] = {\n\t\t\titems: rowItems.map(item => ({ ...item, width: rowHeight * item.ratio, height: rowHeight })),\n\t\t\t// Key to help vue to keep track of the row in VirtualScrolling.\n\t\t\theight: rowHeight,\n\t\t\tkey: rowItems.map(item => item.id).join('-'),\n\t\t}\n\n\t\trowNumber += 1\n\t}\n\n\treturn rows\n}\n\nfunction computeRowWidth(items: TiledItem[], baseHeight: number): number {\n\treturn items\n\t\t.map(item => baseHeight * item.ratio)\n\t\t.reduce((sum, itemWidth) => sum + itemWidth)\n}\n\n/**\n * Compute the row height based on its items and on the container's width.\n *\n * Math time !\n * With Rn the aspect ratio of item n\n *      Wn the width of item n\n *      Hn the height of item n\n *      Wc the width of the container\n *      Hr the height of the row\n * For n items we want: Wc = W1 + W2 + ... + Wn\n * We know Rn = Wn / Hn\n * So Wn = Rn * Hn\n * So Wc = (R1 * H1) + (R2 * H2) + ... + (Rn * Hn)\n * But we also want Hr === H1 === H2 === ... === Hn\n * So Wc = (R1 * Hr) + (R2 * Hr) + ... + (Rn * Hr)\n * So Wc = Hr * (R1 + R2 + ... + Rn)\n * So Hr = Wc / (R1 + R2 + ... + Rn)\n */\nfunction computeRowHeight(items: TiledItem[], containerWidth: number, isLastRow: boolean, baseHeight: number): number {\n\tconst sumOfItemsRatio = items\n\t\t.map(item => item.ratio)\n\t\t.reduce((sum, itemRatio) => sum + itemRatio,\n\t\t)\n\n\tlet rowHeight = containerWidth / sumOfItemsRatio\n\n\t// Exception 1: there is only one item which is larger than containerWidth.\n\t// Limit its height so that itemWidth === containerWidth\n\tif (items.length === 1 && items[0].width > containerWidth) {\n\t\trowHeight = containerWidth / items[0].ratio\n\t}\n\n\t// Exception 2: we reached the last row.\n\t// Force the items width to match containerWidth, and limit their height to baseHeight + 20.\n\tif (isLastRow) {\n\t\trowHeight = Math.min(baseHeight + 20, rowHeight)\n\t}\n\n\treturn rowHeight\n}\n","<!--\n  - SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n<template>\n\t<div ref=\"tiledLayoutContainer\"\n\t\tclass=\"tiled-container\">\n\t\t<!-- Slot to allow changing the rows before passing them to TiledRows -->\n\t\t<!-- Useful for partially rendering rows like with VirtualScrolling -->\n\t\t<slot :tiled-sections=\"tiledSections\">\n\t\t\t<!-- Default rendering -->\n\t\t\t<TiledRows :rows=\"tiledSections\" />\n\t\t</slot>\n\t</div>\n</template>\n\n<script lang='ts'>\nimport type { PropType } from 'vue'\nimport logger from '../../services/logger.js'\nimport { splitItemsInRows, type Section, type TiledSection } from '../../services/TiledLayout.js'\nimport TiledRows from './TiledRows.vue'\n\nexport default {\n\tname: 'TiledLayout',\n\n\tcomponents: {\n\t\tTiledRows,\n\t},\n\n\tprops: {\n\t\tsections: {\n\t\t\ttype: Array as PropType<Section[]>,\n\t\t\trequired: true,\n\t\t},\n\t\tbaseHeight: {\n\t\t\ttype: Number,\n\t\t\tdefault: 200,\n\t\t},\n\t},\n\n\tdata() {\n\t\treturn {\n\t\t\tcontainerWidth: 0,\n\t\t\tresizeObserver: null as ResizeObserver|null,\n\t\t}\n\t},\n\n\tcomputed: {\n\t\ttiledSections(): TiledSection[] {\n\t\t\tlogger.debug('[TiledLayout] Computing rows', { items: this.sections })\n\n\t\t\treturn this.sections.map(section => {\n\t\t\t\tconst rows = splitItemsInRows(section.items, this.containerWidth, this.baseHeight)\n\t\t\t\treturn {\n\t\t\t\t\t...section,\n\t\t\t\t\tkey: section.id,\n\t\t\t\t\trows: rows.map(row => ({ ...row, sectionKey: section.id })),\n\t\t\t\t\theight: rows.reduce((totalHeight, row) => totalHeight + row.height, 0),\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\t},\n\n\tmounted() {\n\t\tthis.resizeObserver = new ResizeObserver(entries => {\n\t\t\tfor (const entry of entries) {\n\t\t\t\tconst cr = entry.contentRect\n\t\t\t\tif (entry.target.classList.contains('tiled-container')) {\n\t\t\t\t\tthis.containerWidth = cr.width\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\n\t\tthis.resizeObserver.observe(this.$refs.tiledLayoutContainer as Element)\n\t},\n\n\tbeforeDestroy() {\n\t\tthis.resizeObserver?.disconnect()\n\t},\n}\n</script>\n\n<style scoped lang=\"scss\">\n.tiled-container {\n\theight: 100%;\n\n\t.tiled-row {\n\t\tdisplay: flex;\n\t}\n}\n</style>\n","<!--\n - SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n<template>\n\t<div v-if=\"!useWindow && containerElement === null\" ref=\"container\" class=\"vs-container\">\n\t\t<div ref=\"rowsContainer\"\n\t\t\tclass=\"vs-rows-container\"\n\t\t\t:style=\"rowsContainerStyle\">\n\t\t\t<slot :visible-sections=\"visibleSections\" />\n\t\t\t<slot name=\"loader\" />\n\t\t</div>\n\t</div>\n\t<div v-else\n\t\tref=\"rowsContainer\"\n\t\tclass=\"vs-rows-container\"\n\t\t:style=\"rowsContainerStyle\">\n\t\t<slot :visible-sections=\"visibleSections\" />\n\t\t<slot name=\"loader\" />\n\t</div>\n</template>\n\n<script lang='ts'>\nimport type { PropType } from 'vue'\nimport logger from '../services/logger.js'\n\nexport type Row = {\n\tkey: string // Unique key for the row.\n\theight: number // The height of the row.\n\tsectionKey: string // Unique key for the row.\n}\n\nexport type VisibleRow = Row & {\n\tdistance: number // The distance from the visible viewport\n}\n\nexport type Section = {\n\tid: string // Unique key for the section.\n\trows: Row[] // The height of the row.\n\theight: number // Height of the section, excluding the header.\n}\n\nexport type VisibleSection = Section & {\n\trows: VisibleRow[] // The height of the row.\n}\n\nexport default {\n\tname: 'VirtualScrolling',\n\n\tprops: {\n\t\tsections: {\n\t\t\ttype: Array as PropType<Section[]>,\n\t\t\trequired: true,\n\t\t},\n\n\t\tcontainerElement: {\n\t\t\ttype: HTMLElement,\n\t\t\tdefault: null,\n\t\t},\n\n\t\tuseWindow: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\n\t\theaderHeight: {\n\t\t\ttype: Number,\n\t\t\tdefault: 75,\n\t\t},\n\t\trenderDistance: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0.5,\n\t\t},\n\t\tbottomBufferRatio: {\n\t\t\ttype: Number,\n\t\t\tdefault: 2,\n\t\t},\n\t\tscrollToKey: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\n\tdata() {\n\t\treturn {\n\t\t\tscrollPosition: 0,\n\t\t\tcontainerHeight: 0,\n\t\t\trowsContainerHeight: 0,\n\t\t\tresizeObserver: null as ResizeObserver|null,\n\t\t}\n\t},\n\n\tcomputed: {\n\t\tvisibleSections(): VisibleSection[] {\n\t\t\tlogger.debug('[VirtualScrolling] Computing visible section', { sections: this.sections })\n\n\t\t\t// Optimisation: get those computed properties once to not go through vue's internal every time we need them.\n\t\t\tconst containerHeight = this.containerHeight\n\t\t\tconst containerTop = this.scrollPosition\n\t\t\tconst containerBottom = containerTop + containerHeight\n\n\t\t\tlet currentRowTop = 0\n\t\t\tlet currentRowBottom = 0\n\n\t\t\t// Compute whether a row should be included in the DOM (shouldRender)\n\t\t\t// And how visible the row is.\n\t\t\tconst visibleSections = this.sections\n\t\t\t\t.map(section => {\n\t\t\t\t\tcurrentRowBottom += this.headerHeight\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...section,\n\t\t\t\t\t\trows: section.rows.reduce((visibleRows, row) => {\n\t\t\t\t\t\t\tcurrentRowTop = currentRowBottom\n\t\t\t\t\t\t\tcurrentRowBottom += row.height\n\n\t\t\t\t\t\t\tlet distance = 0\n\n\t\t\t\t\t\t\tif (currentRowBottom < containerTop) {\n\t\t\t\t\t\t\t\tdistance = (containerTop - currentRowBottom) / containerHeight\n\t\t\t\t\t\t\t} else if (currentRowTop > containerBottom) {\n\t\t\t\t\t\t\t\tdistance = (currentRowTop - containerBottom) / containerHeight\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (distance > this.renderDistance) {\n\t\t\t\t\t\t\t\treturn visibleRows\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\t\t...visibleRows,\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t...row,\n\t\t\t\t\t\t\t\t\tdistance,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}, [] as VisibleRow[]),\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.filter(section => section.rows.length > 0)\n\n\t\t\t// To allow vue to recycle the DOM elements instead of adding and deleting new ones,\n\t\t\t// we assign a random key to each items. When a item removed, we recycle its key for new items,\n\t\t\t// so vue can replace the content of removed DOM elements with the content of new items, but keep the other DOM elements untouched.\n\t\t\tconst visibleItems = visibleSections\n\t\t\t\t.flatMap(({ rows }) => rows)\n\t\t\t\t.flatMap(({ items }) => items)\n\n\t\t\tvisibleItems.forEach(item => (item.key = this.rowIdToKeyMap[item.id]))\n\n\t\t\tconst usedTokens = visibleItems\n\t\t\t\t.map(({ key }) => key)\n\t\t\t\t.filter(key => key !== undefined)\n\n\t\t\tconst unusedTokens = Object.values(this.rowIdToKeyMap).filter(key => !usedTokens.includes(key))\n\n\t\t\tvisibleItems\n\t\t\t\t.filter(({ key }) => key === undefined)\n\t\t\t\t.forEach(item => (item.key = unusedTokens.pop() ?? Math.random().toString(36).substr(2)))\n\n\t\t\t// this.rowIdToKeyMap is created in the beforeCreate hook, so value changes are not tracked.\n\t\t\t// Therefore, we wont trigger the computation of visibleSections again if we alter the value of this.rowIdToKeyMap.\n\t\t\t// eslint-disable-next-line vue/no-side-effects-in-computed-properties\n\t\t\tthis.rowIdToKeyMap = visibleItems.reduce((finalMapping, { id, key }) => ({ ...finalMapping, [`${id}`]: key }), {})\n\n\t\t\treturn visibleSections\n\t\t},\n\n\t\t/**\n\t\t * Total height of all the rows + some room for the loader.\n\t\t */\n\t\ttotalHeight(): number {\n\t\t\tconst loaderHeight = 200\n\n\t\t\treturn this.sections\n\t\t\t\t.map(section => this.headerHeight + section.height)\n\t\t\t\t.reduce((totalHeight, sectionHeight) => totalHeight + sectionHeight, 0) + loaderHeight\n\t\t},\n\n\t\tpaddingTop(): number {\n\t\t\tif (this.visibleSections.length === 0) {\n\t\t\t\treturn 0\n\t\t\t}\n\n\t\t\tlet paddingTop = 0\n\n\t\t\tfor (const section of this.sections) {\n\t\t\t\tif (section.key !== this.visibleSections[0].rows[0].sectionKey) {\n\t\t\t\t\tpaddingTop += this.headerHeight + section.height\n\t\t\t\t\tcontinue\n\t\t\t\t}\n\n\t\t\t\tfor (const row of section.rows) {\n\t\t\t\t\tif (row.key === this.visibleSections[0].rows[0].key) {\n\t\t\t\t\t\treturn paddingTop\n\t\t\t\t\t}\n\n\t\t\t\t\tpaddingTop += row.height\n\t\t\t\t}\n\n\t\t\t\tpaddingTop += this.headerHeight\n\t\t\t}\n\n\t\t\treturn paddingTop\n\t\t},\n\n\t\t/**\n\t\t * padding-top is used to replace not included item in the container.\n\t\t */\n\t\trowsContainerStyle(): {height: string, paddingTop: string} {\n\t\t\treturn {\n\t\t\t\theight: `${this.totalHeight}px`,\n\t\t\t\tpaddingTop: `${this.paddingTop}px`,\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Whether the user is near the bottom.\n\t\t * If true, then the need-content event will be emitted.\n\t\t */\n\t\tisNearBottom(): boolean {\n\t\t\tconst buffer = this.containerHeight * this.bottomBufferRatio\n\t\t\treturn this.scrollPosition + this.containerHeight >= this.totalHeight - buffer\n\t\t},\n\n\t\tcontainer(): HTMLElement|Window {\n\t\t\tlogger.debug('[VirtualScrolling] Computing container')\n\t\t\tif (this.containerElement !== null) {\n\t\t\t\treturn this.containerElement\n\t\t\t} else if (this.useWindow) {\n\t\t\t\treturn window\n\t\t\t} else {\n\t\t\t\treturn this.$refs.container as HTMLElement\n\t\t\t}\n\t\t},\n\t},\n\n\twatch: {\n\t\tisNearBottom(value) {\n\t\t\tlogger.debug('[VirtualScrolling] isNearBottom changed', { value })\n\t\t\tif (value) {\n\t\t\t\tthis.$emit('need-content')\n\t\t\t}\n\t\t},\n\n\t\tvisibleSections() {\n\t\t\t// Re-emit need-content when rows is updated and isNearBottom is still true.\n\t\t\t// If the height of added rows is under `bottomBufferRatio`, `isNearBottom` will still be true so we need more content.\n\t\t\tif (this.isNearBottom) {\n\t\t\t\tthis.$emit('need-content')\n\t\t\t}\n\t\t},\n\n\t\tscrollToKey(key) {\n\t\t\tlet currentRowTopDistanceFromTop = 0\n\n\t\t\tfor (const section of this.sections) {\n\t\t\t\tif (section.key !== key) {\n\t\t\t\t\tcurrentRowTopDistanceFromTop += this.headerHeight + section.height\n\t\t\t\t\tcontinue\n\t\t\t\t}\n\n\t\t\t\tbreak\n\t\t\t}\n\n\t\t\tlogger.debug('[VirtualScrolling] Scrolling to', { currentRowTopDistanceFromTop })\n\t\t\t;(this.$refs.container as Element).scrollTo({ top: currentRowTopDistanceFromTop, behavior: 'smooth' })\n\t\t},\n\t},\n\n\tbeforeCreate() {\n\t\tthis.rowIdToKeyMap = {}\n\t},\n\n\tmounted() {\n\t\tthis.resizeObserver = new ResizeObserver(entries => {\n\t\t\tfor (const entry of entries) {\n\t\t\t\tconst cr = entry.contentRect\n\t\t\t\tif (entry.target === this.container) {\n\t\t\t\t\tthis.containerHeight = cr.height\n\t\t\t\t}\n\t\t\t\tif (entry.target.classList.contains('vs-rows-container')) {\n\t\t\t\t\tthis.rowsContainerHeight = cr.height\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\n\t\tif (this.useWindow) {\n\t\t\twindow.addEventListener('resize', this.updateContainerSize, { passive: true })\n\t\t\tthis.containerHeight = window.innerHeight\n\t\t} else {\n\t\t\tthis.resizeObserver.observe(this.container as Element)\n\t\t}\n\n\t\tthis.resizeObserver.observe(this.$refs.rowsContainer as Element)\n\t\tthis.container?.addEventListener('scroll', this.updateScrollPosition, { passive: true })\n\t},\n\n\tbeforeDestroy() {\n\t\tif (this.useWindow) {\n\t\t\twindow.removeEventListener('resize', this.updateContainerSize)\n\t\t}\n\n\t\tthis.resizeObserver?.disconnect()\n\t\tthis.container?.removeEventListener('scroll', this.updateScrollPosition)\n\t},\n\n\tmethods: {\n\t\tupdateScrollPosition() {\n\t\t\tthis._onScrollHandle ??= requestAnimationFrame(() => {\n\t\t\t\tthis._onScrollHandle = null\n\t\t\t\tif (this.useWindow) {\n\t\t\t\t\tthis.scrollPosition = (this.container as Window).scrollY\n\t\t\t\t} else {\n\t\t\t\t\tthis.scrollPosition = (this.container as HTMLElement).scrollTop\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\n\t\tupdateContainerSize() {\n\t\t\tthis.containerHeight = window.innerHeight\n\t\t},\n\t},\n}\n</script>\n\n<style scoped lang=\"scss\">\n.vs-container {\n\toverflow-y: scroll;\n\theight: 100%;\n}\n\n.vs-rows-container {\n\tbox-sizing: border-box;\n\twill-change: scroll-position, padding;\n\tcontain: layout paint style;\n}\n</style>\n","<!--\n - SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n<template>\n\t<div class=\"files-list-viewer\">\n\t\t<NcEmptyContent v-if=\"emptyMessage !== '' && photosCount === 0 && !loading\"\n\t\t\tkey=\"emptycontent\"\n\t\t\t:name=\"emptyMessage\">\n\t\t\t<PackageVariant slot=\"icon\" />\n\t\t</NcEmptyContent>\n\n\t\t<TiledLayout :base-height=\"baseHeight\" :sections=\"itemsBySections\">\n\t\t\t<VirtualScrolling slot-scope=\"{tiledSections}\"\n\t\t\t\t:use-window=\"useWindow\"\n\t\t\t\t:container-element=\"containerElement\"\n\t\t\t\t:sections=\"tiledSections\"\n\t\t\t\t:scroll-to-key=\"scrollToSection\"\n\t\t\t\t:header-height=\"sectionHeaderHeight\"\n\t\t\t\t@need-content=\"needContent\">\n\t\t\t\t<template slot-scope=\"{visibleSections}\">\n\t\t\t\t\t<div v-for=\"section of visibleSections\" :key=\"section.id\">\n\t\t\t\t\t\t<template v-if=\"section.id !== ''\">\n\t\t\t\t\t\t\t<!-- Placeholder when initial loading -->\n\t\t\t\t\t\t\t<div v-if=\"showPlaceholders\"\n\t\t\t\t\t\t\t\tclass=\"files-list-viewer__placeholder\"\n\t\t\t\t\t\t\t\t:style=\"{ 'flex-basis': '100%', height: `${sectionHeaderHeight}px`}\" />\n\t\t\t\t\t\t\t<!-- Real file. -->\n\t\t\t\t\t\t\t<slot v-else\n\t\t\t\t\t\t\t\t:file=\"{id: section.id}\"\n\t\t\t\t\t\t\t\t:is-header=\"true\"\n\t\t\t\t\t\t\t\tclass=\"files-list-viewer__section-header\"\n\t\t\t\t\t\t\t\t:style=\"{ 'flex-basis': '100%', height: `${sectionHeaderHeight}px`}\" />\n\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t<template v-for=\"(row, rowIndex) of section.rows\">\n\t\t\t\t\t\t\t\t<!--\n\t\t\t\t\t\t\t\t\tWe are subtracting 1 from flex-basis to compensate for rounding issues.\n\t\t\t\t\t\t\t\t\tThe flex algo will then compensate with flex-grow.\n\t\t\t\t\t\t\t\t\t'last-tiled-row' prevents the last row's items from growing.\n\t\t\t\t\t\t\t\t-->\n\t\t\t\t\t\t\t\t<li v-for=\"item of row.items\"\n\t\t\t\t\t\t\t\t\t:key=\"item.key\"\n\t\t\t\t\t\t\t\t\t:class=\"{ 'last-tiled-rows': rowIndex === section.rows.length - 1 }\"\n\t\t\t\t\t\t\t\t\t:style=\"{ 'flex-basis': `${item.width - 1}px`, height: `${item.height}px`}\">\n\t\t\t\t\t\t\t\t\t<!-- Placeholder when initial loading -->\n\t\t\t\t\t\t\t\t\t<div v-if=\"showPlaceholders\" class=\"files-list-viewer__placeholder\" />\n\t\t\t\t\t\t\t\t\t<!-- Real file. -->\n\t\t\t\t\t\t\t\t\t<slot v-else :file=\"item\" :distance=\"row.distance\" />\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<NcLoadingIcon v-if=\"loading && !showPlaceholders\" slot=\"loader\" class=\"files-list-viewer__loader\" />\n\t\t\t</VirtualScrolling>\n\t\t</TiledLayout>\n\t</div>\n</template>\n<script lang='ts'>\nimport { mapActions, mapGetters } from 'vuex'\n\nimport PackageVariant from 'vue-material-design-icons/PackageVariant.vue'\n\nimport { NcEmptyContent, NcLoadingIcon } from '@nextcloud/vue'\nimport { subscribe, unsubscribe } from '@nextcloud/event-bus'\n\nimport TiledLayout from '../components/TiledLayout/TiledLayout.vue'\nimport { fetchFile } from '../services/fileFetcher.ts'\nimport VirtualScrolling from '../components/VirtualScrolling.vue'\nimport type { TiledItem } from '../services/TiledLayout.ts'\nimport type { PhotoNode } from '../utils/fileUtils.ts'\n\nexport default {\n\tname: 'FilesListViewer',\n\n\tcomponents: {\n\t\tPackageVariant,\n\t\tNcEmptyContent,\n\t\tNcLoadingIcon,\n\t\tTiledLayout,\n\t\tVirtualScrolling,\n\t},\n\n\tprops: {\n\t\t// Array of file ids that should be rendered.\n\t\tfileIds: {\n\t\t\ttype: Array,\n\t\t\tdefault: undefined,\n\t\t},\n\t\t// An object mapping a list of section to a list of fileIds.\n\t\tfileIdsBySection: {\n\t\t\ttype: Object,\n\t\t\tdefault: undefined,\n\t\t},\n\t\t// The list of sorted sections.\n\t\tsections: {\n\t\t\ttype: Array,\n\t\t\tdefault: undefined,\n\t\t},\n\t\t// Whether we should display a loading indicator.\n\t\tloading: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\t// Message to display when there is no files.\n\t\temptyMessage: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\t// The base height to forward to TileLayout.\n\t\tbaseHeight: {\n\t\t\ttype: Number,\n\t\t\tdefault: 200,\n\t\t},\n\t\t// The height to use for section headers.\n\t\tsectionHeaderHeight: {\n\t\t\ttype: Number,\n\t\t\tdefault: 75,\n\t\t},\n\t\t// Instruct VirtualScrolling to scroll to the given section id.\n\t\tscrollToSection: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\t// The containerElement props to forward to TileLayout.\n\t\tcontainerElement: {\n\t\t\ttype: HTMLElement,\n\t\t\tdefault: null,\n\t\t},\n\t\t// The useWindow props to forward to TileLayout.\n\t\tuseWindow: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\n\tdata() {\n\t\treturn {\n\t\t\tplaceholderFiles: Array(20).fill(0).map((_, index) => {\n\t\t\t\tconst height = 200\n\t\t\t\tconst width = this.croppedLayout ? height : height * (1 + Math.random() * 2)\n\t\t\t\treturn {\n\t\t\t\t\tid: index,\n\t\t\t\t\twidth,\n\t\t\t\t\theight,\n\t\t\t\t\tratio: width / height,\n\t\t\t\t}\n\t\t\t}),\n\t\t}\n\t},\n\n\tcomputed: {\n\t\t...mapGetters([\n\t\t\t'files',\n\t\t]),\n\n\t\tshowPlaceholders(): boolean {\n\t\t\treturn this.loading && (this.fileIds?.length === 0 || this.sections?.length === 0)\n\t\t},\n\n\t\titemsBySections(): {id: string, items: TiledItem[][]}[] {\n\t\t\tif (this.fileIds !== undefined) {\n\t\t\t\tif (this.showPlaceholders) {\n\t\t\t\t\treturn [{ id: '', items: this.placeholderFiles }]\n\t\t\t\t}\n\n\t\t\t\treturn [{\n\t\t\t\t\tid: '',\n\t\t\t\t\titems: this.fileIds\n\t\t\t\t\t\t.filter(fileId => this.files[fileId])\n\t\t\t\t\t\t.map(this.mapFileToItem),\n\t\t\t\t}]\n\t\t\t}\n\n\t\t\tif (this.sections !== undefined) {\n\t\t\t\tif (this.showPlaceholders) {\n\t\t\t\t\treturn [{ id: 'placeholder', items: this.placeholderFiles }]\n\t\t\t\t}\n\n\t\t\t\treturn this.sections.map((sectionId) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tid: sectionId,\n\t\t\t\t\t\titems: this.fileIdsBySection[sectionId]\n\t\t\t\t\t\t\t.filter(fileId => this.files[fileId])\n\t\t\t\t\t\t\t.map(this.mapFileToItem),\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\n\t\t\treturn []\n\t\t},\n\n\t\tphotosCount() {\n\t\t\treturn this.itemsBySections.map(({ items }) => items.length).reduce((total, length) => total + length, 0)\n\t\t},\n\n\t\tshowLoader(): boolean {\n\t\t\treturn this.loading && (this.fileIds?.length !== 0 || this.sections?.length !== 0)\n\t\t},\n\t\tcroppedLayout() {\n\t\t\treturn this.$store.state.userConfig.croppedLayout\n\t\t},\n\t},\n\n\tmounted() {\n\t\tsubscribe('files:node:updated', this.handleFileUpdated)\n\t},\n\n\tdestroyed() {\n\t\tunsubscribe('files:node:updated', this.handleFileUpdated)\n\t},\n\n\tmethods: {\n\t\t...mapActions([\n\t\t\t'appendFiles',\n\t\t]),\n\n\t\t// Ask the parent for more content.\n\t\tneedContent() {\n\t\t\tthis.$emit('need-content')\n\t\t},\n\n\t\tmapFileToItem(fileId: string): TiledItem {\n\t\t\tconst file = this.files[fileId] as PhotoNode\n\t\t\treturn {\n\t\t\t\tid: file.fileid,\n\t\t\t\twidth: file.metadataPhotosSize.width,\n\t\t\t\theight: file.metadataPhotosSize.height,\n\t\t\t\tratio: this.croppedLayout ? 1 : file.metadataPhotosSize.width / file.metadataPhotosSize.height,\n\t\t\t}\n\t\t},\n\n\t\tasync handleFileUpdated({ fileid }: PhotoNode) {\n\t\t\tconst fetchedFile = await fetchFile(this.files[fileid].filename)\n\t\t\tthis.appendFiles([fetchedFile])\n\t\t},\n\t},\n}\n</script>\n<style lang=\"scss\" scoped>\n.files-list-viewer {\n\theight: 100%;\n\tposition: relative;\n\n\t&__placeholder {\n\t\tbackground: var(--color-primary-element-light);\n\t\twidth: 100%;\n\t\theight: 100%;\n\t\tborder: 2px solid var(--color-main-background); // Use border so create a separation between images.\n\t}\n\n\t.tiled-container {\n\t\tflex-basis: 0;\n\t}\n\n\tul {\n\t\tdisplay: flex;\n\t\tflex-wrap: wrap;\n\n\t\tli:not(.last-tiled-rows) {\n\t\t\tflex-grow: 1;\n\t\t}\n\t}\n\n\t&__section-header {\n\t\tposition: sticky;\n\t\ttop: 0;\n\t\tz-index: 3;\n\t\tbackground: var(--color-main-background);\n\t}\n\n\t&__loader {\n\t\tmargin: 50px 0;\n\t}\n}\n</style>\n","<!--\n  - SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n<template>\n\t<!-- Errors handlers-->\n\t<NcEmptyContent v-if=\"(collection === undefined && !loading) || error === 404\"\n\t\tclass=\"empty-content-with-illustration\"\n\t\t:name=\"t('photos', 'This collection does not exist')\">\n\t\t<FolderMultipleImage slot=\"icon\" />\n\t</NcEmptyContent>\n\t<NcEmptyContent v-else-if=\"error\" :name=\"t('photos', 'An error occurred')\">\n\t\t<AlertCircle slot=\"icon\" />\n\t</NcEmptyContent>\n\n\t<div v-else class=\"collection\">\n\t\t<!-- Header -->\n\t\t<slot class=\"collection__header\"\n\t\t\tname=\"header\"\n\t\t\t:selected-file-ids=\"selectedFileIds\"\n\t\t\t:reset-selection=\"resetSelection\" />\n\n\t\t<!-- No content -->\n\t\t<slot v-if=\"sortedCollectionFileIds.length === 0 && !loading\" name=\"empty-content\" />\n\n\t\t<!-- Media list -->\n\t\t<FilesListViewer v-if=\"collection !== undefined && sortedCollectionFileIds.length > 0 \"\n\t\t\t:container-element=\"appContent\"\n\t\t\tclass=\"collection__media\"\n\t\t\t:file-ids=\"sortedCollectionFileIds\"\n\t\t\t:base-height=\"isMobile ? 120 : 200\"\n\t\t\t:loading=\"loading\">\n\t\t\t<File slot-scope=\"{file, distance}\"\n\t\t\t\t:file=\"files[file.id]\"\n\t\t\t\t:allow-selection=\"allowSelection\"\n\t\t\t\t:selected=\"selection[file.id] === true\"\n\t\t\t\t:distance=\"distance\"\n\t\t\t\t@click=\"openViewer\"\n\t\t\t\t@select-toggled=\"onFileSelectToggle\" />\n\t\t</FilesListViewer>\n\t</div>\n</template>\n\n<script lang='ts'>\nimport type { PropType } from 'vue'\n\nimport AlertCircle from 'vue-material-design-icons/AlertCircle.vue'\nimport FolderMultipleImage from 'vue-material-design-icons/FolderMultipleImage.vue'\n\nimport { NcEmptyContent, isMobile } from '@nextcloud/vue'\nimport { translate } from '@nextcloud/l10n'\n\nimport FilesSelectionMixin from '../../mixins/FilesSelectionMixin.js'\nimport FilesListViewer from '.././FilesListViewer.vue'\nimport File from '.././File.vue'\nimport type { Collection } from '../../services/collectionFetcher.js'\nimport type { PhotoNode } from '../../utils/fileUtils.js'\n\nexport default {\n\tname: 'CollectionContent',\n\n\tcomponents: {\n\t\tAlertCircle,\n\t\tFolderMultipleImage,\n\t\tNcEmptyContent,\n\t\tFilesListViewer,\n\t\tFile,\n\t},\n\n\tmixins: [\n\t\tFilesSelectionMixin,\n\t\tisMobile,\n\t],\n\n\tprops: {\n\t\tcollection: {\n\t\t\ttype: Object as PropType<Collection>,\n\t\t\tdefault: () => undefined,\n\t\t},\n\n\t\tcollectionFileIds: {\n\t\t\ttype: Array as PropType<string[]>,\n\t\t\trequired: true,\n\t\t},\n\n\t\tloading: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\n\t\tallowSelection: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\n\t\terror: {\n\t\t\ttype: [Error, Number],\n\t\t\tdefault: null,\n\t\t},\n\t},\n\n\tdata() {\n\t\treturn {\n\t\t\tappContent: document.getElementById('app-content-vue'),\n\t\t}\n\t},\n\n\tcomputed: {\n\t\tfiles(): Record<string, PhotoNode> {\n\t\t\treturn this.$store.getters.files\n\t\t},\n\n\t\tsortedCollectionFileIds() {\n\t\t\treturn this.collectionFileIds.toSorted((fileId1, fileId2) => this.files[fileId1].timestamp < this.files[fileId2].timestamp ? -1 : 1)\n\t\t},\n\t},\n\n\tmethods: {\n\t\topenViewer(fileId) {\n\t\t\tconst file = this.files[fileId]\n\t\t\tOCA.Viewer.open({\n\t\t\t\tfileInfo: file,\n\t\t\t\tlist: this.sortedCollectionFileIds.map(fileId => this.files[fileId]).filter(file => !file.sectionHeader),\n\t\t\t\tloadMore: file.loadMore ? async () => await file.loadMore(true) : () => [],\n\t\t\t\tcanLoop: file.canLoop,\n\t\t\t})\n\t\t},\n\n\t\tt: translate,\n\t},\n}\n</script>\n<style lang=\"scss\" scoped>\n.collection {\n\tdisplay: flex;\n\tflex-direction: column;\n\n\t&__media {\n\t\tpadding: 0 64px;\n\n\t\t@media only screen and (max-width: 1200px) {\n\t\t\tpadding: 0 4px;\n\t\t}\n\t}\n}\n</style>\n","/**\n * SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nexport default {\n\tname: 'FilesByMonthMixin',\n\n\tcomputed: {\n\t\tfileIdsByMonth(): Record<string, string[]> {\n\t\t\tconst filesByMonth = {}\n\t\t\tfor (const fileId of this.fetchedFileIds) {\n\t\t\t\tconst file = this.files[fileId]\n\t\t\t\tif (file) {\n\t\t\t\t\tfilesByMonth[file.month] = filesByMonth[file.month] ?? []\n\t\t\t\t\tfilesByMonth[file.month].push(file.fileid)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Sort files in sections.\n\t\t\tObject.keys(filesByMonth)\n\t\t\t\t.forEach(month => filesByMonth[month].sort(this.sortFilesByTimestamp))\n\n\t\t\treturn filesByMonth\n\t\t},\n\n\t\tmonthsList(): string[] {\n\t\t\treturn Object\n\t\t\t\t.keys(this.fileIdsByMonth)\n\t\t\t\t.sort((month1, month2) => month1 > month2 ? -1 : 1)\n\t\t},\n\t},\n\n\tmethods: {\n\t\tsortFilesByTimestamp(fileId1: string, fileId2: string): -1|1 {\n\t\t\treturn this.files[fileId1].timestamp > this.files[fileId2].timestamp ? -1 : 1\n\t\t},\n\t},\n}\n","<!--\n - SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n<template>\n\t<NcDialog content-classes=\"photos-picker\"\n\t\t:name=\"name\"\n\t\t:open=\"open\"\n\t\tout-transition\n\t\tsize=\"large\"\n\t\t@update:open=\"(open) => $emit('update:open', open)\">\n\t\t<!-- Navigation containing the months available -->\n\t\t<template v-if=\"monthsList.length > 0\" #navigation=\"{ isCollapsed }\">\n\t\t\t<!-- Mobile view -->\n\t\t\t<NcSelect v-if=\"isCollapsed\"\n\t\t\t\tv-model=\"targetMonth\"\n\t\t\t\t:aria-label-listbox=\"t('photos', 'Dates')\"\n\t\t\t\tclass=\"photos-picker__navigation__month-select\"\n\t\t\t\t:clearable=\"false\"\n\t\t\t\t:input-label=\"t('photos', 'Jump to specific date in list')\"\n\t\t\t\t:options=\"monthsList\">\n\t\t\t\t<template #selected-option=\"{ label }\">\n\t\t\t\t\t{{ dateMonthAndYear(label) }}\n\t\t\t\t</template>\n\t\t\t\t<template #option=\"{ label }\">\n\t\t\t\t\t{{ dateMonthAndYear(label) }}\n\t\t\t\t</template>\n\t\t\t</NcSelect>\n\n\t\t\t<!-- Default view -->\n\t\t\t<ul v-else :aria-label=\"t('photos', 'Dates')\">\n\t\t\t\t<li v-for=\"month in monthsList\"\n\t\t\t\t\t:key=\"month\"\n\t\t\t\t\tclass=\"photos-picker__navigation__month\">\n\t\t\t\t\t<NcButton :type=\"targetMonth === month ? 'secondary' : 'tertiary'\"\n\t\t\t\t\t\t:aria-label=\"t('photos', 'Jump to {date}', { date: dateMonthAndYear(month) })\"\n\t\t\t\t\t\t@click=\"targetMonth = month\">\n\t\t\t\t\t\t{{ dateMonthAndYear(month) }}\n\t\t\t\t\t</NcButton>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</template>\n\n\t\t<!-- The actions on the bottom -->\n\t\t<template #actions>\n\t\t\t<div class=\"photos-picker__actions\">\n\t\t\t\t<div class=\"photos-picker__actions__buttons\">\n\t\t\t\t\t<UploadPicker :accept=\"allowedMimes\"\n\t\t\t\t\t\t:context=\"uploadContext\"\n\t\t\t\t\t\t:destination=\"photosLocationFolder\"\n\t\t\t\t\t\tmultiple\n\t\t\t\t\t\t@uploaded=\"refreshFiles\" />\n\t\t\t\t\t<NcButton type=\"primary\" :disabled=\"loading || selectedFileIds.length === 0\" @click=\"emitPickedEvent\">\n\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t<ImagePlus v-if=\"!loading\" />\n\t\t\t\t\t\t\t<NcLoadingIcon v-if=\"loading\" />\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t{{ t('photos', 'Add to {destination}', { destination }) }}\n\t\t\t\t\t</NcButton>\n\t\t\t\t</div>\n\t\t\t\t<NcNoteCard v-if=\"photosLocationFolder.attributes['owner-id'] !== currentUser\" type=\"warning\">\n\t\t\t\t\t{{ t('photos', 'The destination folder is owned by {owner}', { owner: photosLocationFolder.attributes['owner-id'] }) }}\n\t\t\t\t</NcNoteCard>\n\t\t\t</div>\n\t\t</template>\n\n\t\t<FilesListViewer class=\"photos-picker__file-list\"\n\t\t\t:class=\"{'photos-picker__file-list--placeholder': monthsList.length === 0}\"\n\t\t\t:file-ids-by-section=\"fileIdsByMonth\"\n\t\t\t:empty-message=\"t('photos', 'There are no photos or videos yet!')\"\n\t\t\t:sections=\"monthsList\"\n\t\t\t:loading=\"loadingFiles\"\n\t\t\t:base-height=\"100\"\n\t\t\t:section-header-height=\"50\"\n\t\t\t:scroll-to-section=\"targetMonth\"\n\t\t\t@need-content=\"getFiles\"\n\t\t\t@focusout.native=\"onFocusOut\">\n\t\t\t<template slot-scope=\"{file, height, isHeader, distance}\">\n\t\t\t\t<h3 v-if=\"isHeader\"\n\t\t\t\t\t:id=\"`photos-picker-section-header-${file.id}`\"\n\t\t\t\t\t:style=\"{ height: `${height}px`}\"\n\t\t\t\t\tclass=\"section-header\">\n\t\t\t\t\t{{ dateMonthAndYear(file.id) }}\n\t\t\t\t</h3>\n\n\t\t\t\t<File v-else\n\t\t\t\t\t:file=\"files[file.id]\"\n\t\t\t\t\t:allow-selection=\"true\"\n\t\t\t\t\t:selected=\"selection[file.id] === true\"\n\t\t\t\t\t:distance=\"distance\"\n\t\t\t\t\t@select-toggled=\"onFileSelectToggle\" />\n\t\t\t</template>\n\t\t</FilesListViewer>\n\t</NcDialog>\n</template>\n\n<script lang='ts'>\nimport { UploadPicker } from '@nextcloud/upload'\nimport { NcButton, NcDialog, NcLoadingIcon, NcSelect, NcNoteCard, useIsMobile } from '@nextcloud/vue'\nimport { defineComponent } from 'vue'\nimport { mapGetters } from 'vuex'\n\nimport moment from '@nextcloud/moment'\nimport { getCurrentUser } from '@nextcloud/auth'\n\nimport ImagePlus from 'vue-material-design-icons/ImagePlus.vue'\n\nimport FilesListViewer from './FilesListViewer.vue'\nimport File from './File.vue'\n\nimport FetchFilesMixin from '../mixins/FetchFilesMixin.js'\nimport FilesSelectionMixin from '../mixins/FilesSelectionMixin.js'\nimport FilesByMonthMixin from '../mixins/FilesByMonthMixin.js'\nimport allowedMimes from '../services/AllowedMimes.js'\n\nexport default defineComponent({\n\tname: 'PhotosPicker',\n\n\tcomponents: {\n\t\tFile,\n\t\tFilesListViewer,\n\t\tImagePlus,\n\t\tNcButton,\n\t\tNcDialog,\n\t\tNcLoadingIcon,\n\t\tNcSelect,\n\t\tNcNoteCard,\n\t\tUploadPicker,\n\t},\n\n\tmixins: [\n\t\tFetchFilesMixin,\n\t\tFilesByMonthMixin,\n\t\tFilesSelectionMixin,\n\t],\n\n\tprops: {\n\t\t/**\n\t\t * If the photos picker should be opened\n\t\t */\n\t\topen: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\n\t\t/**\n\t\t * Name to be used as heading\n\t\t */\n\t\tname: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\n\t\t// Label to show in the submit button.\n\t\tdestination: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\n\t\t// List of file ids to not show.\n\t\tblacklistIds: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => [],\n\t\t},\n\n\t\t// Whether we should disable the submit button and show a spinner.\n\t\tloading: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\n\temits: ['files-picked', 'update:open'],\n\n\tsetup() {\n\t\treturn {\n\t\t\tisMobile: useIsMobile(),\n\t\t}\n\t},\n\n\tdata() {\n\t\treturn {\n\t\t\tallowedMimes,\n\t\t\ttargetMonth: null,\n\t\t\tuploadContext: {\n\t\t\t\troute: 'albumpicker',\n\t\t\t},\n\t\t\tcurrentUser: getCurrentUser().uid,\n\t\t}\n\t},\n\n\tcomputed: {\n\t\t...mapGetters([\n\t\t\t'files',\n\t\t]),\n\n\t\tphotosLocationFolder() {\n\t\t\treturn this.$store.state.userConfig.photosLocationFolder\n\t\t},\n\t},\n\n\twatch: {\n\t\tmonthsList(value) {\n\t\t\tif (this.targetMonth === null) {\n\t\t\t\tthis.targetMonth = value[0]\n\t\t\t}\n\t\t},\n\t},\n\n\tmethods: {\n\t\t/**\n\t\t * @param {FocusEvent} event The focus event\n\t\t */\n\t\tonFocusOut(event) {\n\t\t\tif (event.relatedTarget === null) { // Focus escaping to body\n\t\t\t\tevent.target.focus({ preventScroll: true })\n\t\t\t}\n\t\t},\n\n\t\tgetFiles() {\n\t\t\tthis.fetchFiles({}, this.blacklistIds)\n\t\t},\n\n\t\trefreshFiles() {\n\t\t\tthis.fetchFiles({ firstResult: 0 }, [...this.blacklistIds, ...this.fetchedFileIds], true)\n\t\t},\n\n\t\temitPickedEvent() {\n\t\t\tthis.$emit('files-picked', this.selectedFileIds)\n\t\t},\n\t\t/**\n\t\t * @param {string} date - In the following format: YYYYMM\n\t\t */\n\t\tdateMonthAndYear(date) {\n\t\t\tif (this.isMobile) {\n\t\t\t\treturn moment(date, 'YYYYMM').format('MMM YYYY')\n\t\t\t}\n\t\t\treturn moment(date, 'YYYYMM').format('MMMM YYYY')\n\t\t},\n\t},\n})\n</script>\n\n<style lang=\"scss\" scoped>\n:deep(.photos-picker) {\n\tdisplay: flex;\n\t// remove padding to move scrollbar to the very end\n\tpadding-inline-end: 0 !important;\n}\n\n.photos-picker {\n\n\t&__navigation {\n\t\t&__month {\n\t\t\t// For focus-visible outline\n\t\t\tmargin: 4px;\n\t\t}\n\n\t\t&__month-select {\n\t\t\tflex: 1;\n\t\t\t// align with other content\n\t\t\tpadding-inline-end: 12px;\n\t\t\tpadding-block-end: 6px;\n\t\t}\n\t}\n\n\t&__file-list {\n\t\tflex-grow: 1;\n\t\tmin-width: 0;\n\t\theight: 100%;\n\t\tpadding: 0 4px;\n\n\t\t&--placeholder {\n\t\t\tbackground: var(--color-primary-element-light);\n\t\t\tborder-radius: var(--border-radius-large);\n\t\t}\n\n\t\t.section-header {\n\t\t\tfont-weight: bold;\n\t\t\tfont-size: 20px;\n\t\t\tpadding: 8px 0 4px 0;\n\t\t}\n\n\t\t:deep(.empty-content) {\n\t\t\theight: fit-content;\n\t\t\tmargin-block: 1em;\n\t\t\tmargin-inline-end: 12px;\n\t\t\twidth: calc(100% - 12px);\n\t\t}\n\t}\n\n\t&__actions {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tflex-grow: 1;\n\n\t\t&__buttons {\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t\tjustify-content: flex-end;\n\t\t\tgap: 16px;\n\t\t}\n\t}\n}\n</style>\n","<!--\n  - SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n<template>\n\t<NcActionLink :close-after-click=\"true\"\n\t\t:href=\"downloadUrl\"\n\t\t:download=\"downloadUrl\"\n\t\t:aria-label=\"title\">\n\t\t{{ title }}\n\t\t<slot slot=\"icon\" name=\"icon\" />\n\t</NcActionLink>\n</template>\n\n<script lang='ts'>\nimport { mapGetters } from 'vuex'\n\nimport { generateUrl } from '@nextcloud/router'\nimport { NcActionLink } from '@nextcloud/vue'\n\nexport default {\n\tname: 'ActionDownload',\n\n\tcomponents: {\n\t\tNcActionLink,\n\t},\n\n\tprops: {\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\n\t\tselectedFileIds: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tcomputed: {\n\t\t...mapGetters([\n\t\t\t'files',\n\t\t]),\n\n\t\tdownloadUrl() {\n\t\t\tconst params = new URLSearchParams()\n\t\t\tconst filePaths = this.fileNames.map(fileName => '/' + fileName.split('/').splice(3).join('/'))\n\t\t\tparams.append('files', JSON.stringify(filePaths))\n\n\t\t\treturn generateUrl(`/apps/files/ajax/download.php?${params}`)\n\t\t},\n\n\t\tfileNames() {\n\t\t\treturn this.selectedFileIds.map(fileId => this.files[fileId].filename)\n\t\t},\n\t},\n}\n</script>\n","<!--\n  - SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<!-- Errors handlers -->\n\t<div v-if=\"errorFetchingFiles\" class=\"timeline__empty-content\">\n\t\t<NcEmptyContent v-if=\"errorFetchingFiles === 404\" :name=\"t('photos', 'One of the source folders does not exist')\">\n\t\t\t<FolderAlertOutline slot=\"icon\" />\n\t\t\t<PhotosSourceLocationsSettings slot=\"action\" class=\"timeline__update_source_directory\" />\n\t\t</NcEmptyContent>\n\t\t<NcEmptyContent v-else :name=\"t('photos', 'An error occurred')\">\n\t\t\t<AlertCircle slot=\"icon\" />\n\t\t</NcEmptyContent>\n\t</div>\n\n\t<div v-else class=\"timeline\">\n\t\t<!-- Header -->\n\t\t<HeaderNavigation key=\"navigation\"\n\t\t\t:loading=\"loadingCount > 0\"\n\t\t\t:path=\"'/'\"\n\t\t\t:title=\"rootTitle\"\n\t\t\t:root-title=\"rootTitle\"\n\t\t\t@refresh=\"resetFetchFilesState\">\n\t\t\t<div class=\"timeline__header__left\">\n\t\t\t\t<!-- TODO: UploadPicker -->\n\t\t\t\t<NcButton v-if=\"selectedFileIds.length === 0\"\n\t\t\t\t\tref=\"newAlbumButton\"\n\t\t\t\t\t:aria-label=\"t('photos', 'Create new album')\"\n\t\t\t\t\t@click=\"showAlbumCreationForm = true\">\n\t\t\t\t\t{{ t('photos', 'Create new album') }}\n\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t<PlusBoxMultiple />\n\t\t\t\t\t</template>\n\t\t\t\t</NcButton>\n\n\t\t\t\t<template v-else>\n\t\t\t\t\t<NcButton :close-after-click=\"true\"\n\t\t\t\t\t\ttype=\"primary\"\n\t\t\t\t\t\t:aria-label=\"t('photos', 'Add to album')\"\n\t\t\t\t\t\t@click=\"showAlbumPicker = true\">\n\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t<Plus />\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-if=\"!isMobile\" #default>\n\t\t\t\t\t\t\t{{ t('photos', 'Add to album') }}\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</NcButton>\n\n\t\t\t\t\t<NcButton v-if=\"selectedFileIds.length > 0\"\n\t\t\t\t\t\t:aria-label=\"t('photos', 'Unselect all')\"\n\t\t\t\t\t\t@click=\"resetSelection\">\n\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t<Close />\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-if=\"!isMobile\" #default>\n\t\t\t\t\t\t\t{{ t('photos', 'Unselect all') }}\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</NcButton>\n\n\t\t\t\t\t<NcActions :aria-label=\"t('photos', 'Open actions menu')\">\n\t\t\t\t\t\t<ActionDownload :selected-file-ids=\"selectedFileIds\" :title=\"t('photos', 'Download selected files')\">\n\t\t\t\t\t\t\t<Download slot=\"icon\" />\n\t\t\t\t\t\t</ActionDownload>\n\n\t\t\t\t\t\t<ActionFavorite :selected-file-ids=\"selectedFileIds\" />\n\n\t\t\t\t\t\t<NcActionButton :close-after-click=\"true\"\n\t\t\t\t\t\t\t:aria-label=\"t('photos', 'Delete selection')\"\n\t\t\t\t\t\t\t@click=\"deleteSelection\">\n\t\t\t\t\t\t\t{{ t('photos', 'Delete selection') }}\n\t\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t\t<Delete />\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</NcActionButton>\n\t\t\t\t\t</NcActions>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</HeaderNavigation>\n\n\t\t<FilesListViewer ref=\"filesListViewer\"\n\t\t\t:container-element=\"appContent\"\n\t\t\tclass=\"timeline__file-list\"\n\t\t\t:file-ids-by-section=\"fileIdsByMonth\"\n\t\t\t:sections=\"monthsList\"\n\t\t\t:loading=\"loadingFiles\"\n\t\t\t:base-height=\"isMobile ? 120 : 200\"\n\t\t\t:empty-message=\"t('photos', 'No photos or videos in here')\"\n\t\t\t@need-content=\"getContent\">\n\t\t\t<template slot-scope=\"{file, isHeader, distance}\">\n\t\t\t\t<h2 v-if=\"isHeader\"\n\t\t\t\t\t:id=\"`file-picker-section-header-${file.id}`\"\n\t\t\t\t\tclass=\"section-header\">\n\t\t\t\t\t<b>{{ file.id | dateMonth }}</b>\n\t\t\t\t\t{{ file.id | dateYear }}\n\t\t\t\t</h2>\n\t\t\t\t<File v-else\n\t\t\t\t\t:file=\"files[file.id]\"\n\t\t\t\t\t:allow-selection=\"true\"\n\t\t\t\t\t:selected=\"selection[file.id] === true\"\n\t\t\t\t\t:distance=\"distance\"\n\t\t\t\t\t@click=\"openViewer\"\n\t\t\t\t\t@select-toggled=\"onFileSelectToggle\" />\n\t\t\t</template>\n\t\t</FilesListViewer>\n\n\t\t<NcModal v-if=\"showAlbumCreationForm\"\n\t\t\tkey=\"albumCreationForm\"\n\t\t\t:set-return-focus=\"$refs.newAlbumButton?.$el\"\n\t\t\t@close=\"showAlbumCreationForm = false\">\n\t\t\t<h2 class=\"timeline__heading\">\n\t\t\t\t{{ t('photos', 'New album') }}\n\t\t\t</h2>\n\t\t\t<AlbumForm @done=\"showAlbumCreationForm = false\" />\n\t\t</NcModal>\n\n\t\t<NcModal v-if=\"showAlbumPicker\"\n\t\t\tkey=\"albumPicker\"\n\t\t\t@close=\"showAlbumPicker = false\">\n\t\t\t<AlbumPicker @album-picked=\"addSelectionToAlbum\" />\n\t\t</NcModal>\n\t</div>\n</template>\n\n<script lang='ts'>\nimport { mapActions, mapGetters } from 'vuex'\nimport FolderAlertOutline from 'vue-material-design-icons/FolderAlertOutline.vue'\nimport Plus from 'vue-material-design-icons/Plus.vue'\nimport Delete from 'vue-material-design-icons/Delete.vue'\nimport PlusBoxMultiple from 'vue-material-design-icons/PlusBoxMultiple.vue'\nimport Download from 'vue-material-design-icons/Download.vue'\nimport Close from 'vue-material-design-icons/Close.vue'\nimport AlertCircle from 'vue-material-design-icons/AlertCircle.vue'\n\nimport { NcModal, NcActions, NcActionButton, NcButton, NcEmptyContent, isMobile } from '@nextcloud/vue'\nimport moment from '@nextcloud/moment'\nimport { translate } from '@nextcloud/l10n'\nimport { subscribe, unsubscribe } from '@nextcloud/event-bus'\n\nimport { allMimes } from '../services/AllowedMimes.js'\nimport FetchFilesMixin from '../mixins/FetchFilesMixin.js'\nimport FilesByMonthMixin from '../mixins/FilesByMonthMixin.js'\nimport FilesSelectionMixin from '../mixins/FilesSelectionMixin.js'\nimport FilesListViewer from '../components/FilesListViewer.vue'\nimport File from '../components/File.vue'\nimport AlbumForm from '../components/Albums/AlbumForm.vue'\nimport AlbumPicker from '../components/Albums/AlbumPicker.vue'\nimport ActionFavorite from '../components/Actions/ActionFavorite.vue'\nimport ActionDownload from '../components/Actions/ActionDownload.vue'\nimport HeaderNavigation from '../components/HeaderNavigation.vue'\nimport PhotosSourceLocationsSettings from '../components/Settings/PhotosSourceLocationsSettings.vue'\nimport { configChangedEvent } from '../store/userConfig.js'\n\nexport default {\n\tname: 'Timeline',\n\tcomponents: {\n\t\tDelete,\n\t\tPlusBoxMultiple,\n\t\tDownload,\n\t\tClose,\n\t\tPlus,\n\t\tFolderAlertOutline,\n\t\tNcEmptyContent,\n\t\tNcModal,\n\t\tNcActions,\n\t\tNcActionButton,\n\t\tNcButton,\n\t\tAlbumForm,\n\t\tAlbumPicker,\n\t\tFilesListViewer,\n\t\tFile,\n\t\tActionFavorite,\n\t\tActionDownload,\n\t\tHeaderNavigation,\n\t\tPhotosSourceLocationsSettings,\n\t\tAlertCircle,\n\t},\n\n\tfilters: {\n\t\tdateMonth(date: string): string {\n\t\t\treturn moment(date, 'YYYYMM').format('MMMM')\n\t\t},\n\t\tdateYear(date: string): string {\n\t\t\treturn moment(date, 'YYYYMM').format('YYYY')\n\t\t},\n\t},\n\n\tmixins: [\n\t\tFetchFilesMixin,\n\t\tFilesSelectionMixin,\n\t\tFilesByMonthMixin,\n\t\tisMobile,\n\t],\n\n\tbeforeRouteLeave(to, from, next) {\n\t\twindow.scrollTo(0, 0)\n\t\tnext()\n\t},\n\n\tprops: {\n\t\tonlyFavorites: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tmimesType: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => allMimes,\n\t\t},\n\t\tonThisDay: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\trootTitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tdata() {\n\t\treturn {\n\t\t\tloadingCount: 0,\n\t\t\tshowAlbumCreationForm: false,\n\t\t\tshowAlbumPicker: false,\n\t\t\tappContent: document.getElementById('app-content-vue'),\n\t\t}\n\t},\n\n\tcomputed: {\n\t\t...mapGetters([\n\t\t\t'files',\n\t\t]),\n\t},\n\n\tmounted() {\n\t\tsubscribe(configChangedEvent, this.handleUserConfigChange)\n\t},\n\n\tdestroyed() {\n\t\tunsubscribe(configChangedEvent, this.handleUserConfigChange)\n\t},\n\n\tmethods: {\n\t\t...mapActions([\n\t\t\t'deleteFiles',\n\t\t\t'addFilesToCollection',\n\t\t]),\n\n\t\tgetContent() {\n\t\t\tthis.fetchFiles({\n\t\t\t\tmimesType: this.mimesType,\n\t\t\t\tonThisDay: this.onThisDay,\n\t\t\t\tonlyFavorites: this.onlyFavorites,\n\t\t\t})\n\t\t},\n\n\t\topenViewer(fileId) {\n\t\t\tconst file = this.files[fileId]\n\t\t\tOCA.Viewer.open({\n\t\t\t\tfileInfo: file,\n\t\t\t\tlist: Object.values(this.fileIdsByMonth).flat().map(fileId => this.files[fileId]),\n\t\t\t\tloadMore: file.loadMore ? async () => await file.loadMore(true) : () => [],\n\t\t\t\tcanLoop: file.canLoop,\n\t\t\t})\n\t\t},\n\n\t\topenUploader() {\n\t\t\t// TODO: finish when implementing upload\n\t\t},\n\n\t\tasync addSelectionToAlbum(album) {\n\t\t\tthis.showAlbumPicker = false\n\t\t\tawait this.addFilesToCollection({ collectionFileName: album.filename, fileIdsToAdd: this.selectedFileIds })\n\t\t},\n\n\t\tasync deleteSelection() {\n\t\t\t// Need to store the file ids so it is not changed before the deleteFiles call.\n\t\t\tconst fileIds = this.selectedFileIds\n\t\t\tthis.onUncheckFiles(fileIds)\n\t\t\tthis.fetchedFileIds = this.fetchedFileIds.filter(fileid => !fileIds.includes(fileid))\n\t\t\tawait this.deleteFiles(fileIds)\n\t\t},\n\n\t\thandleUserConfigChange({ key }) {\n\t\t\tif (key === 'photosSourceFolders') {\n\t\t\t\tthis.resetFetchFilesState()\n\t\t\t}\n\t\t},\n\n\t\tt: translate,\n\t},\n}\n</script>\n<style lang=\"scss\" scoped>\n.timeline {\n\tdisplay: flex;\n\tflex-direction: column;\n\n\t&__empty-content {\n\t\theight: 100%;\n\n\t\t.empty-content {\n\t\t\theight: 100%;\n\t\t}\n\n\t\t.timeline__update_source_directory {\n\t\t\talign-items: center;\n\n\t\t\t:deep(.folder) {\n\t\t\t\tmin-width: unset;\n\t\t\t}\n\t\t}\n\t}\n\n\t&__header {\n\t\t&__left {\n\t\t\tdisplay: flex;\n\t\t\tgap: 4px;\n\t\t}\n\t}\n\n\t&__heading {\n\t\tpadding: calc(var(--default-grid-baseline) * 4);\n\t\tmargin-bottom: 0px;\n\t\tpadding-bottom: 0px;\n\t}\n\n\t&__file-list {\n\t\tpadding: 0 64px;\n\n\t\t@media only screen and (max-width: 1200px) {\n\t\t\tpadding: 0 4px;\n\t\t}\n\n\t\t:deep(.files-list-viewer__section-header) {\n\t\t\ttop: var(--photos-navigation-height);\n\t\t}\n\t}\n}\n</style>\n","<!--\n - SPDX-FileCopyrightText: 2023 Nextcloud GmbH and Nextcloud contributors\n - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<LMap class=\"location-map\"\n\t\t:zoom=\"previewZoom\"\n\t\t:center=\"center\"\n\t\t:options=\"{\n\t\t\tscrollWheelZoom: false,\n\t\t\tzoomControl: false,\n\t\t\tdragging: false,\n\t\t\tattributionControl: false,\n\t\t}\"\n\t\t@scroll.prevent=\"\">\n\t\t<LTileLayer :url=\"url\" />\n\t\t<LControlAttribution position=\"bottomright\"\n\t\t\t:prefix=\"attribution\" />\n\t\t<LMarker :lat-lng=\"center\">\n\t\t\t<LTooltip :options=\"{\n\t\t\t\tdirection: 'top',\n\t\t\t\tpermanent: 'true',\n\t\t\t\toffset: [-16,-14]}\">\n\t\t\t\t{{ name }}\n\t\t\t</LTooltip>\n\t\t</LMarker>\n\t</LMap>\n</template>\n\n<script lang='ts'>\nimport {\n\tLControlAttribution,\n\tLTooltip,\n\tLMap,\n\tLMarker,\n\tLTileLayer,\n} from 'vue2-leaflet'\n// Leaflet icon patch\nimport 'leaflet-defaulticon-compatibility/dist/leaflet-defaulticon-compatibility.webpack.css' // Re-uses images from ~leaflet package\nimport 'leaflet/dist/leaflet.css'\n\n// eslint-disable-next-line\nimport 'leaflet-defaulticon-compatibility'\n\nexport default {\n\tname: 'LocationMap',\n\tcomponents: {\n\t\tLControlAttribution,\n\t\tLTileLayer,\n\t\tLMap,\n\t\tLMarker,\n\t\tLTooltip,\n\t},\n\tprops: {\n\t\t/**\n\t\t * The latitude of the location\n\t\t */\n\t\tlatitude: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\n\t\t/**\n\t\t * The longitude of the location\n\t\t */\n\t\tlongitude: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\n\t\t/**\n\t\t * The name of the location\n\t\t */\n\t\tname: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\turl: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',\n\t\t\t// The zoom level of the map in the messages list\n\t\t\tpreviewZoom: 13,\n\t\t\tattribution: '&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors',\n\t\t}\n\t},\n\tcomputed: {\n\t\t/** @return {[number, number]} */\n\t\tcenter() {\n\t\t\treturn [this.latitude, this.longitude]\n\t\t},\n\t},\n}\n</script>\n\n<style scoped lang=\"scss\">\n.location-map {\n\tposition: relative;\n\tmargin: 16px;\n\tborder-radius: var(--border-radius-large);\n\theight: 250px;\n\twidth: 90%;\n}\n</style>\n"],"file":"js/photos-main.mjs"}